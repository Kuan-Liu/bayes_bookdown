<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Session 7 Bayesian Regression II | HAD5314H - Applied Bayesian Methods in Clinical Epidemiology and Health Care Research</title>
  <meta name="description" content="Course notes for HAD5314H Winter 2022" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Session 7 Bayesian Regression II | HAD5314H - Applied Bayesian Methods in Clinical Epidemiology and Health Care Research" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://kuan-liu.github.io/bayes_bookdown/" />
  
  <meta property="og:description" content="Course notes for HAD5314H Winter 2022" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Session 7 Bayesian Regression II | HAD5314H - Applied Bayesian Methods in Clinical Epidemiology and Health Care Research" />
  
  <meta name="twitter:description" content="Course notes for HAD5314H Winter 2022" />
  

<meta name="author" content="Kuan Liu   Institute of Health Policy, Management and Evaluation   University of Toronto" />


<meta name="date" content="2022-03-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="BayesReg1.html"/>
<link rel="next" href="BayesMeta.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.20/datatables.js"></script>
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">HAD5314H - Winter 2022 </a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>University of Toronto Statement of Acknowledgment of Traditional Land</a></li>
<li class="chapter" data-level="" data-path="course-syllabus.html"><a href="course-syllabus.html"><i class="fa fa-check"></i>Course Syllabus</a>
<ul>
<li class="chapter" data-level="" data-path="course-syllabus.html"><a href="course-syllabus.html#course-info"><i class="fa fa-check"></i>Course Info</a></li>
<li class="chapter" data-level="" data-path="course-syllabus.html"><a href="course-syllabus.html#course-description"><i class="fa fa-check"></i>Course Description</a></li>
<li class="chapter" data-level="" data-path="course-syllabus.html"><a href="course-syllabus.html#course-textbook-and-structure"><i class="fa fa-check"></i>Course Textbook and Structure</a></li>
<li class="chapter" data-level="" data-path="course-syllabus.html"><a href="course-syllabus.html#calendar-and-outline"><i class="fa fa-check"></i>Calendar and Outline</a></li>
<li class="chapter" data-level="" data-path="course-syllabus.html"><a href="course-syllabus.html#accessibility-and-accommodations"><i class="fa fa-check"></i>Accessibility and Accommodations</a></li>
<li class="chapter" data-level="" data-path="course-syllabus.html"><a href="course-syllabus.html#academic-integrity"><i class="fa fa-check"></i>Academic Integrity</a></li>
<li class="chapter" data-level="" data-path="course-syllabus.html"><a href="course-syllabus.html#key-resources-and-supports-for-dslph-graduate-students"><i class="fa fa-check"></i>Key Resources and Supports for DSLPH Graduate Students</a></li>
<li class="chapter" data-level="" data-path="course-syllabus.html"><a href="course-syllabus.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="into.html"><a href="into.html"><i class="fa fa-check"></i><b>1</b> Introduction to the course</a>
<ul>
<li class="chapter" data-level="1.1" data-path="into.html"><a href="into.html#about-me"><i class="fa fa-check"></i><b>1.1</b> About me</a></li>
<li class="chapter" data-level="1.2" data-path="into.html"><a href="into.html#syllabus"><i class="fa fa-check"></i><b>1.2</b> Syllabus</a></li>
<li class="chapter" data-level="1.3" data-path="into.html"><a href="into.html#some-history"><i class="fa fa-check"></i><b>1.3</b> Some history</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="into.html"><a href="into.html#bayesian-history"><i class="fa fa-check"></i><b>1.3.1</b> Bayesian history</a></li>
<li class="chapter" data-level="1.3.2" data-path="into.html"><a href="into.html#history-of-this-course"><i class="fa fa-check"></i><b>1.3.2</b> History of this course</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="into.html"><a href="into.html#thinking-like-a-bayesian-using-the-concept-of-probability"><i class="fa fa-check"></i><b>1.4</b> Thinking like a Bayesian using the concept of probability</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="into.html"><a href="into.html#probability-is-not-unitary"><i class="fa fa-check"></i><b>1.4.1</b> Probability is not unitary</a></li>
<li class="chapter" data-level="1.4.2" data-path="into.html"><a href="into.html#bayes-rule"><i class="fa fa-check"></i><b>1.4.2</b> Bayes’ Rule</a></li>
<li class="chapter" data-level="1.4.3" data-path="into.html"><a href="into.html#the-scientific-method-in-steps"><i class="fa fa-check"></i><b>1.4.3</b> The Scientific Method in steps</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html"><i class="fa fa-check"></i>Lab1 Getting started with R &amp; RStudio</a>
<ul>
<li class="chapter" data-level="1.5" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#r-and-rstudio-installation"><i class="fa fa-check"></i><b>1.5</b> R and RStudio Installation</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#windows-operating-system"><i class="fa fa-check"></i><b>1.5.1</b> Windows operating system</a></li>
<li class="chapter" data-level="1.5.2" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#macos-operating-system"><i class="fa fa-check"></i><b>1.5.2</b> macOS operating system</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#r-packages"><i class="fa fa-check"></i><b>1.6</b> R Packages</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#bayesian-analysis-in-r-using-brms-package"><i class="fa fa-check"></i><b>1.6.1</b> Bayesian Analysis in R using brms package</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#working-in-rstudio"><i class="fa fa-check"></i><b>1.7</b> Working in RStudio</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#rstudio-layout"><i class="fa fa-check"></i><b>1.7.1</b> RStudio layout</a></li>
<li class="chapter" data-level="1.7.2" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#customization"><i class="fa fa-check"></i><b>1.7.2</b> Customization</a></li>
<li class="chapter" data-level="1.7.3" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#working-directory"><i class="fa fa-check"></i><b>1.7.3</b> Working directory</a></li>
<li class="chapter" data-level="1.7.4" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#getting-help-with-r"><i class="fa fa-check"></i><b>1.7.4</b> Getting help with R</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#basic-r-a-crash-introduction"><i class="fa fa-check"></i><b>1.8</b> Basic R (a crash introduction)</a>
<ul>
<li class="chapter" data-level="1.8.1" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#arithmetic"><i class="fa fa-check"></i><b>1.8.1</b> Arithmetic</a></li>
<li class="chapter" data-level="1.8.2" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#vectors"><i class="fa fa-check"></i><b>1.8.2</b> Vectors</a></li>
<li class="chapter" data-level="1.8.3" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#data-frame---the-titanic-dataset"><i class="fa fa-check"></i><b>1.8.3</b> Data frame - The Titanic dataset</a></li>
<li class="chapter" data-level="1.8.4" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#simple-plots"><i class="fa fa-check"></i><b>1.8.4</b> Simple plots</a></li>
<li class="chapter" data-level="" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#r-session-information"><i class="fa fa-check"></i>R Session information</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="prob.html"><a href="prob.html"><i class="fa fa-check"></i><b>2</b> Probability, random variables and distributions</a>
<ul>
<li class="chapter" data-level="2.1" data-path="prob.html"><a href="prob.html#probability"><i class="fa fa-check"></i><b>2.1</b> Probability</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="prob.html"><a href="prob.html#venn-diagrams"><i class="fa fa-check"></i><b>2.1.1</b> Venn Diagrams</a></li>
<li class="chapter" data-level="2.1.2" data-path="prob.html"><a href="prob.html#probability-rules"><i class="fa fa-check"></i><b>2.1.2</b> Probability Rules</a></li>
<li class="chapter" data-level="2.1.3" data-path="prob.html"><a href="prob.html#how-to-define-and-assign-probabilities-in-general"><i class="fa fa-check"></i><b>2.1.3</b> How to define and assign probabilities in general?</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="prob.html"><a href="prob.html#probability-distributions"><i class="fa fa-check"></i><b>2.2</b> Probability Distributions</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="prob.html"><a href="prob.html#probability-density-functions"><i class="fa fa-check"></i><b>2.2.1</b> Probability density functions</a></li>
<li class="chapter" data-level="2.2.2" data-path="prob.html"><a href="prob.html#discrete-distributions"><i class="fa fa-check"></i><b>2.2.2</b> Discrete Distributions</a></li>
<li class="chapter" data-level="2.2.3" data-path="prob.html"><a href="prob.html#continous-distributions"><i class="fa fa-check"></i><b>2.2.3</b> Continous Distributions</a></li>
<li class="chapter" data-level="" data-path="prob.html"><a href="prob.html#r-session-information-1"><i class="fa fa-check"></i>R Session information</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bayes.html"><a href="bayes.html"><i class="fa fa-check"></i><b>3</b> Introduction to Bayesian inference</a>
<ul>
<li class="chapter" data-level="3.1" data-path="bayes.html"><a href="bayes.html#classical-frequentist-approach"><i class="fa fa-check"></i><b>3.1</b> Classical frequentist approach</a></li>
<li class="chapter" data-level="3.2" data-path="bayes.html"><a href="bayes.html#introduction-to-bayesian-approach"><i class="fa fa-check"></i><b>3.2</b> Introduction to Bayesian approach</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="bayes.html"><a href="bayes.html#review-from-session-1"><i class="fa fa-check"></i><b>3.2.1</b> Review from session 1</a></li>
<li class="chapter" data-level="3.2.2" data-path="bayes.html"><a href="bayes.html#the-beta-binomial-model"><i class="fa fa-check"></i><b>3.2.2</b> The Beta-binomial model</a></li>
<li class="chapter" data-level="3.2.3" data-path="bayes.html"><a href="bayes.html#the-normal-normal-model"><i class="fa fa-check"></i><b>3.2.3</b> The Normal-normal model</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="bayes.html"><a href="bayes.html#summary-of-conjugate-priors-models"><i class="fa fa-check"></i><b>3.3</b> Summary of Conjugate priors &amp; models</a></li>
<li class="chapter" data-level="3.4" data-path="bayes.html"><a href="bayes.html#why-bayesian-statistical-estimation-revisit"><i class="fa fa-check"></i><b>3.4</b> Why Bayesian: Statistical Estimation Revisit</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="bayes.html"><a href="bayes.html#classic-frequentist-inference"><i class="fa fa-check"></i><b>3.4.1</b> Classic Frequentist Inference</a></li>
<li class="chapter" data-level="3.4.2" data-path="bayes.html"><a href="bayes.html#bayesian-inference"><i class="fa fa-check"></i><b>3.4.2</b> Bayesian Inference</a></li>
<li class="chapter" data-level="" data-path="bayes.html"><a href="bayes.html#r-session-information-2"><i class="fa fa-check"></i>R Session information</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="Prior.html"><a href="Prior.html"><i class="fa fa-check"></i><b>4</b> Prior Distributions</a>
<ul>
<li class="chapter" data-level="4.1" data-path="Prior.html"><a href="Prior.html#choosing-priors"><i class="fa fa-check"></i><b>4.1</b> Choosing priors</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="Prior.html"><a href="Prior.html#eliciting-priors-from-experts"><i class="fa fa-check"></i><b>4.1.1</b> Eliciting priors from experts</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="Prior.html"><a href="Prior.html#default-clincial-priors"><i class="fa fa-check"></i><b>4.2</b> Default clincial priors</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="Prior.html"><a href="Prior.html#non-informative-or-reference-priors"><i class="fa fa-check"></i><b>4.2.1</b> “Non-informative” or “reference” priors</a></li>
<li class="chapter" data-level="4.2.2" data-path="Prior.html"><a href="Prior.html#minimally-informative-prior"><i class="fa fa-check"></i><b>4.2.2</b> Minimally informative prior</a></li>
<li class="chapter" data-level="4.2.3" data-path="Prior.html"><a href="Prior.html#skeptical-prior"><i class="fa fa-check"></i><b>4.2.3</b> Skeptical Prior</a></li>
<li class="chapter" data-level="4.2.4" data-path="Prior.html"><a href="Prior.html#optimisticenthusiastic-prior"><i class="fa fa-check"></i><b>4.2.4</b> Optimistic/enthusiastic Prior</a></li>
<li class="chapter" data-level="4.2.5" data-path="Prior.html"><a href="Prior.html#evaluating-priors"><i class="fa fa-check"></i><b>4.2.5</b> Evaluating Priors?</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="Prior.html"><a href="Prior.html#historical-data-meta-analysis"><i class="fa fa-check"></i><b>4.3</b> Historical data (meta-analysis)</a></li>
<li class="chapter" data-level="4.4" data-path="Prior.html"><a href="Prior.html#hierarchical-priors-and-shrinkage-priors"><i class="fa fa-check"></i><b>4.4</b> Hierarchical priors and shrinkage priors</a>
<ul>
<li class="chapter" data-level="" data-path="Prior.html"><a href="Prior.html#r-session-information-3"><i class="fa fa-check"></i>R Session information</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="BayesMCMC.html"><a href="BayesMCMC.html"><i class="fa fa-check"></i><b>5</b> Bayesian estimation with MCMC</a>
<ul>
<li class="chapter" data-level="5.1" data-path="BayesMCMC.html"><a href="BayesMCMC.html#introduction-to-markov-chain-monte-carlo-methods"><i class="fa fa-check"></i><b>5.1</b> Introduction to Markov Chain Monte Carlo Methods</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="BayesMCMC.html"><a href="BayesMCMC.html#gibbs-sampling"><i class="fa fa-check"></i><b>5.1.1</b> Gibbs sampling</a></li>
<li class="chapter" data-level="5.1.2" data-path="BayesMCMC.html"><a href="BayesMCMC.html#metropolis-algorithm"><i class="fa fa-check"></i><b>5.1.2</b> Metropolis algorithm</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="BayesMCMC.html"><a href="BayesMCMC.html#mcmc-diganostics---assess-convergence"><i class="fa fa-check"></i><b>5.2</b> MCMC diganostics - assess convergence</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="BayesMCMC.html"><a href="BayesMCMC.html#acceptance-rate"><i class="fa fa-check"></i><b>5.2.1</b> Acceptance Rate</a></li>
<li class="chapter" data-level="5.2.2" data-path="BayesMCMC.html"><a href="BayesMCMC.html#diagnostics-using-multiple-chains"><i class="fa fa-check"></i><b>5.2.2</b> Diagnostics Using Multiple Chains</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="BayesMCMC.html"><a href="BayesMCMC.html#example-bayesian-modelling-with-brms"><i class="fa fa-check"></i><b>5.3</b> Example Bayesian modelling with brms</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="BayesMCMC.html"><a href="BayesMCMC.html#example-bayesian-logistic-regression-model"><i class="fa fa-check"></i><b>5.3.1</b> Example Bayesian logistic regression model</a></li>
<li class="chapter" data-level="" data-path="BayesMCMC.html"><a href="BayesMCMC.html#r-session-information-4"><i class="fa fa-check"></i>R Session information</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="BayesReg1.html"><a href="BayesReg1.html"><i class="fa fa-check"></i><b>6</b> Bayesian Regression I</a>
<ul>
<li class="chapter" data-level="6.1" data-path="BayesReg1.html"><a href="BayesReg1.html#normal-models-and-linear-regression"><i class="fa fa-check"></i><b>6.1</b> Normal Models and Linear Regression</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="BayesReg1.html"><a href="BayesReg1.html#one-sample-and-two-sample-normal-regression"><i class="fa fa-check"></i><b>6.1.1</b> One-sample and two-sample normal regression</a></li>
<li class="chapter" data-level="6.1.2" data-path="BayesReg1.html"><a href="BayesReg1.html#linear-regression"><i class="fa fa-check"></i><b>6.1.2</b> Linear regression</a></li>
<li class="chapter" data-level="6.1.3" data-path="BayesReg1.html"><a href="BayesReg1.html#model-diagnostics"><i class="fa fa-check"></i><b>6.1.3</b> Model diagnostics</a></li>
<li class="chapter" data-level="6.1.4" data-path="BayesReg1.html"><a href="BayesReg1.html#model-comparision"><i class="fa fa-check"></i><b>6.1.4</b> Model comparision</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="BayesReg1.html"><a href="BayesReg1.html#hierarchical-models"><i class="fa fa-check"></i><b>6.2</b> Hierarchical models</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="BayesReg1.html"><a href="BayesReg1.html#clustered-data-multi-level"><i class="fa fa-check"></i><b>6.2.1</b> Clustered data (Multi-level)</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="BayesReg1.html"><a href="BayesReg1.html#regression-regularization"><i class="fa fa-check"></i><b>6.3</b> Regression regularization</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="BayesReg1.html"><a href="BayesReg1.html#shrinkage-priors-in-action"><i class="fa fa-check"></i><b>6.3.1</b> Shrinkage Priors in action</a></li>
<li class="chapter" data-level="6.3.2" data-path="BayesReg1.html"><a href="BayesReg1.html#bayesian-logistic-regression-model-cope-example-revisit"><i class="fa fa-check"></i><b>6.3.2</b> Bayesian logistic regression model (COPE example revisit)</a></li>
<li class="chapter" data-level="" data-path="BayesReg1.html"><a href="BayesReg1.html#r-session-information-5"><i class="fa fa-check"></i>R Session information</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="BayesReg2.html"><a href="BayesReg2.html"><i class="fa fa-check"></i><b>7</b> Bayesian Regression II</a>
<ul>
<li class="chapter" data-level="7.1" data-path="BayesReg2.html"><a href="BayesReg2.html#models-for-binary-data"><i class="fa fa-check"></i><b>7.1</b> Models for Binary Data</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="BayesReg2.html"><a href="BayesReg2.html#logistic-regression-with-predictor"><i class="fa fa-check"></i><b>7.1.1</b> Logistic regression with predictor</a></li>
<li class="chapter" data-level="7.1.2" data-path="BayesReg2.html"><a href="BayesReg2.html#centring-continous-variable"><i class="fa fa-check"></i><b>7.1.2</b> Centring continous variable</a></li>
<li class="chapter" data-level="7.1.3" data-path="BayesReg2.html"><a href="BayesReg2.html#hierarchical-model-revisit"><i class="fa fa-check"></i><b>7.1.3</b> hierarchical model revisit</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="BayesReg2.html"><a href="BayesReg2.html#models-for-count-data"><i class="fa fa-check"></i><b>7.2</b> Models for Count Data</a>
<ul>
<li class="chapter" data-level="" data-path="BayesReg2.html"><a href="BayesReg2.html#r-session-information-6"><i class="fa fa-check"></i>R Session information</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="BayesMeta.html"><a href="BayesMeta.html"><i class="fa fa-check"></i><b>8</b> Bayesian Meta-Analysis</a>
<ul>
<li class="chapter" data-level="8.1" data-path="BayesMeta.html"><a href="BayesMeta.html#introduction"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="BayesMeta.html"><a href="BayesMeta.html#bayesian-inference-1"><i class="fa fa-check"></i><b>8.2</b> Bayesian inference</a></li>
<li class="chapter" data-level="8.3" data-path="BayesMeta.html"><a href="BayesMeta.html#continuous-data"><i class="fa fa-check"></i><b>8.3</b> Continuous data</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="BayesMeta.html"><a href="BayesMeta.html#fitting-a-ma-with-brms"><i class="fa fa-check"></i><b>8.3.1</b> Fitting a MA with brms</a></li>
<li class="chapter" data-level="8.3.2" data-path="BayesMeta.html"><a href="BayesMeta.html#meta-regression"><i class="fa fa-check"></i><b>8.3.2</b> Meta-regression</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="BayesMeta.html"><a href="BayesMeta.html#other-types-of-data"><i class="fa fa-check"></i><b>8.4</b> Other types of data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a> <a href="https://www.kuan-liu.com/" target="blank">Developed by Kuan Liu</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">HAD5314H - Applied Bayesian Methods in Clinical Epidemiology and Health Care Research</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="BayesReg2" class="section level1" number="7">
<h1><span class="header-section-number">Session 7</span> Bayesian Regression II</h1>
<div class="chapterintro">
<ul>
<li>Learn how to fit and interpret Bayesian logistic regression</li>
<li>Learn how to fit and interpret Bayesian poisson and negative binomial regression</li>
<li>Reviewing hierarchical model: generalized mixed-effect models</li>
</ul>
</div>
<script src="hideOutput.js"></script>
<p></br></p>
<div id="models-for-binary-data" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Models for Binary Data</h2>
<ul>
<li>For binary outcome Y, we are interested to model the probability of <span class="math inline">\(\pi_i = P(Y_i=1)\)</span>, <span class="math inline">\(i=1, \ldots, n\)</span></li>
</ul>
<p><span class="math display">\[Y_i \mid \pi_i \sim Bern(\pi_i)\]</span>
<span class="math display">\[ E(Y_i \mid \pi_i) = \pi_i\]</span>
<span class="math display">\[logit( \pi_i) = \beta_0 + \beta_1 X_{i1}\]</span></p>
<ul>
<li><p><strong>logistic regression model</strong> featuring logit link that connects binary outcome to a conventional linear regression format, is part of the broader class of <strong>generalized linear models</strong></p></li>
<li><p>Logit link convert probabilities to log odds.</p></li>
</ul>
<p><span class="math display">\[\log(\frac{\pi_i}{1-\pi_i}) = \log(\frac{P(Y_i=1)}{1- P(Y_i=1)})\]</span></p>
<p><span class="math display">\[\log(\frac{\pi_i}{1-\pi_i}) = \beta_0 + \beta_1 X_{i1}\]</span></p>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-145-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="important">
<p><strong>Logistic regression model</strong></p>
<ul>
<li>Consider the logistic regression model <span class="math inline">\(Y\)</span> with covariates <span class="math inline">\(X_i, \ldots, X_p\)</span>:</li>
</ul>
<p><span class="math display">\[ \log(\frac{\pi_i}{1-\pi_i}) =  \beta_0 + \beta_1 X_{i1} + \ldots + \beta_p X_{ip} \]</span></p>
<ul>
<li><p>logistic regression coefficients is interpreted as log odds ratio!</p></li>
<li><p>Furthermore, we can recalculate probability using the inverse logit function (aka, expit function)</p></li>
</ul>
<p><span class="math display">\[\pi_i = \frac{\exp(\beta_0 + \beta_1 X_{i1} + \ldots + \beta_1 X_{ip})}{1+\exp(\beta_0 + \beta_1 X_{i1} + \ldots + \beta_p X_{ip})}\]</span></p>
<ul>
<li>Assumptions of logistic regression models
<ol style="list-style-type: decimal">
<li><strong>Independent observations</strong>. This assumption can be modified if working with clustered data.</li>
<li><strong>Linear relationship between continous covariates and log-odds</strong> We can check this assumption by examining marginal plots comparing the model predicted relationship between outcome (log-odds or logit-probability) and each continuous covariates.</li>
<li><strong>Multicollinearity</strong> Multicollinearity is the phenomenon when a number of the explanatory variables are strongly correlated.</li>
<li><strong>Correctly specified regression model</strong> This means that all relevant predictors for the response variable have been included in the model. This is often difficult to verify, but we can use posterior predictive distribution to check for regression fit. We can also use WAIC and LOO to compare different models.</li>
</ol></li>
<li>Comparing to linear regression model we no-longer require the residuals to be normally distributed and homoscedasticity.</li>
</ul>
</div>
<p><strong>Diagnostic Sensitivity Example</strong></p>
<ul>
<li><p>10 studies taken from <span class="citation">(<a href="#ref-bastos2020diagnostic" role="doc-biblioref">Bastos et al. 2020</a>)</span> on <a href="https://www.bmj.com/content/370/bmj.m2516">Diagnostic accuracy of serological tests for covid-19: systematic review and meta-analysis. BMJ. 2020</a></p></li>
<li><p>Each study reports observed positive chemiluminescent immunoassa (CLIA, <span class="math inline">\(r_i\)</span>) and number having positive reference standard reverse transcriptase polymerase chain reaction (RT-PCR, <span class="math inline">\(n_i\)</span>)</p></li>
<li><p>Interest lies in summarizing this collection of values</p></li>
</ul>
<div id="htmlwidget-1a4a822a431715cae238" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1a4a822a431715cae238">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10"],["Lin","Ma","Cai","Infantino","Zhong","Jin","Xie","Yangchun","Qian","Lou"],[65,209,158,44,46,13,15,144,432,69],[79,216,276,61,47,27,16,205,503,80],[69,74,49,62,71,63,80,64,74,58]],"container":"<table class=\"compact\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Study<\/th>\n      <th>r<\/th>\n      <th>n<\/th>\n      <th>age<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","ordering":false,"paging":false,"searching":false,"columnDefs":[{"className":"dt-center","targets":[0,1,2,3]},{"className":"dt-right","targets":4},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><strong>Unpooled</strong></p>
<ul>
<li>recall from last week, We can assume a binomial likelihood for each study (unpooled),</li>
</ul>
<p><span class="math display">\[r_i \sim Bin(p_i, n_i)  \]</span></p>
<ul>
<li><p>we can assume that the 10 true sensitivities <span class="math inline">\(p_i\)</span> are independent by fitting different prior to each one:
<span class="math display">\[p_i \sim Beta(1,1)\]</span></p></li>
<li><p>we will obtain 10 separate posteriors <span class="math inline">\(P(p_i \mid r_i, n_i)\)</span></p>
<ul>
<li>For example, we do not assume that <span class="math inline">\(p_1\)</span> tells us anything about the value of <span class="math inline">\(p_2\)</span></li>
</ul></li>
</ul>
<p><strong>Pooled</strong></p>
<ul>
<li>Suppose we wanted to estimate the overall sensitivity of the CLIA test
<ul>
<li>We do not want 10 separate estimates but a single estimate</li>
</ul></li>
<li>If we thought that the studies all had the same true sensitivity p0, we could fit a model like this:</li>
</ul>
<ol style="list-style-type: decimal">
<li>Assume a binomial likelihood for each study</li>
</ol>
<p><span class="math display">\[r_i \sim Bin(p_i, n_i) \]</span></p>
<ol start="2" style="list-style-type: decimal">
<li><p>Assume that all studies have the same true sensitivity, <span class="math inline">\(p_0\)</span>:
<span class="math display">\[ p_i = p_0\]</span></p></li>
<li><p>Put a prior on <span class="math inline">\(p_0\)</span>: <span class="math inline">\(p_0 \sim Beta(1,1)\)</span></p></li>
</ol>
<p><strong>Different prior on <span class="math inline">\(p_0\)</span></strong></p>
<ul>
<li><p>The beta prior is useful for models with little additional structure</p>
<ul>
<li>e.g., estimating a single proportion; estimating a collection of proportions</li>
</ul></li>
<li><p>It is difficult to use it to a model, where we want to include predictors of <span class="math inline">\(p_i\)</span></p></li>
<li><p>For most modelling approaches to binary data, we will use</p>
<ul>
<li>the logit transformation of <span class="math inline">\(p_i\)</span></li>
<li>normal priors for parameters on this logit scale (e.g., normal prior for log-odds)</li>
</ul></li>
</ul>
<p><strong>Logistic models</strong></p>
<ul>
<li><p>We still have the same likelihood <span class="math inline">\(r_i \sim Bin(p_i, n_i)\)</span></p></li>
<li><p>We define a new parameter using the logit transformation function:</p></li>
</ul>
<p><span class="math display">\[logit(p_i) = log(\frac{p_i}{1-p_i}) = \alpha_i\]</span>
<span class="math display">\[p_i = \frac{\exp(\alpha_i)}{1+\exp(\alpha_i)}\]</span></p>
<ul>
<li><p><span class="math inline">\(0&lt;p_i&lt;1 \Rightarrow -\infty &lt; \alpha_i &lt; \infty\)</span></p></li>
<li><p>Thus, it’s quite reasonable to use normal prior to characterize <span class="math inline">\(\alpha_i\)</span></p></li>
</ul>
<div class="guidedexercise">
<p><strong>1. Pooled model with non-informative prior</strong></p>
<p><span class="math display">\[r_i \mid p_i, n_i \sim Bin(p_i, n_i)\]</span>
<span class="math display">\[log(\frac{p_i}{1-p_i}) = \alpha\]</span>
<span class="math display">\[\alpha \sim N(0, \sigma = 5)\]</span></p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="BayesReg2.html#cb178-1" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">brm</span>(r <span class="sc">|</span> <span class="fu">trials</span>(n) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb178-2"><a href="BayesReg2.html#cb178-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat,</span>
<span id="cb178-3"><a href="BayesReg2.html#cb178-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">5</span>), <span class="at">class=</span>Intercept),</span>
<span id="cb178-4"><a href="BayesReg2.html#cb178-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb178-5"><a href="BayesReg2.html#cb178-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>)</span></code></pre></div>
<p><strong>2. Unpooled model with non-informative prior</strong></p>
<p><span class="math display">\[r_i \mid p_i, n_i \sim Bin(p_i, n_i)\]</span>
<span class="math display">\[log(\frac{p_i}{1-p_i}) = \alpha + \beta_i \ \text{Study}_i\]</span>
<span class="math display">\[\alpha \sim N(0, \sigma = 5)\]</span>
<span class="math display">\[\beta_i \sim N(0, \sigma = 5)\]</span></p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="BayesReg2.html#cb179-1" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">brm</span>(r <span class="sc">|</span> <span class="fu">trials</span>(n) <span class="sc">~</span> Study,</span>
<span id="cb179-2"><a href="BayesReg2.html#cb179-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat,</span>
<span id="cb179-3"><a href="BayesReg2.html#cb179-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span>  <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb179-4"><a href="BayesReg2.html#cb179-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="at">class =</span> b)),</span>
<span id="cb179-5"><a href="BayesReg2.html#cb179-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb179-6"><a href="BayesReg2.html#cb179-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>)</span></code></pre></div>
</div>
<p><strong>Generalized linear models</strong></p>
<p>We can specify the type of model by two features
- Family: type of outcome (binomial, normal, Poisson, gamma)
- Link: relationship between mean parameter and predictor (identity, logic, log)</p>
<ul>
<li>we have models in the form</li>
</ul>
<p><span class="math display">\[ Y_i \sim Dist(\mu_i, \tau)\]</span>
<span class="math display">\[g(\mu_i) = \beta_0 + \beta_1 X_{i1} + \ldots + \beta_1 X_{ip}\]</span></p>
<ul>
<li><p><span class="math inline">\(g()\)</span> is called the link function</p></li>
<li><p>Distributions family (<a href="https://en.wikipedia.org/wiki/Exponential_family">exponential family</a>) can be specified as Normal, Poisson, Binomial, Bernoulli, etc.</p></li>
<li><p>Usually, we use the logit for binary data and gets odds ratios (logistic model)</p>
<ul>
<li>If we use the log link, we can estimate relative risks</li>
</ul></li>
</ul>
<div class="workedexample">
<p><strong>Sample from priors in brms</strong></p>
<ul>
<li><p>We can specify in brms to generate samples from our specified prior as part of the output</p></li>
<li><p>we can use these prior samples</p>
<ol style="list-style-type: decimal">
<li>to compare with the posteriors to see how much the prior is updated by the data</li>
<li>to check what information is in the prior</li>
</ol></li>
<li><p>using the pooled model as an example</p></li>
</ul>
<p><span class="math display">\[r_i \mid p_i, n_i \sim Bin(p_i, n_i)\]</span>
<span class="math display">\[log(\frac{p_i}{1-p_i}) = \alpha\]</span>
<span class="math display">\[\alpha \sim  N(0, \sigma = 5)\]</span></p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="BayesReg2.html#cb180-1" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">brm</span>(r <span class="sc">|</span> <span class="fu">trials</span>(n) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb180-2"><a href="BayesReg2.html#cb180-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat,</span>
<span id="cb180-3"><a href="BayesReg2.html#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">5</span>), <span class="at">class=</span>Intercept),</span>
<span id="cb180-4"><a href="BayesReg2.html#cb180-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb180-5"><a href="BayesReg2.html#cb180-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> T, <span class="co">#asking brms to generate prior sample!</span></span>
<span id="cb180-6"><a href="BayesReg2.html#cb180-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb180-7"><a href="BayesReg2.html#cb180-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-8"><a href="BayesReg2.html#cb180-8" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(fit1, &quot;data/chap8_binary_1&quot;)</span></span></code></pre></div>
<ul>
<li>checking posterior results
<ul>
<li>computing posterior predicted probability of event (in this case the sensitivity of the CLIA test)</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="BayesReg2.html#cb181-1" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/chap8_binary_1&quot;</span>)</span>
<span id="cb181-2"><a href="BayesReg2.html#cb181-2" aria-hidden="true" tabindex="-1"></a><span class="co">#posterior draws of log-odds estimate - the intercept;</span></span>
<span id="cb181-3"><a href="BayesReg2.html#cb181-3" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(fit1)</span>
<span id="cb181-4"><a href="BayesReg2.html#cb181-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-5"><a href="BayesReg2.html#cb181-5" aria-hidden="true" tabindex="-1"></a><span class="co">#posterior predicted probability of event;</span></span>
<span id="cb181-6"><a href="BayesReg2.html#cb181-6" aria-hidden="true" tabindex="-1"></a>prob.pooled <span class="ot">&lt;-</span> <span class="fu">exp</span>(posterior<span class="sc">$</span>b_Intercept)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(posterior<span class="sc">$</span>b_Intercept))</span>
<span id="cb181-7"><a href="BayesReg2.html#cb181-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-8"><a href="BayesReg2.html#cb181-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(prob.pooled)</span></code></pre></div>
<pre><code>## [1] 0.7911867</code></pre>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="BayesReg2.html#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(prob.pooled, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span></code></pre></div>
<pre><code>##      2.5%     97.5% 
## 0.7711065 0.8113482</code></pre>
<ul>
<li>what does the posterior output look like?</li>
</ul>
<div id="htmlwidget-9a142a643e106a10c99e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-9a142a643e106a10c99e">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6"],[1.34592610873223,1.28454906759518,1.34415950154907,1.39184540970402,1.39689495369213,1.32974744917099],[0.391327893705283,-7.03789425274545,-6.81959053190196,-3.49244487623223,4.67425712259199,-0.535442413567366],[-115.626854682742,-115.903290885414,-115.621618509316,-116.0315926807,-116.107346004985,-115.607857181895]],"container":"<table class=\"compact\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>b_Intercept<\/th>\n      <th>prior_Intercept<\/th>\n      <th>lp__<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","ordering":false,"paging":false,"searching":false,"columnDefs":[{"className":"dt-center","targets":[0,1,2]},{"className":"dt-right","targets":3},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<ul>
<li>comparing prior and posterior distribution visually</li>
</ul>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="BayesReg2.html#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">Probability =</span> <span class="fu">c</span>(<span class="fu">inv_logit_scaled</span>(posterior[,<span class="st">&quot;b_Intercept&quot;</span>]),</span>
<span id="cb185-2"><a href="BayesReg2.html#cb185-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">inv_logit_scaled</span>(posterior[,<span class="st">&quot;prior_Intercept&quot;</span>])),</span>
<span id="cb185-3"><a href="BayesReg2.html#cb185-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">Type=</span><span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Posterior&quot;</span>,<span class="st">&quot;Prior&quot;</span>),<span class="at">each=</span><span class="fu">nrow</span>(posterior))) <span class="sc">%&gt;%</span></span>
<span id="cb185-4"><a href="BayesReg2.html#cb185-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Probability,<span class="at">fill=</span>Type))<span class="sc">+</span></span>
<span id="cb185-5"><a href="BayesReg2.html#cb185-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">size=</span><span class="dv">1</span>,<span class="at">alpha=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb185-6"><a href="BayesReg2.html#cb185-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Prior: alpha ~ N(0,5); probability = exp(alpha)/(1+exp(alpha))&quot;</span>)<span class="sc">+</span></span>
<span id="cb185-7"><a href="BayesReg2.html#cb185-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb185-8"><a href="BayesReg2.html#cb185-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;goldenrod&quot;</span>,<span class="st">&quot;steelblue&quot;</span>))</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-152-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="logistic-regression-with-predictor" class="section level3" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> Logistic regression with predictor</h3>
<ul>
<li><p>Adding one predictor, age, for each study in modelling CLIA sensitivity</p></li>
<li><p>We have the following Bayesian model</p></li>
</ul>
<p><span class="math display">\[r_i \mid p_i, n_i \sim Bin(p_i, n_i)\]</span>
<span class="math display">\[log(\frac{p_i}{1-p_i}) = \alpha + \beta \ age_i\]</span>
<span class="math display">\[\alpha \sim  N(0, \sigma = 5)\]</span>
<span class="math display">\[\beta \sim  N(0, \sigma = 5)\]</span></p>
<ul>
<li><span class="math inline">\(\beta\)</span> is interpreted as the changes on the log-OR associate 1 unit increase in age.</li>
</ul>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="BayesReg2.html#cb186-1" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">brm</span>(r <span class="sc">|</span> <span class="fu">trials</span>(n) <span class="sc">~</span> age,</span>
<span id="cb186-2"><a href="BayesReg2.html#cb186-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat,</span>
<span id="cb186-3"><a href="BayesReg2.html#cb186-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb186-4"><a href="BayesReg2.html#cb186-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="at">class =</span> b)),</span>
<span id="cb186-5"><a href="BayesReg2.html#cb186-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb186-6"><a href="BayesReg2.html#cb186-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">10000</span>,</span>
<span id="cb186-7"><a href="BayesReg2.html#cb186-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">warmup =</span> <span class="dv">8000</span>,</span>
<span id="cb186-8"><a href="BayesReg2.html#cb186-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb186-9"><a href="BayesReg2.html#cb186-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb186-10"><a href="BayesReg2.html#cb186-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-11"><a href="BayesReg2.html#cb186-11" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(fit3, &quot;data/chap8_binary_3&quot;)</span></span></code></pre></div>
<ul>
<li>checking posterior results
<ul>
<li>computing posterior predicted probability of event (in this case the sensitivity of the CLIA test)</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="BayesReg2.html#cb187-1" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/chap8_binary_3&quot;</span>)</span>
<span id="cb187-2"><a href="BayesReg2.html#cb187-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-3"><a href="BayesReg2.html#cb187-3" aria-hidden="true" tabindex="-1"></a><span class="co">#posterior draws of log-odds estimate - the intercept;</span></span>
<span id="cb187-4"><a href="BayesReg2.html#cb187-4" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(fit3)</span>
<span id="cb187-5"><a href="BayesReg2.html#cb187-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-6"><a href="BayesReg2.html#cb187-6" aria-hidden="true" tabindex="-1"></a><span class="co"># beta posterior summary</span></span>
<span id="cb187-7"><a href="BayesReg2.html#cb187-7" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">mean</span>(posterior<span class="sc">$</span>b_age))</span></code></pre></div>
<pre><code>## [1] 1.033364</code></pre>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="BayesReg2.html#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">quantile</span>(posterior<span class="sc">$</span>b_age, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)))</span></code></pre></div>
<pre><code>##     2.5%    97.5% 
## 1.014490 1.052855</code></pre>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="BayesReg2.html#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co">#posterior predicted probability testing positive for each study;</span></span>
<span id="cb191-2"><a href="BayesReg2.html#cb191-2" aria-hidden="true" tabindex="-1"></a>pp<span class="ot">&lt;-</span><span class="fu">posterior_predict</span>(fit3)</span>
<span id="cb191-3"><a href="BayesReg2.html#cb191-3" aria-hidden="true" tabindex="-1"></a>mean.pp<span class="ot">&lt;-</span><span class="fu">colMeans</span>(pp)<span class="sc">/</span>dat<span class="sc">$</span>n</span>
<span id="cb191-4"><a href="BayesReg2.html#cb191-4" aria-hidden="true" tabindex="-1"></a>lci.pp<span class="ot">&lt;-</span> <span class="fu">apply</span>(pp, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">quantile</span>(x, <span class="fl">0.025</span>))<span class="sc">/</span>dat<span class="sc">$</span>n</span>
<span id="cb191-5"><a href="BayesReg2.html#cb191-5" aria-hidden="true" tabindex="-1"></a>uci.pp<span class="ot">&lt;-</span> <span class="fu">apply</span>(pp, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">quantile</span>(x, <span class="fl">0.975</span>))<span class="sc">/</span>dat<span class="sc">$</span>n</span>
<span id="cb191-6"><a href="BayesReg2.html#cb191-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-7"><a href="BayesReg2.html#cb191-7" aria-hidden="true" tabindex="-1"></a>pp.table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Study =</span> dat<span class="sc">$</span>Study, </span>
<span id="cb191-8"><a href="BayesReg2.html#cb191-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">r =</span> dat<span class="sc">$</span>r, </span>
<span id="cb191-9"><a href="BayesReg2.html#cb191-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">n =</span> dat<span class="sc">$</span>n,</span>
<span id="cb191-10"><a href="BayesReg2.html#cb191-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Prob_obs =</span> <span class="fu">round</span>(dat<span class="sc">$</span>r<span class="sc">/</span>dat<span class="sc">$</span>n,<span class="dv">2</span>),</span>
<span id="cb191-11"><a href="BayesReg2.html#cb191-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Prob_post =</span> <span class="fu">round</span>(mean.pp,<span class="dv">2</span>),</span>
<span id="cb191-12"><a href="BayesReg2.html#cb191-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">CI_post =</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>,<span class="fu">round</span>(lci.pp,<span class="dv">2</span>),<span class="st">&quot;,&quot;</span>,<span class="fu">round</span>(uci.pp,<span class="dv">2</span>),<span class="st">&quot;)&quot;</span>))</span>
<span id="cb191-13"><a href="BayesReg2.html#cb191-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-14"><a href="BayesReg2.html#cb191-14" aria-hidden="true" tabindex="-1"></a>pp.table <span class="sc">%&gt;%</span> </span>
<span id="cb191-15"><a href="BayesReg2.html#cb191-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(</span>
<span id="cb191-16"><a href="BayesReg2.html#cb191-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> F,</span>
<span id="cb191-17"><a href="BayesReg2.html#cb191-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">&quot;compact&quot;</span>,</span>
<span id="cb191-18"><a href="BayesReg2.html#cb191-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb191-19"><a href="BayesReg2.html#cb191-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">&#39;t&#39;</span>,</span>
<span id="cb191-20"><a href="BayesReg2.html#cb191-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">ordering =</span> <span class="cn">FALSE</span>,</span>
<span id="cb191-21"><a href="BayesReg2.html#cb191-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">paging =</span> <span class="cn">FALSE</span>,</span>
<span id="cb191-22"><a href="BayesReg2.html#cb191-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">searching =</span> <span class="cn">FALSE</span>,</span>
<span id="cb191-23"><a href="BayesReg2.html#cb191-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">className =</span> <span class="st">&#39;dt-center&#39;</span>, </span>
<span id="cb191-24"><a href="BayesReg2.html#cb191-24" aria-hidden="true" tabindex="-1"></a>                      <span class="at">targets =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>))))</span></code></pre></div>
<div id="htmlwidget-d8c7a4f21cda58d5fae3" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-d8c7a4f21cda58d5fae3">{"x":{"filter":"none","vertical":false,"data":[["Lin","Ma","Cai","Infantino","Zhong","Jin","Xie","Yangchun","Qian","Lou"],[65,209,158,44,46,13,15,144,432,69],[79,216,276,61,47,27,16,205,503,80],[0.82,0.97,0.57,0.72,0.98,0.48,0.94,0.7,0.86,0.86],[0.85,0.79,0.78,0.77,0.88,0.65,0.85,0.81,0.77,0.84],["(0.76,0.94)","(0.74,0.85)","(0.73,0.84)","(0.66,0.87)","(0.77,0.98)","(0.44,0.85)","(0.69,1)","(0.76,0.87)","(0.72,0.81)","(0.75,0.92)"]],"container":"<table class=\"compact\">\n  <thead>\n    <tr>\n      <th>Study<\/th>\n      <th>r<\/th>\n      <th>n<\/th>\n      <th>Prob_obs<\/th>\n      <th>Prob_post<\/th>\n      <th>CI_post<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","ordering":false,"paging":false,"searching":false,"columnDefs":[{"className":"dt-center","targets":[0,1,2,3,4,5]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="centring-continous-variable" class="section level3" number="7.1.2">
<h3><span class="header-section-number">7.1.2</span> Centring continous variable</h3>
<ul>
<li>our model says that sensitivity is different across studies according to the average age</li>
</ul>
<p><span class="math display">\[P(\text{test positive}) = \frac{\exp(\alpha + \beta \ age)}{1+ \exp(\alpha + \beta \ age)}\]</span></p>
<ul>
<li>We could obtain a prediction at the average of the ages <code>mean(dat$age)</code> across the studies</li>
</ul>
<p><span class="math display">\[P(\text{test positive}) = \frac{\exp(\alpha + \beta \times mean( age))}{1+ \exp(\alpha + \beta \times mean( age))}\]</span></p>
<ul>
<li>We could “centre” age at its average so that the intercept refers to the probability at the average age</li>
</ul>
<p><span class="math display">\[r_i \mid p_i, n_i \sim Bin(p_i, n_i)\]</span>
<span class="math display">\[log(\frac{p_i}{1-p_i}) = \alpha + \beta (\ age_i - mean(age))\]</span>
<span class="math display">\[\alpha \sim  N(0, \sigma = 5)\]</span>
<span class="math display">\[\beta \sim  N(0, \sigma = 5)\]</span></p>
<ul>
<li>Using a centred predictor also reduces correlation between intercept and slope. <strong>This can speed up MCMC convergence in some models (computationally more efficient).</strong></li>
</ul>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="BayesReg2.html#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="co">#centring variable age;</span></span>
<span id="cb192-2"><a href="BayesReg2.html#cb192-2" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>age.c <span class="ot">&lt;-</span> dat<span class="sc">$</span>age <span class="sc">-</span> <span class="fu">mean</span>(dat<span class="sc">$</span>age)</span>
<span id="cb192-3"><a href="BayesReg2.html#cb192-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-4"><a href="BayesReg2.html#cb192-4" aria-hidden="true" tabindex="-1"></a>fit3c <span class="ot">&lt;-</span> <span class="fu">brm</span>(r <span class="sc">|</span> <span class="fu">trials</span>(n) <span class="sc">~</span> age.c,</span>
<span id="cb192-5"><a href="BayesReg2.html#cb192-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>dat,</span>
<span id="cb192-6"><a href="BayesReg2.html#cb192-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb192-7"><a href="BayesReg2.html#cb192-7" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="at">class =</span> b)),</span>
<span id="cb192-8"><a href="BayesReg2.html#cb192-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> binomial,</span>
<span id="cb192-9"><a href="BayesReg2.html#cb192-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">iter =</span> <span class="dv">5000</span>,</span>
<span id="cb192-10"><a href="BayesReg2.html#cb192-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">warmup =</span> <span class="dv">3000</span>,</span>
<span id="cb192-11"><a href="BayesReg2.html#cb192-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb192-12"><a href="BayesReg2.html#cb192-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb192-13"><a href="BayesReg2.html#cb192-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-14"><a href="BayesReg2.html#cb192-14" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(fit3c, &quot;data/chap8_binary_3c&quot;)</span></span></code></pre></div>
<ul>
<li>comparing posterior distribution between centred and uncentred models</li>
</ul>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="BayesReg2.html#cb193-1" aria-hidden="true" tabindex="-1"></a>fit3c <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/chap8_binary_3c&quot;</span>)</span>
<span id="cb193-2"><a href="BayesReg2.html#cb193-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-3"><a href="BayesReg2.html#cb193-3" aria-hidden="true" tabindex="-1"></a><span class="co">#posterior draws of log-odds estimate - the intercept;</span></span>
<span id="cb193-4"><a href="BayesReg2.html#cb193-4" aria-hidden="true" tabindex="-1"></a>posteriorc <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(fit3c)</span>
<span id="cb193-5"><a href="BayesReg2.html#cb193-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-6"><a href="BayesReg2.html#cb193-6" aria-hidden="true" tabindex="-1"></a><span class="co"># beta posterior summary</span></span>
<span id="cb193-7"><a href="BayesReg2.html#cb193-7" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">mean</span>(posteriorc<span class="sc">$</span>b_age))</span></code></pre></div>
<pre><code>## [1] 1.033516</code></pre>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="BayesReg2.html#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">quantile</span>(posteriorc<span class="sc">$</span>b_age, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)))</span></code></pre></div>
<pre><code>##     2.5%    97.5% 
## 1.014934 1.052328</code></pre>
<ul>
<li><p>posterior predicted probability testing positive for each study comparing between the centred and uncentred models</p></li>
<li><p>we can see the results are almost <em>identical</em> and we achieved this with only 5000 iterations for the centred model.</p></li>
</ul>
<div id="htmlwidget-6cc1c1fdf7264a768bab" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-6cc1c1fdf7264a768bab">{"x":{"filter":"none","vertical":false,"data":[["Lin","Ma","Cai","Infantino","Zhong","Jin","Xie","Yangchun","Qian","Lou"],[0.82,0.97,0.57,0.72,0.98,0.48,0.94,0.7,0.86,0.86],[0.85,0.79,0.78,0.77,0.88,0.65,0.85,0.81,0.77,0.84],["(0.76,0.94)","(0.74,0.85)","(0.73,0.84)","(0.66,0.87)","(0.77,0.98)","(0.44,0.85)","(0.69,1)","(0.76,0.87)","(0.72,0.81)","(0.75,0.92)"],[0.85,0.79,0.78,0.77,0.88,0.65,0.85,0.81,0.77,0.84],["(0.76,0.94)","(0.74,0.85)","(0.73,0.84)","(0.66,0.87)","(0.77,0.98)","(0.44,0.85)","(0.69,1)","(0.76,0.87)","(0.72,0.81)","(0.75,0.92)"]],"container":"<table class=\"compact\">\n  <thead>\n    <tr>\n      <th>Study<\/th>\n      <th>Prob_obs<\/th>\n      <th>Prob_post<\/th>\n      <th>CI_post<\/th>\n      <th>c_Prob_post<\/th>\n      <th>c_CI_post<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","ordering":false,"paging":false,"searching":false,"columnDefs":[{"className":"dt-center","targets":[0,1,2,3,4,5]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<ul>
<li><p>we can investigate the correlation between two posterior regression parameters, <span class="math inline">\(\alpha\)</span> (intercept) and <span class="math inline">\(\beta\)</span> (log-OR for age).</p></li>
<li><p>The two parameters should be uncorrelated by model assumption! If you see visible correlation, you can consider thinning your MCMC or run more iterations.</p></li>
</ul>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="BayesReg2.html#cb197-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(posterior, </span>
<span id="cb197-2"><a href="BayesReg2.html#cb197-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(b_Intercept, b_age))<span class="sc">+</span></span>
<span id="cb197-3"><a href="BayesReg2.html#cb197-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span>.<span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb197-4"><a href="BayesReg2.html#cb197-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb197-5"><a href="BayesReg2.html#cb197-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Uncentred age&quot;</span>)</span>
<span id="cb197-6"><a href="BayesReg2.html#cb197-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-7"><a href="BayesReg2.html#cb197-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(posteriorc, <span class="fu">aes</span>(b_Intercept, b_age.c))<span class="sc">+</span></span>
<span id="cb197-8"><a href="BayesReg2.html#cb197-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.25</span>)<span class="sc">+</span></span>
<span id="cb197-9"><a href="BayesReg2.html#cb197-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb197-10"><a href="BayesReg2.html#cb197-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Centred age&quot;</span>)</span>
<span id="cb197-11"><a href="BayesReg2.html#cb197-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-12"><a href="BayesReg2.html#cb197-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(p1,p2, <span class="at">nrow=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-158-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li>Model diagnostics</li>
</ul>
<ol style="list-style-type: decimal">
<li>Posterior predictive graphic check for model fit</li>
</ol>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="BayesReg2.html#cb198-1" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span><span class="fu">pp_check</span>(fit3c, <span class="at">ndraws =</span> <span class="dv">50</span>)</span>
<span id="cb198-2"><a href="BayesReg2.html#cb198-2" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">&lt;-</span><span class="fu">pp_check</span>(fit3c, <span class="at">type =</span> <span class="st">&quot;stat_2d&quot;</span>, <span class="at">stat =</span> <span class="fu">c</span>(<span class="st">&quot;max&quot;</span>, <span class="st">&quot;min&quot;</span>))</span>
<span id="cb198-3"><a href="BayesReg2.html#cb198-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(p1,p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-159-1.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Checking for model fitted marginal effect of age on probability of testing positive versus crude observed probability of testing positive</li>
</ol>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="BayesReg2.html#cb199-1" aria-hidden="true" tabindex="-1"></a>plot.dat <span class="ot">&lt;-</span> fit3c<span class="sc">$</span>data</span>
<span id="cb199-2"><a href="BayesReg2.html#cb199-2" aria-hidden="true" tabindex="-1"></a>post_mu <span class="ot">&lt;-</span> <span class="fu">fitted</span>(fit3c, <span class="at">scale =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb199-3"><a href="BayesReg2.html#cb199-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(post_mu) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;mu&quot;</span>, <span class="st">&quot;mu_se&quot;</span>, <span class="st">&quot;lwr_ci&quot;</span>, <span class="st">&quot;upr_ci&quot;</span>)</span>
<span id="cb199-4"><a href="BayesReg2.html#cb199-4" aria-hidden="true" tabindex="-1"></a>df_plot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(plot.dat, post_mu)</span>
<span id="cb199-5"><a href="BayesReg2.html#cb199-5" aria-hidden="true" tabindex="-1"></a>df_plot <span class="ot">&lt;-</span> df_plot <span class="sc">%&gt;%</span></span>
<span id="cb199-6"><a href="BayesReg2.html#cb199-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">mutate</span>(<span class="at">prob_obs =</span> r<span class="sc">/</span>n,</span>
<span id="cb199-7"><a href="BayesReg2.html#cb199-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">prob_est =</span> mu<span class="sc">/</span>n,</span>
<span id="cb199-8"><a href="BayesReg2.html#cb199-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">prob_lwr_ci =</span> lwr_ci<span class="sc">/</span>n,</span>
<span id="cb199-9"><a href="BayesReg2.html#cb199-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">prob_upr_ci =</span> upr_ci<span class="sc">/</span>n)</span>
<span id="cb199-10"><a href="BayesReg2.html#cb199-10" aria-hidden="true" tabindex="-1"></a>x_sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(df_plot<span class="sc">$</span>age.c)</span>
<span id="cb199-11"><a href="BayesReg2.html#cb199-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-12"><a href="BayesReg2.html#cb199-12" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes_string</span>(<span class="at">x =</span> <span class="st">&quot;age.c&quot;</span>,  <span class="at">y =</span> <span class="st">&quot;prob_obs&quot;</span>), <span class="at">data =</span> df_plot) <span class="sc">+</span> </span>
<span id="cb199-13"><a href="BayesReg2.html#cb199-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a layer of predictive intervals</span></span>
<span id="cb199-14"><a href="BayesReg2.html#cb199-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="fu">predict</span>(<span class="fu">loess</span>(prob_lwr_ci<span class="sc">~</span>age.c, <span class="at">data =</span> df_plot)), </span>
<span id="cb199-15"><a href="BayesReg2.html#cb199-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> <span class="fu">predict</span>(<span class="fu">loess</span>(prob_upr_ci <span class="sc">~</span>age.c, <span class="at">data =</span> df_plot))), <span class="at">fill =</span> <span class="st">&quot;skyblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span> </span>
<span id="cb199-16"><a href="BayesReg2.html#cb199-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> prob_est, <span class="at">col =</span> <span class="st">&quot;Model&quot;</span>), <span class="at">se =</span> <span class="cn">FALSE</span>, </span>
<span id="cb199-17"><a href="BayesReg2.html#cb199-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">&quot;loess&quot;</span>) <span class="sc">+</span> </span>
<span id="cb199-18"><a href="BayesReg2.html#cb199-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> prob_obs, <span class="at">col =</span> <span class="st">&quot;Data&quot;</span>), <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, </span>
<span id="cb199-19"><a href="BayesReg2.html#cb199-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">&quot;loess&quot;</span>) <span class="sc">+</span> </span>
<span id="cb199-20"><a href="BayesReg2.html#cb199-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span> </span>
<span id="cb199-21"><a href="BayesReg2.html#cb199-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>), <span class="at">name =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb199-22"><a href="BayesReg2.html#cb199-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-23"><a href="BayesReg2.html#cb199-23" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-160-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
<div id="hierarchical-model-revisit" class="section level3" number="7.1.3">
<h3><span class="header-section-number">7.1.3</span> hierarchical model revisit</h3>
<ul>
<li><p>Suppose that we do not believe that the sensitivity values are all the same</p></li>
<li><p>But we also believe that they are related, in the sense that they share a common underlying proportion but with deviations</p></li>
<li><p>Suppose also that our labelling of the studies is arbitrary (we would not worry if we had mixed the labels up)</p></li>
<li><p>Then the outcomes on the studies are exchangeable</p></li>
<li><p>We can treat them the same in the model, even though they are different studies</p></li>
</ul>
<p><strong>Exchangeable proportions</strong></p>
<ul>
<li>We can assume the following model</li>
</ul>
<p><span class="math display">\[logit(p_i) = \alpha_i = \alpha_0 + \epsilon_i\]</span></p>
<ul>
<li><p>where <span class="math inline">\(\epsilon_i \sim N(0,\sigma^2)\)</span></p></li>
<li><p>this is equivalent as <span class="math inline">\(\alpha_i \sim N(\alpha_0,\sigma^2)\)</span></p></li>
<li><p>The logit for study <span class="math inline">\(i\)</span> is near the average, but differs from it by some random amount <span class="math inline">\(\epsilon_i\)</span>, where <span class="math inline">\(\epsilon_i\)</span> are restricted to be centred at zero with a normal distribution</p></li>
<li><p>The logit for study <span class="math inline">\(i\)</span> is near the average, but varies with variance <span class="math inline">\(\sigma^2\)</span></p></li>
<li><p><span class="math inline">\(\sigma^2\)</span> can be estimated from the data and the model</p></li>
<li><p>It answers the question: how much do the logit proportions vary around their average?</p></li>
</ul>
<p><strong>Prior choice</strong></p>
<ul>
<li>We will often use this sort of prior structure for <span class="math inline">\(\sigma\)</span>
<ol style="list-style-type: decimal">
<li>half-t, <span class="math inline">\(\sigma \sim T_3(0, scale)\)</span></li>
<li>half-normal, <span class="math inline">\(\sigma \sim N(0, scale)\)</span></li>
</ol></li>
<li>We pick scale to be some smallish number (1,2,3)
<ul>
<li>It favours small values, but allows values that are relatively large</li>
<li>small scale specification of the prior can gain precision</li>
</ul></li>
</ul>
<p><strong>Hierarchical model</strong></p>
<ul>
<li>This is hierarchical random intercept model!</li>
<li>Data level, <span class="math inline">\(r_i \mid p_i, n_i \sim Bin(p_i(\alpha_i), n_i)\)</span></li>
<li>Structure prior, Parameters directly governing the observed data are one level up, <span class="math inline">\(\alpha_i = \alpha_0 + \epsilon_i\)</span></li>
<li>hyperparameter, <span class="math inline">\(\alpha_0 \sim N(0, 10)\)</span> and <span class="math inline">\(\sigma ~ N(0, \sigma = 2)\)</span></li>
</ul>
<!-- -  By assuming that the $\alpha_i$ values come from a common distribution, we improve the precision of each estimate -->
<p><strong>Overall average and individual estimates</strong></p>
<ul>
<li><p>Imprecise sample estimates are “shrunk” towards the overall average</p>
<ul>
<li>This shrinkage reflects the assumption that the estimates share the same overall mean</li>
</ul></li>
<li><p>When there is less data for an estimate, it “borrows” more information from the overall mean</p></li>
<li><p>Posterior means of each of the <span class="math inline">\(\alpha_i\)</span> in a random effect model are “shrunk” towards their overall mean <span class="math inline">\(\alpha_0\)</span> at the rate of <span class="math inline">\(\sigma\)</span></p></li>
<li><p>The overall mean <span class="math inline">\(\alpha_0\)</span> contains information about the values of all the other <span class="math inline">\(\alpha_i\)</span>.</p>
<ul>
<li>The consequence: the posterior means of the <span class="math inline">\(\alpha_i\)</span> are influenced by all the other <span class="math inline">\(\alpha_i\)</span></li>
<li>Because of this correlation, Bayesian estimates are closer to the population mean than the observed sample</li>
</ul></li>
<li><p>In the COVID testing example, this means that the posterior mean for study 1 depends to some extent on the data from all the other studies.</p></li>
<li><p>The Bayesian estimate can be seen as a compromise between</p>
<ul>
<li>A fixed effects estimate where all studies estimate share exactly the same common logit proportion <span class="math inline">\(\alpha_0\)</span></li>
<li>A complete independence model, where the studies each estimate completely different logit proportion <span class="math inline">\(\alpha_i\)</span>, based entirely on the observed data in that study</li>
</ul></li>
<li><p>The posterior precision is higher than the sample precision (in other words, the posterior variance is smaller than the sample variance)</p>
<ul>
<li>The together ” the studies (smaller <span class="math inline">\(\sigma\)</span>), the more borrowing of strength</li>
<li>The apart” the studies (larger <span class="math inline">\(\sigma\)</span>), the less borrowing of strength</li>
</ul></li>
</ul>
<div class="guidedexercise">
<p><strong>Run a random intercept model using brms</strong></p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="BayesReg2.html#cb200-1" aria-hidden="true" tabindex="-1"></a>fit4 <span class="ot">&lt;-</span> <span class="fu">brm</span>(r <span class="sc">|</span> <span class="fu">trials</span>(n) <span class="sc">~</span> (<span class="dv">1</span><span class="sc">|</span> Study) ,</span>
<span id="cb200-2"><a href="BayesReg2.html#cb200-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>dat,</span>
<span id="cb200-3"><a href="BayesReg2.html#cb200-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="at">class=</span>Intercept),</span>
<span id="cb200-4"><a href="BayesReg2.html#cb200-4" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">2</span>), <span class="at">class=</span>sd)),</span>
<span id="cb200-5"><a href="BayesReg2.html#cb200-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">iter=</span><span class="dv">10000</span>,</span>
<span id="cb200-6"><a href="BayesReg2.html#cb200-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">warmup=</span><span class="dv">8000</span>,</span>
<span id="cb200-7"><a href="BayesReg2.html#cb200-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb200-8"><a href="BayesReg2.html#cb200-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb200-9"><a href="BayesReg2.html#cb200-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">family=</span>binomial)</span>
<span id="cb200-10"><a href="BayesReg2.html#cb200-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-11"><a href="BayesReg2.html#cb200-11" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(fit4, &quot;data/chap8_binary_4&quot;)</span></span></code></pre></div>
<ul>
<li>comparing posterior distribution between centred and uncentred models</li>
</ul>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="BayesReg2.html#cb201-1" aria-hidden="true" tabindex="-1"></a>fit4 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/chap8_binary_4&quot;</span>)</span>
<span id="cb201-2"><a href="BayesReg2.html#cb201-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-3"><a href="BayesReg2.html#cb201-3" aria-hidden="true" tabindex="-1"></a><span class="co"># posterior predicted sensitivity using fixed effect;</span></span>
<span id="cb201-4"><a href="BayesReg2.html#cb201-4" aria-hidden="true" tabindex="-1"></a>s4 <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(fit4)</span>
<span id="cb201-5"><a href="BayesReg2.html#cb201-5" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fit4)[,<span class="sc">-</span><span class="dv">2</span>]<span class="sc">/</span>dat<span class="sc">$</span>n </span></code></pre></div>
<pre><code>##        Estimate      Q2.5     Q97.5
##  [1,] 0.8233070 0.6962025 0.9240506
##  [2,] 0.9623594 0.9212963 0.9907407
##  [3,] 0.5764524 0.4927536 0.6594203
##  [4,] 0.7268176 0.5573770 0.8688525
##  [5,] 0.9557420 0.8510638 1.0000000
##  [6,] 0.5228796 0.2592593 0.7777778
##  [7,] 0.9036406 0.6875000 1.0000000
##  [8,] 0.7052683 0.6146341 0.7902439
##  [9,] 0.8582381 0.8131213 0.8986083
## [10,] 0.8611109 0.7500000 0.9500000</code></pre>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="BayesReg2.html#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># posterior predicted sensitivity including random effect</span></span>
<span id="cb203-2"><a href="BayesReg2.html#cb203-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-3"><a href="BayesReg2.html#cb203-3" aria-hidden="true" tabindex="-1"></a><span class="co"># How would I predict the sensitivity in a NEW study</span></span>
<span id="cb203-4"><a href="BayesReg2.html#cb203-4" aria-hidden="true" tabindex="-1"></a><span class="co"># logit(p_i) = b_Intercept + e_i</span></span>
<span id="cb203-5"><a href="BayesReg2.html#cb203-5" aria-hidden="true" tabindex="-1"></a><span class="co"># e_i ~ N(0, sd_Study__Intercept))</span></span>
<span id="cb203-6"><a href="BayesReg2.html#cb203-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-7"><a href="BayesReg2.html#cb203-7" aria-hidden="true" tabindex="-1"></a><span class="co"># logit(p_new) = b_Intercept + e_new</span></span>
<span id="cb203-8"><a href="BayesReg2.html#cb203-8" aria-hidden="true" tabindex="-1"></a><span class="co"># e_new ~ N(0, sd_Study__Intercept)</span></span>
<span id="cb203-9"><a href="BayesReg2.html#cb203-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-10"><a href="BayesReg2.html#cb203-10" aria-hidden="true" tabindex="-1"></a>newlogit <span class="ot">&lt;-</span> s4<span class="sc">$</span>b_Intercept <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(s4), <span class="dv">0</span>, <span class="at">sd=</span>s4<span class="sc">$</span>sd_Study__Intercept)</span>
<span id="cb203-11"><a href="BayesReg2.html#cb203-11" aria-hidden="true" tabindex="-1"></a>averageLogit <span class="ot">&lt;-</span> s4<span class="sc">$</span>b_Intercept</span>
<span id="cb203-12"><a href="BayesReg2.html#cb203-12" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">inv_logit_scaled</span>(newlogit), <span class="at">nclass=</span><span class="dv">50</span>)</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-162-1.png" width="672" /></p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="BayesReg2.html#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(<span class="fu">inv_logit_scaled</span>(newlogit), <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.025</span>, <span class="fl">0.975</span>))</span></code></pre></div>
<pre><code>##       50%      2.5%     97.5% 
## 0.8380591 0.2260986 0.9899506</code></pre>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="BayesReg2.html#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">Sensitivity=</span><span class="fu">c</span>(<span class="fu">inv_logit_scaled</span>(newlogit), <span class="co">#mixed effect;</span></span>
<span id="cb206-2"><a href="BayesReg2.html#cb206-2" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">inv_logit_scaled</span>(averageLogit)), <span class="co">#fixed effect;</span></span>
<span id="cb206-3"><a href="BayesReg2.html#cb206-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">Type=</span><span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;New Study&quot;</span>,<span class="st">&quot;Pooled Estimate&quot;</span>),<span class="at">each=</span><span class="fu">nrow</span>(s4))) <span class="sc">%&gt;%</span></span>
<span id="cb206-4"><a href="BayesReg2.html#cb206-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Sensitivity, <span class="at">fill=</span>Type))<span class="sc">+</span><span class="fu">geom_density</span>(<span class="at">alpha=</span><span class="fl">0.25</span>)<span class="sc">+</span><span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-162-2.png" width="672" /></p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="BayesReg2.html#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make plots of observed and fitted values</span></span>
<span id="cb207-2"><a href="BayesReg2.html#cb207-2" aria-hidden="true" tabindex="-1"></a>Prob <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">inv_logit_scaled</span>(s4[,<span class="st">&quot;b_Intercept&quot;</span>]))</span>
<span id="cb207-3"><a href="BayesReg2.html#cb207-3" aria-hidden="true" tabindex="-1"></a>CrI <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">inv_logit_scaled</span>(s4[,<span class="st">&quot;b_Intercept&quot;</span>]), <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="cb207-4"><a href="BayesReg2.html#cb207-4" aria-hidden="true" tabindex="-1"></a>Prob2 <span class="ot">&lt;-</span><span class="fu">inv_logit_scaled</span>(<span class="fu">mean</span>(s4[,<span class="st">&quot;b_Intercept&quot;</span>]))</span>
<span id="cb207-5"><a href="BayesReg2.html#cb207-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">Size=</span>dat<span class="sc">$</span>n, <span class="at">observed=</span>dat<span class="sc">$</span>r<span class="sc">/</span>dat<span class="sc">$</span>n, </span>
<span id="cb207-6"><a href="BayesReg2.html#cb207-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">posteriorCount=</span><span class="fu">predict</span>(fit4)[,<span class="dv">1</span>])<span class="sc">%&gt;%</span></span>
<span id="cb207-7"><a href="BayesReg2.html#cb207-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">PosteriorMean=</span>posteriorCount<span class="sc">/</span>Size) <span class="sc">%&gt;%</span></span>
<span id="cb207-8"><a href="BayesReg2.html#cb207-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SamplePrecision=</span>Size<span class="sc">/</span>(observed<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>observed))) <span class="sc">%&gt;%</span></span>
<span id="cb207-9"><a href="BayesReg2.html#cb207-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(observed, PosteriorMean,<span class="at">size=</span>SamplePrecision))<span class="sc">+</span></span>
<span id="cb207-10"><a href="BayesReg2.html#cb207-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb207-11"><a href="BayesReg2.html#cb207-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>, <span class="at">intercept=</span><span class="dv">0</span>,<span class="at">lty=</span><span class="dv">3</span>,<span class="at">col=</span><span class="st">&quot;blue&quot;</span>)<span class="sc">+</span></span>
<span id="cb207-12"><a href="BayesReg2.html#cb207-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="fl">0.4</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb207-13"><a href="BayesReg2.html#cb207-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="fl">0.4</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb207-14"><a href="BayesReg2.html#cb207-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb207-15"><a href="BayesReg2.html#cb207-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span>Prob,<span class="at">lty=</span><span class="dv">2</span>,<span class="at">col=</span><span class="st">&quot;red&quot;</span>,<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb207-16"><a href="BayesReg2.html#cb207-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-162-3.png" width="672" /></p>
</div>
<p><strong>Seeds example</strong></p>
<ul>
<li><p>Concerns the proportion of seeds that germinated on each of 21 plates</p></li>
<li><p>Plates are arranged according to a 2 by 2 factorial layout by seed and type of root extract.</p></li>
<li><p><span class="math inline">\(r_i\)</span> and <span class="math inline">\(n_i\)</span> are the number of those germinated and the total number of seeds on the <span class="math inline">\(i\)</span>th plate, <span class="math inline">\(i=1, \ldots,21\)</span>.</p></li>
</ul>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-163"></span>
<img src="images/seed_data.PNG" alt="Seed example data summary" width="538" />
<p class="caption">
Figure 7.1: Seed example data summary
</p>
</div>
<ul>
<li><p>There are two factors: seed and root extract</p></li>
<li><p>A fixed effects model would simply be (<span class="math inline">\(i\)</span> index plate)</p></li>
</ul>
<p><span class="math display">\[logit(p_i) = \beta_0 + \beta_1 SEED_i + \beta_2 ROOT_i\]</span>
<span class="math display">\[r_i \sim Bin(n_i, p_i)\]</span></p>
<ul>
<li>The mean (probability) depends entirely on the `treatment’ received</li>
<li>Variation in the <span class="math inline">\(r_i\)</span> are only due to binomial distribution variability</li>
</ul>
<p><strong>The table of expected values for logits for each seed/root combination</strong></p>
<table>
<thead>
<tr class="header">
<th></th>
<th>ROOT = 0</th>
<th>ROOT=1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>SEED=0</td>
<td><span class="math inline">\(\beta_0\)</span></td>
<td><span class="math inline">\(\beta_0 + \beta_2\)</span></td>
</tr>
<tr class="even">
<td>SEED=1</td>
<td><span class="math inline">\(\beta_0 + \beta_1\)</span></td>
<td><span class="math inline">\(\beta_0 + \beta_1 + \beta_2\)</span></td>
</tr>
</tbody>
</table>
<ul>
<li><p>Why might this not be sufficient?</p>
<ul>
<li>There could be additional unmeasured variables</li>
<li>e.g., the plates are not identical, growing condition could be different, seeds might be from different parents, etc</li>
</ul></li>
<li><p>One solution is to introduce a random intercept <span class="math inline">\(b_i\)</span></p></li>
<li><p>This is additional ‘noise’ that is added to each predicted logit(probability)</p></li>
</ul>
<p><span class="math display">\[logit(p_i) = \beta_0 + \beta_1 SEED_i + \beta_2 ROOT_i + b_i\]</span>
<span class="math display">\[r_i \sim Bin(n_i, p_i)\]</span>
<span class="math display">\[b_i \sim N(0, \sigma_b)\]</span></p>
<ul>
<li><p>The SEED and ROOT tell you what the expected value of the logit(p) is</p></li>
<li><p>The random effect accounts for deviations from this expected value</p></li>
<li><p>Some plates are higher than expected and some are lower</p></li>
<li><p>The table of expected values for logits for each seed/root combination (remain the same!)</p></li>
<li><p>We put a prior on the random effect <span class="math inline">\(b_i \sim N(0,\sigma_b)\)</span></p></li>
<li><p>We put a prior on <span class="math inline">\(\sigma_b\)</span> (hyperparameter), since we do not know what amount of between-plate variation exists</p></li>
<li><p>We estimate the between-plate variation by finding a posterior distribution for <span class="math inline">\(\sigma_b\)</span></p></li>
<li><p>We have two levels of variation</p>
<ul>
<li>Within-plate (binomial variation with parameter <span class="math inline">\(p_i\)</span>)</li>
<li>Between-plate (on <span class="math inline">\(logit(p_i)\)</span> scale)</li>
<li>Some of the latter is explained by the predictors</li>
<li>The remaining is modelled by the random effect (normal variation) - random intercept</li>
</ul></li>
<li><p>We have a hierarchical logistic regression model!</p></li>
</ul>
<p><strong>Verify fit of random effect model</strong></p>
<ul>
<li><p>Assess the degree of extra-binomial variation by looking at the standard deviation</p></li>
<li><p>Look at the posterior density plot for <span class="math inline">\(\sigma_b\)</span></p>
<ul>
<li><strong>Is the density of <span class="math inline">\(\sigma_b\)</span> away from zero?</strong></li>
<li><strong>What is the posterior mean of <span class="math inline">\(\sigma_b\)</span></strong></li>
</ul></li>
<li><p>More formally to determine if the random effect model fits better than standard fixed effect model: use WAIC and/or loo.</p></li>
</ul>
<div class="guidedexercise">
<p><strong>Fit Seed example using brms</strong></p>
<pre><code>##             Seed           Root     y           Plate    
##  aegyptiaco 73:436   Bean    :567   0:407   3      : 81  
##  aegyptiaco 75:395   Cucumber:264   1:424   10     : 79  
##                                             7      : 74  
##                                             8      : 72  
##                                             2      : 62  
##                                             4      : 51  
##                                             (Other):412</code></pre>
<pre><code>##            Seed Root y Plate
## 1 aegyptiaco 75 Bean 1     1
## 2 aegyptiaco 75 Bean 1     1
## 3 aegyptiaco 75 Bean 1     1
## 4 aegyptiaco 75 Bean 1     1
## 5 aegyptiaco 75 Bean 1     1
## 6 aegyptiaco 75 Bean 1     1</code></pre>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="BayesReg2.html#cb210-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(y <span class="sc">~</span> Root<span class="sc">+</span>Seed ,</span>
<span id="cb210-2"><a href="BayesReg2.html#cb210-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>d,</span>
<span id="cb210-3"><a href="BayesReg2.html#cb210-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">10</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb210-4"><a href="BayesReg2.html#cb210-4" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">2</span>), <span class="at">class=</span>b)),</span>
<span id="cb210-5"><a href="BayesReg2.html#cb210-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">family=</span>bernoulli,</span>
<span id="cb210-6"><a href="BayesReg2.html#cb210-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">iter =</span> <span class="dv">10000</span>,</span>
<span id="cb210-7"><a href="BayesReg2.html#cb210-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">warmup =</span> <span class="dv">8000</span>,</span>
<span id="cb210-8"><a href="BayesReg2.html#cb210-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb210-9"><a href="BayesReg2.html#cb210-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">cores =</span> <span class="dv">5</span>, </span>
<span id="cb210-10"><a href="BayesReg2.html#cb210-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb210-11"><a href="BayesReg2.html#cb210-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-12"><a href="BayesReg2.html#cb210-12" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(y <span class="sc">~</span> Root<span class="sc">+</span>Seed<span class="sc">+</span>(<span class="dv">1</span><span class="sc">|</span>Plate),</span>
<span id="cb210-13"><a href="BayesReg2.html#cb210-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>d,</span>
<span id="cb210-14"><a href="BayesReg2.html#cb210-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">10</span>),<span class="at">class=</span>Intercept),</span>
<span id="cb210-15"><a href="BayesReg2.html#cb210-15" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">2</span>), <span class="at">class=</span>b),</span>
<span id="cb210-16"><a href="BayesReg2.html#cb210-16" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">2</span>), <span class="at">class =</span> sd)),</span>
<span id="cb210-17"><a href="BayesReg2.html#cb210-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">family=</span>bernoulli,</span>
<span id="cb210-18"><a href="BayesReg2.html#cb210-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">iter =</span> <span class="dv">20000</span>,</span>
<span id="cb210-19"><a href="BayesReg2.html#cb210-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">warmup =</span> <span class="dv">18000</span>,</span>
<span id="cb210-20"><a href="BayesReg2.html#cb210-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb210-21"><a href="BayesReg2.html#cb210-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">cores =</span> <span class="dv">5</span>, </span>
<span id="cb210-22"><a href="BayesReg2.html#cb210-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb210-23"><a href="BayesReg2.html#cb210-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-24"><a href="BayesReg2.html#cb210-24" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(fit5.1, file=&quot;data/chap8_binary_5.1&quot;)</span></span>
<span id="cb210-25"><a href="BayesReg2.html#cb210-25" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(fit5.2, file=&quot;data/chap8_binary_5.2&quot;)</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Quick posterior summary</li>
</ol>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="BayesReg2.html#cb211-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/chap8_binary_5.1&quot;</span>)</span>
<span id="cb211-2"><a href="BayesReg2.html#cb211-2" aria-hidden="true" tabindex="-1"></a>fit5<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/chap8_binary_5.2&quot;</span>)</span>
<span id="cb211-3"><a href="BayesReg2.html#cb211-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-4"><a href="BayesReg2.html#cb211-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit5<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>##  Family: bernoulli 
##   Links: mu = logit 
## Formula: y ~ Root + Seed 
##    Data: d (Number of observations: 831) 
##   Draws: 4 chains, each with iter = 10000; warmup = 8000; thin = 1;
##          total post-warmup draws = 8000
## 
## Population-Level Effects: 
##                  Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept            0.63      0.11     0.42     0.85 1.00     7650     6204
## RootCucumber        -0.27      0.15    -0.56     0.03 1.00     7423     5953
## Seedaegyptiaco75    -1.06      0.14    -1.34    -0.78 1.00     7546     5778
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="BayesReg2.html#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit5<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>##  Family: bernoulli 
##   Links: mu = logit 
## Formula: y ~ Root + Seed + (1 | Plate) 
##    Data: d (Number of observations: 831) 
##   Draws: 4 chains, each with iter = 20000; warmup = 18000; thin = 1;
##          total post-warmup draws = 8000
## 
## Group-Level Effects: 
## ~Plate (Number of levels: 21) 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)     0.40      0.15     0.15     0.72 1.00     2227     3656
## 
## Population-Level Effects: 
##                  Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept            0.64      0.21     0.24     1.05 1.00     4666     4259
## RootCucumber        -0.38      0.26    -0.92     0.10 1.00     4805     4088
## Seedaegyptiaco75    -1.02      0.24    -1.49    -0.55 1.00     5493     5044
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="BayesReg2.html#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">fixef</span>(fit5<span class="fl">.1</span>)[,<span class="sc">-</span><span class="dv">2</span>])</span></code></pre></div>
<pre><code>##                   Estimate      Q2.5     Q97.5
## Intercept        1.8836787 1.5232610 2.3463249
## RootCucumber     0.7651724 0.5700998 1.0350088
## Seedaegyptiaco75 0.3454368 0.2606237 0.4562058</code></pre>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="BayesReg2.html#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">fixef</span>(fit5<span class="fl">.2</span>)[,<span class="sc">-</span><span class="dv">2</span>])</span></code></pre></div>
<pre><code>##                   Estimate      Q2.5    Q97.5
## Intercept        1.9035353 1.2732972 2.871393
## RootCucumber     0.6846573 0.3975576 1.102828
## Seedaegyptiaco75 0.3608878 0.2243166 0.579529</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Visualize Parameter Effects</li>
</ol>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="BayesReg2.html#cb219-1" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span>d <span class="sc">%&gt;%</span></span>
<span id="cb219-2"><a href="BayesReg2.html#cb219-2" aria-hidden="true" tabindex="-1"></a>  modelr<span class="sc">::</span><span class="fu">data_grid</span>(Seed, Root) <span class="sc">%&gt;%</span></span>
<span id="cb219-3"><a href="BayesReg2.html#cb219-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_fitted_draws</span>(fit5<span class="fl">.1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb219-4"><a href="BayesReg2.html#cb219-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .value, <span class="at">y =</span> <span class="fu">interaction</span>(Seed, Root))) <span class="sc">+</span></span>
<span id="cb219-5"><a href="BayesReg2.html#cb219-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_pointinterval</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">68</span>, .<span class="dv">95</span>)) <span class="sc">+</span></span>
<span id="cb219-6"><a href="BayesReg2.html#cb219-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb219-7"><a href="BayesReg2.html#cb219-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;predicted probability&quot;</span>) <span class="sc">+</span></span>
<span id="cb219-8"><a href="BayesReg2.html#cb219-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>),<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb219-9"><a href="BayesReg2.html#cb219-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb219-10"><a href="BayesReg2.html#cb219-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-11"><a href="BayesReg2.html#cb219-11" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb219-12"><a href="BayesReg2.html#cb219-12" aria-hidden="true" tabindex="-1"></a>  modelr<span class="sc">::</span><span class="fu">data_grid</span>(Seed, Root, Plate) <span class="sc">%&gt;%</span></span>
<span id="cb219-13"><a href="BayesReg2.html#cb219-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_fitted_draws</span>(fit5<span class="fl">.2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb219-14"><a href="BayesReg2.html#cb219-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .value, <span class="at">y =</span> <span class="fu">interaction</span>(Seed, Root))) <span class="sc">+</span></span>
<span id="cb219-15"><a href="BayesReg2.html#cb219-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_pointinterval</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">68</span>, .<span class="dv">95</span>)) <span class="sc">+</span></span>
<span id="cb219-16"><a href="BayesReg2.html#cb219-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb219-17"><a href="BayesReg2.html#cb219-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;predicted probability&quot;</span>) <span class="sc">+</span></span>
<span id="cb219-18"><a href="BayesReg2.html#cb219-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>),<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb219-19"><a href="BayesReg2.html#cb219-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb219-20"><a href="BayesReg2.html#cb219-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(p1,p2, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-167-1.png" width="720" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Compare models</li>
</ol>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="BayesReg2.html#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="co">#checking sd posterior density;</span></span>
<span id="cb220-2"><a href="BayesReg2.html#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit5<span class="fl">.2</span>, <span class="at">variable =</span> <span class="st">&quot;sd_Plate__Intercept&quot;</span>)</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-168-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="BayesReg2.html#cb221-1" aria-hidden="true" tabindex="-1"></a>waic1 <span class="ot">&lt;-</span> <span class="fu">waic</span>(fit5<span class="fl">.1</span>)</span>
<span id="cb221-2"><a href="BayesReg2.html#cb221-2" aria-hidden="true" tabindex="-1"></a>waic2 <span class="ot">&lt;-</span> <span class="fu">waic</span>(fit5<span class="fl">.2</span>) <span class="co">#smaller wAIC better model!</span></span>
<span id="cb221-3"><a href="BayesReg2.html#cb221-3" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_ic</span>(waic1, waic2)</span></code></pre></div>
</div>
</div>
</div>
<div id="models-for-count-data" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Models for Count Data</h2>
<div id="r-session-information-6" class="section level3 unnumbered">
<h3>R Session information</h3>
<pre><code>## R version 4.1.2 (2021-11-01)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 20.04.3 LTS
## 
## Matrix products: 
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=C             
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] grid      stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
##  [1] tidybayes_2.3.1     DT_0.20             gtsummary_1.5.2    
##  [4] invgamma_1.1        extraDistr_1.9.1    MCMCpack_1.6-1     
##  [7] MASS_7.3-54         coda_0.19-4         SHELF_1.8.0        
## [10] bayesplot_1.8.1     ggmcmc_1.5.1.1      truncnorm_1.0-8    
## [13] ggpubr_0.4.0        tweenr_1.0.2        gganimate_1.0.7    
## [16] VennDiagram_1.7.1   futile.logger_1.4.3 forcats_0.5.1      
## [19] stringr_1.4.0       purrr_0.3.4         readr_1.4.0        
## [22] tidyr_1.2.0         tibble_3.1.6        tidyverse_1.3.1    
## [25] brms_2.16.3         Rcpp_1.0.7          dplyr_1.0.8        
## [28] ggplot2_3.3.5</code></pre>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-bastos2020diagnostic" class="csl-entry">
Bastos, Mayara Lisboa, Gamuchirai Tavaziva, Syed Kunal Abidi, Jonathon R Campbell, Louis-Patrick Haraoui, James C Johnston, Zhiyi Lan, et al. 2020. <span>“Diagnostic Accuracy of Serological Tests for Covid-19: Systematic Review and Meta-Analysis.”</span> <em>Bmj</em> 370.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="BayesReg1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="BayesMeta.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": "twitter"
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Session 6 Bayesian Regression I | HAD5314H - Applied Bayesian Methods in Clinical Epidemiology and Health Care Research</title>
  <meta name="description" content="Course notes for HAD5314H Winter 2022" />
  <meta name="generator" content="bookdown 0.25 and GitBook 2.6.7" />

  <meta property="og:title" content="Session 6 Bayesian Regression I | HAD5314H - Applied Bayesian Methods in Clinical Epidemiology and Health Care Research" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Course notes for HAD5314H Winter 2022" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Session 6 Bayesian Regression I | HAD5314H - Applied Bayesian Methods in Clinical Epidemiology and Health Care Research" />
  
  <meta name="twitter:description" content="Course notes for HAD5314H Winter 2022" />
  

<meta name="author" content="Kuan Liu   Institute of Health Policy, Management and Evaluation   University of Toronto" />


<meta name="date" content="2022-03-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="BayesMCMC.html"/>
<link rel="next" href="BayesReg2.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.22/datatables.js"></script>
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">HAD5314H - Winter 2022 </a></li>

<li class="divider"></li>
<li><a href="index.html#university-of-toronto-statement-of-acknowledgment-of-traditional-land">University of Toronto Statement of Acknowledgment of Traditional Land<span></span></a></li>
<li><a href="course-syllabus.html#course-syllabus">Course Syllabus<span></span></a>
<ul>
<li><a href="course-syllabus.html#course-info">Course Info<span></span></a></li>
<li><a href="course-syllabus.html#course-description">Course Description<span></span></a></li>
<li><a href="course-syllabus.html#course-textbook-and-structure">Course Textbook and Structure<span></span></a></li>
<li><a href="course-syllabus.html#calendar-and-outline">Calendar and Outline<span></span></a></li>
<li><a href="course-syllabus.html#accessibility-and-accommodations">Accessibility and Accommodations<span></span></a></li>
<li><a href="course-syllabus.html#academic-integrity">Academic Integrity<span></span></a></li>
<li><a href="course-syllabus.html#key-resources-and-supports-for-dslph-graduate-students">Key Resources and Supports for DSLPH Graduate Students<span></span></a></li>
<li><a href="course-syllabus.html#license">License<span></span></a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="into.html"><a href="into.html"><i class="fa fa-check"></i><b>1</b> Introduction to the course<span></span></a>
<ul>
<li class="chapter" data-level="1.1" data-path="into.html"><a href="into.html#about-me"><i class="fa fa-check"></i><b>1.1</b> About me<span></span></a></li>
<li class="chapter" data-level="1.2" data-path="into.html"><a href="into.html#syllabus"><i class="fa fa-check"></i><b>1.2</b> Syllabus<span></span></a></li>
<li class="chapter" data-level="1.3" data-path="into.html"><a href="into.html#some-history"><i class="fa fa-check"></i><b>1.3</b> Some history<span></span></a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="into.html"><a href="into.html#bayesian-history"><i class="fa fa-check"></i><b>1.3.1</b> Bayesian history<span></span></a></li>
<li class="chapter" data-level="1.3.2" data-path="into.html"><a href="into.html#history-of-this-course"><i class="fa fa-check"></i><b>1.3.2</b> History of this course<span></span></a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="into.html"><a href="into.html#thinking-like-a-bayesian-using-the-concept-of-probability"><i class="fa fa-check"></i><b>1.4</b> Thinking like a Bayesian using the concept of probability<span></span></a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="into.html"><a href="into.html#probability-is-not-unitary"><i class="fa fa-check"></i><b>1.4.1</b> Probability is not unitary<span></span></a></li>
<li class="chapter" data-level="1.4.2" data-path="into.html"><a href="into.html#bayes-rule"><i class="fa fa-check"></i><b>1.4.2</b> Bayes’ Rule<span></span></a></li>
<li class="chapter" data-level="1.4.3" data-path="into.html"><a href="into.html#the-scientific-method-in-steps"><i class="fa fa-check"></i><b>1.4.3</b> The Scientific Method in steps<span></span></a></li>
</ul></li>
</ul></li>
<li><a href="lab1-getting-started-with-r-rstudio.html#lab1-getting-started-with-r-rstudio">Lab1 Getting started with R &amp; RStudio<span></span></a>
<ul>
<li class="chapter" data-level="1.5" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html"><i class="fa fa-check"></i><b>1.5</b> R and RStudio Installation<span></span></a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#windows-operating-system"><i class="fa fa-check"></i><b>1.5.1</b> Windows operating system<span></span></a></li>
<li class="chapter" data-level="1.5.2" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#macos-operating-system"><i class="fa fa-check"></i><b>1.5.2</b> macOS operating system<span></span></a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#r-packages"><i class="fa fa-check"></i><b>1.6</b> R Packages<span></span></a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#bayesian-analysis-in-r-using-brms-package"><i class="fa fa-check"></i><b>1.6.1</b> Bayesian Analysis in R using brms package<span></span></a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#working-in-rstudio"><i class="fa fa-check"></i><b>1.7</b> Working in RStudio<span></span></a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#rstudio-layout"><i class="fa fa-check"></i><b>1.7.1</b> RStudio layout<span></span></a></li>
<li class="chapter" data-level="1.7.2" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#customization"><i class="fa fa-check"></i><b>1.7.2</b> Customization<span></span></a></li>
<li class="chapter" data-level="1.7.3" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#working-directory"><i class="fa fa-check"></i><b>1.7.3</b> Working directory<span></span></a></li>
<li class="chapter" data-level="1.7.4" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#getting-help-with-r"><i class="fa fa-check"></i><b>1.7.4</b> Getting help with R<span></span></a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#basic-r-a-crash-introduction"><i class="fa fa-check"></i><b>1.8</b> Basic R (a crash introduction)<span></span></a>
<ul>
<li class="chapter" data-level="1.8.1" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#arithmetic"><i class="fa fa-check"></i><b>1.8.1</b> Arithmetic<span></span></a></li>
<li class="chapter" data-level="1.8.2" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#vectors"><i class="fa fa-check"></i><b>1.8.2</b> Vectors<span></span></a></li>
<li class="chapter" data-level="1.8.3" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#data-frame---the-titanic-dataset"><i class="fa fa-check"></i><b>1.8.3</b> Data frame - The Titanic dataset<span></span></a></li>
<li class="chapter" data-level="1.8.4" data-path="lab1-getting-started-with-r-rstudio.html"><a href="lab1-getting-started-with-r-rstudio.html#simple-plots"><i class="fa fa-check"></i><b>1.8.4</b> Simple plots<span></span></a></li>
<li><a href="lab1-getting-started-with-r-rstudio.html#r-session-information">R Session information<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="prob.html"><a href="prob.html"><i class="fa fa-check"></i><b>2</b> Probability, random variables and distributions<span></span></a>
<ul>
<li class="chapter" data-level="2.1" data-path="prob.html"><a href="prob.html#probability"><i class="fa fa-check"></i><b>2.1</b> Probability<span></span></a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="prob.html"><a href="prob.html#venn-diagrams"><i class="fa fa-check"></i><b>2.1.1</b> Venn Diagrams<span></span></a></li>
<li class="chapter" data-level="2.1.2" data-path="prob.html"><a href="prob.html#probability-rules"><i class="fa fa-check"></i><b>2.1.2</b> Probability Rules<span></span></a></li>
<li class="chapter" data-level="2.1.3" data-path="prob.html"><a href="prob.html#how-to-define-and-assign-probabilities-in-general"><i class="fa fa-check"></i><b>2.1.3</b> How to define and assign probabilities in general?<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="prob.html"><a href="prob.html#probability-distributions"><i class="fa fa-check"></i><b>2.2</b> Probability Distributions<span></span></a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="prob.html"><a href="prob.html#probability-density-functions"><i class="fa fa-check"></i><b>2.2.1</b> Probability density functions<span></span></a></li>
<li class="chapter" data-level="2.2.2" data-path="prob.html"><a href="prob.html#discrete-distributions"><i class="fa fa-check"></i><b>2.2.2</b> Discrete Distributions<span></span></a></li>
<li class="chapter" data-level="2.2.3" data-path="prob.html"><a href="prob.html#continous-distributions"><i class="fa fa-check"></i><b>2.2.3</b> Continous Distributions<span></span></a></li>
<li><a href="prob.html#r-session-information-1">R Session information<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bayes.html"><a href="bayes.html"><i class="fa fa-check"></i><b>3</b> Introduction to Bayesian inference<span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="bayes.html"><a href="bayes.html#classical-frequentist-approach"><i class="fa fa-check"></i><b>3.1</b> Classical frequentist approach<span></span></a></li>
<li class="chapter" data-level="3.2" data-path="bayes.html"><a href="bayes.html#introduction-to-bayesian-approach"><i class="fa fa-check"></i><b>3.2</b> Introduction to Bayesian approach<span></span></a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="bayes.html"><a href="bayes.html#review-from-session-1"><i class="fa fa-check"></i><b>3.2.1</b> Review from session 1<span></span></a></li>
<li class="chapter" data-level="3.2.2" data-path="bayes.html"><a href="bayes.html#the-beta-binomial-model"><i class="fa fa-check"></i><b>3.2.2</b> The Beta-binomial model<span></span></a></li>
<li class="chapter" data-level="3.2.3" data-path="bayes.html"><a href="bayes.html#the-normal-normal-model"><i class="fa fa-check"></i><b>3.2.3</b> The Normal-normal model<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="bayes.html"><a href="bayes.html#summary-of-conjugate-priors-models"><i class="fa fa-check"></i><b>3.3</b> Summary of Conjugate priors &amp; models<span></span></a></li>
<li class="chapter" data-level="3.4" data-path="bayes.html"><a href="bayes.html#why-bayesian-statistical-estimation-revisit"><i class="fa fa-check"></i><b>3.4</b> Why Bayesian: Statistical Estimation Revisit<span></span></a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="bayes.html"><a href="bayes.html#classic-frequentist-inference"><i class="fa fa-check"></i><b>3.4.1</b> Classic Frequentist Inference<span></span></a></li>
<li class="chapter" data-level="3.4.2" data-path="bayes.html"><a href="bayes.html#bayesian-inference"><i class="fa fa-check"></i><b>3.4.2</b> Bayesian Inference<span></span></a></li>
<li><a href="bayes.html#r-session-information-2">R Session information<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="Prior.html"><a href="Prior.html"><i class="fa fa-check"></i><b>4</b> Prior Distributions<span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="Prior.html"><a href="Prior.html#choosing-priors"><i class="fa fa-check"></i><b>4.1</b> Choosing priors<span></span></a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="Prior.html"><a href="Prior.html#eliciting-priors-from-experts"><i class="fa fa-check"></i><b>4.1.1</b> Eliciting priors from experts<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="Prior.html"><a href="Prior.html#default-clincial-priors"><i class="fa fa-check"></i><b>4.2</b> Default clincial priors<span></span></a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="Prior.html"><a href="Prior.html#non-informative-or-reference-priors"><i class="fa fa-check"></i><b>4.2.1</b> “Non-informative” or “reference” priors<span></span></a></li>
<li class="chapter" data-level="4.2.2" data-path="Prior.html"><a href="Prior.html#minimally-informative-prior"><i class="fa fa-check"></i><b>4.2.2</b> Minimally informative prior<span></span></a></li>
<li class="chapter" data-level="4.2.3" data-path="Prior.html"><a href="Prior.html#skeptical-prior"><i class="fa fa-check"></i><b>4.2.3</b> Skeptical Prior<span></span></a></li>
<li class="chapter" data-level="4.2.4" data-path="Prior.html"><a href="Prior.html#optimisticenthusiastic-prior"><i class="fa fa-check"></i><b>4.2.4</b> Optimistic/enthusiastic Prior<span></span></a></li>
<li class="chapter" data-level="4.2.5" data-path="Prior.html"><a href="Prior.html#evaluating-priors"><i class="fa fa-check"></i><b>4.2.5</b> Evaluating Priors?<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="Prior.html"><a href="Prior.html#historical-data-meta-analysis"><i class="fa fa-check"></i><b>4.3</b> Historical data (meta-analysis)<span></span></a></li>
<li class="chapter" data-level="4.4" data-path="Prior.html"><a href="Prior.html#hierarchical-priors-and-shrinkage-priors"><i class="fa fa-check"></i><b>4.4</b> Hierarchical priors and shrinkage priors<span></span></a>
<ul>
<li><a href="Prior.html#r-session-information-3">R Session information<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="BayesMCMC.html"><a href="BayesMCMC.html"><i class="fa fa-check"></i><b>5</b> Bayesian estimation with MCMC<span></span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="BayesMCMC.html"><a href="BayesMCMC.html#introduction-to-markov-chain-monte-carlo-methods"><i class="fa fa-check"></i><b>5.1</b> Introduction to Markov Chain Monte Carlo Methods<span></span></a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="BayesMCMC.html"><a href="BayesMCMC.html#gibbs-sampling"><i class="fa fa-check"></i><b>5.1.1</b> Gibbs sampling<span></span></a></li>
<li class="chapter" data-level="5.1.2" data-path="BayesMCMC.html"><a href="BayesMCMC.html#metropolis-algorithm"><i class="fa fa-check"></i><b>5.1.2</b> Metropolis algorithm<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="BayesMCMC.html"><a href="BayesMCMC.html#mcmc-diganostics---assess-convergence"><i class="fa fa-check"></i><b>5.2</b> MCMC diganostics - assess convergence<span></span></a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="BayesMCMC.html"><a href="BayesMCMC.html#acceptance-rate"><i class="fa fa-check"></i><b>5.2.1</b> Acceptance Rate<span></span></a></li>
<li class="chapter" data-level="5.2.2" data-path="BayesMCMC.html"><a href="BayesMCMC.html#diagnostics-using-multiple-chains"><i class="fa fa-check"></i><b>5.2.2</b> Diagnostics Using Multiple Chains<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="BayesMCMC.html"><a href="BayesMCMC.html#example-bayesian-modelling-with-brms"><i class="fa fa-check"></i><b>5.3</b> Example Bayesian modelling with brms<span></span></a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="BayesMCMC.html"><a href="BayesMCMC.html#example-bayesian-logistic-regression-model"><i class="fa fa-check"></i><b>5.3.1</b> Example Bayesian logistic regression model<span></span></a></li>
<li><a href="BayesMCMC.html#r-session-information-4">R Session information<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="BayesReg1.html"><a href="BayesReg1.html"><i class="fa fa-check"></i><b>6</b> Bayesian Regression I<span></span></a>
<ul>
<li class="chapter" data-level="6.1" data-path="BayesReg1.html"><a href="BayesReg1.html#normal-models-and-linear-regression"><i class="fa fa-check"></i><b>6.1</b> Normal Models and Linear Regression<span></span></a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="BayesReg1.html"><a href="BayesReg1.html#one-sample-and-two-sample-normal-regression"><i class="fa fa-check"></i><b>6.1.1</b> One-sample and two-sample normal regression<span></span></a></li>
<li class="chapter" data-level="6.1.2" data-path="BayesReg1.html"><a href="BayesReg1.html#linear-regression"><i class="fa fa-check"></i><b>6.1.2</b> Linear regression<span></span></a></li>
<li class="chapter" data-level="6.1.3" data-path="BayesReg1.html"><a href="BayesReg1.html#model-diagnostics"><i class="fa fa-check"></i><b>6.1.3</b> Model diagnostics<span></span></a></li>
<li class="chapter" data-level="6.1.4" data-path="BayesReg1.html"><a href="BayesReg1.html#model-comparision"><i class="fa fa-check"></i><b>6.1.4</b> Model comparision<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="BayesReg1.html"><a href="BayesReg1.html#hierarchical-models"><i class="fa fa-check"></i><b>6.2</b> Hierarchical models<span></span></a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="BayesReg1.html"><a href="BayesReg1.html#clustered-data-multi-level"><i class="fa fa-check"></i><b>6.2.1</b> Clustered data (Multi-level)<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="BayesReg1.html"><a href="BayesReg1.html#regression-regularization"><i class="fa fa-check"></i><b>6.3</b> Regression regularization<span></span></a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="BayesReg1.html"><a href="BayesReg1.html#shrinkage-priors-in-action"><i class="fa fa-check"></i><b>6.3.1</b> Shrinkage Priors in action<span></span></a></li>
<li class="chapter" data-level="6.3.2" data-path="BayesReg1.html"><a href="BayesReg1.html#bayesian-logistic-regression-model-cope-example-revisit"><i class="fa fa-check"></i><b>6.3.2</b> Bayesian logistic regression model (COPE example revisit)<span></span></a></li>
<li><a href="BayesReg1.html#r-session-information-5">R Session information<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="BayesReg2.html"><a href="BayesReg2.html"><i class="fa fa-check"></i><b>7</b> Bayesian Regression II<span></span></a>
<ul>
<li class="chapter" data-level="7.1" data-path="BayesReg2.html"><a href="BayesReg2.html#models-for-binary-data"><i class="fa fa-check"></i><b>7.1</b> Models for Binary Data<span></span></a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="BayesReg2.html"><a href="BayesReg2.html#logistic-regression-with-predictor"><i class="fa fa-check"></i><b>7.1.1</b> Logistic regression with predictor<span></span></a></li>
<li class="chapter" data-level="7.1.2" data-path="BayesReg2.html"><a href="BayesReg2.html#centring-continous-variable"><i class="fa fa-check"></i><b>7.1.2</b> Centring continous variable<span></span></a></li>
<li class="chapter" data-level="7.1.3" data-path="BayesReg2.html"><a href="BayesReg2.html#hierarchical-model-revisit"><i class="fa fa-check"></i><b>7.1.3</b> hierarchical model revisit<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="BayesReg2.html"><a href="BayesReg2.html#models-for-count-data"><i class="fa fa-check"></i><b>7.2</b> Models for Count Data<span></span></a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="BayesReg2.html"><a href="BayesReg2.html#modelling-rates"><i class="fa fa-check"></i><b>7.2.1</b> Modelling Rates<span></span></a></li>
<li class="chapter" data-level="7.2.2" data-path="BayesReg2.html"><a href="BayesReg2.html#expanding-the-poisson-model"><i class="fa fa-check"></i><b>7.2.2</b> Expanding the Poisson Model<span></span></a></li>
<li class="chapter" data-level="7.2.3" data-path="BayesReg2.html"><a href="BayesReg2.html#checking-and-comparing-models"><i class="fa fa-check"></i><b>7.2.3</b> Checking and comparing models<span></span></a></li>
<li><a href="BayesReg2.html#r-session-information-6">R Session information<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="BayesMeta.html"><a href="BayesMeta.html"><i class="fa fa-check"></i><b>8</b> Bayesian Meta-Analysis<span></span></a>
<ul>
<li class="chapter" data-level="8.1" data-path="BayesMeta.html"><a href="BayesMeta.html#introduction"><i class="fa fa-check"></i><b>8.1</b> Introduction<span></span></a></li>
<li class="chapter" data-level="8.2" data-path="BayesMeta.html"><a href="BayesMeta.html#bayesian-inference-1"><i class="fa fa-check"></i><b>8.2</b> Bayesian inference<span></span></a></li>
<li class="chapter" data-level="8.3" data-path="BayesMeta.html"><a href="BayesMeta.html#continuous-data"><i class="fa fa-check"></i><b>8.3</b> Continuous data<span></span></a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="BayesMeta.html"><a href="BayesMeta.html#fitting-a-ma-with-brms"><i class="fa fa-check"></i><b>8.3.1</b> Fitting a MA with brms<span></span></a></li>
<li class="chapter" data-level="8.3.2" data-path="BayesMeta.html"><a href="BayesMeta.html#meta-regression"><i class="fa fa-check"></i><b>8.3.2</b> Meta-regression<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="BayesMeta.html"><a href="BayesMeta.html#other-types-of-data"><i class="fa fa-check"></i><b>8.4</b> Other types of data<span></span></a>
<ul>
<li><a href="BayesMeta.html#r-session-information-7">R Session information<span></span></a></li>
</ul></li>
</ul></li>
<li><a href="references.html#references">References<span></span></a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a> <a href="https://www.kuan-liu.com/" target="blank">Developed by Kuan Liu</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">HAD5314H - Applied Bayesian Methods in Clinical Epidemiology and Health Care Research</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="BayesReg1" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Session 6</span> Bayesian Regression I<a href="BayesReg1.html#BayesReg1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="chapterintro">
<ul>
<li>Learn how to fit linear regression model with brms</li>
<li>Understand how to interpret and report regression posterior results</li>
<li>Learn how to fit clustered data with brms</li>
<li>Learn how to conduct model diagnostics, model comparison, and variable selection</li>
</ul>
</div>
<script src="hideOutput.js"></script>
<pre><code>## Error in completeSubclasses(classDef2, class1, obj, where) : 
##   trying to get slot &quot;subclasses&quot; from an object of a basic class (&quot;NULL&quot;) with no slots</code></pre>
<p></br></p>
<p><strong>What is regression?</strong> <span class="citation">(<a href="#ref-mcelreath2018statistical" role="doc-biblioref">McElreath 2018</a>)</span></p>
<ul>
<li><p>using one or more predictor variables to model the distribution of one or more outcome variables</p></li>
<li><p>For a continuous outcome, we typically fit a linear regression model.</p>
<ul>
<li>Of course the relationship between outcome and predictors can be non-linear, in this case, we would consider fitting polynomial regression models or splines.</li>
</ul></li>
<li><p>For a categorical outcome, we will fit a generalized linear regression. We will cover this topic in future sessions.</p></li>
<li><p>For a repeatedly measured outcome, we can fit a linear mixed-effect model (continuous outcome) or a generalized linear mixed-effect model (categorical outcome).</p></li>
</ul>
<div id="normal-models-and-linear-regression" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Normal Models and Linear Regression<a href="BayesReg1.html#normal-models-and-linear-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="important">
<p><strong>Conditional normal model</strong></p>
<ul>
<li>Given its mean and variance, an observation has a normal distribution</li>
</ul>
<p><span class="math display">\[ Y_i \mid \mu_i, \sigma^2_i \sim N( \mu_i, \sigma^2_i) \]</span></p>
<ul>
<li>This is equivalent to the following statements</li>
</ul>
<p><span class="math display">\[ Y_i = \mu_i + e_i , \ e_i \sim N(0, \sigma^2)\]</span></p>
<ul>
<li><p>We do not assume the collection of <span class="math inline">\(Y_i, i=1, \ldots, n\)</span> have a normal distribution</p></li>
<li><p>Instead we assume the error term is normally distributed - a lesser assumption!</p></li>
<li><p>In case of multiple predictors, <span class="math inline">\(\mu_i\)</span> becomes a weighted average of the <span class="math inline">\(\beta_j\)</span> values, the regression coefficient with <span class="math inline">\(x_{ij}\)</span> denoting the predictors. For example, for two covariates we have</p></li>
</ul>
<p><span class="math display">\[ E(y_i) = \mu_i = \beta_0 + \beta_1 x_{i1} + \beta_2 x_{i2} \]</span></p>
<ul>
<li>A polynomial regression model of 2 degrees on <span class="math inline">\(x_{i1}\)</span></li>
</ul>
<p><span class="math display">\[ \mu_i = \beta_0 + \beta_1 x_{i1} +  \beta_2 x_{i2} + \beta_3 x_{i1}^2 \]</span></p>
<ul>
<li>Assumptions of linear regression models
<ol style="list-style-type: decimal">
<li><strong>Independent observations</strong></li>
<li><strong>Linear relationship</strong> We can check this assumption by examining marginal plots comparing the model predicted relationship between outcome and each continuous predictor and by examining the residual plot.</li>
<li><strong>Normality of the residuals</strong></li>
<li><strong>Homoscedasticity</strong> Homoscedasticity in a model means that the residual is constant along the values of the dependent variable.</li>
<li><strong>Multicollinearity</strong> Multicollinearity is the phenomenon when a number of the explanatory variables are strongly correlated.</li>
<li><strong>Correctly specified regression model</strong> This means that all relevant predictors for the response variable have been included in the model. This is often difficult to verify, but we can use posterior predictive distribution to check for regression fit.</li>
</ol></li>
</ul>
</div>
<div id="one-sample-and-two-sample-normal-regression" class="section level3 hasAnchor" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> One-sample and two-sample normal regression<a href="BayesReg1.html#one-sample-and-two-sample-normal-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>1. One-sample</strong></p>
<ul>
<li>If all observations have the same mean and variance, the likelihood is</li>
</ul>
<p><span class="math display">\[ Y_i \mid \mu, \sigma^2 \sim N(\mu, \sigma^2)\]</span></p>
<ul>
<li>Good candidate priors for <span class="math inline">\(mu\)</span> and <span class="math inline">\(\sigma\)</span> are
<ul>
<li><span class="math inline">\(\mu \sim N(\text{sample mean}, \text{sample sd})\)</span> or Student-T distributions (to handle heavy tails)</li>
<li><span class="math inline">\(\sigma \sim \text{half-t}(mean = 0, sd = \text{sample sd}, df = 3)\)</span></li>
</ul></li>
</ul>
<p><strong>Modelling height - Textbook example on the Howell data</strong></p>
<p>Suppose we want to fit a one-sample model on height using a dataset of anthropological measurements on a foraging people taken in the 1960s.</p>
<ul>
<li>First let’s examine the summary statistics of variable height</li>
</ul>
<div class="fold s">

<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="BayesReg1.html#cb86-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;data/Howell.txt&quot;</span>,<span class="at">header=</span>T, <span class="at">sep=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb86-2"><a href="BayesReg1.html#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="BayesReg1.html#cb86-3" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">tbl_summary</span>(</span>
<span id="cb86-4"><a href="BayesReg1.html#cb86-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">statistic =</span> <span class="fu">list</span>(<span class="fu">all_continuous</span>() <span class="sc">~</span> <span class="st">&quot;{mean} ({sd})&quot;</span>,</span>
<span id="cb86-5"><a href="BayesReg1.html#cb86-5" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">all_categorical</span>() <span class="sc">~</span> <span class="st">&quot;{n} / {N} ({p}%)&quot;</span>),</span>
<span id="cb86-6"><a href="BayesReg1.html#cb86-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="fu">all_continuous</span>() <span class="sc">~</span> <span class="dv">2</span>)</span></code></pre></div>
<div id="srpwkuzlti" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#srpwkuzlti .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#srpwkuzlti .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#srpwkuzlti .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#srpwkuzlti .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#srpwkuzlti .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#srpwkuzlti .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#srpwkuzlti .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#srpwkuzlti .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#srpwkuzlti .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#srpwkuzlti .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#srpwkuzlti .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#srpwkuzlti .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#srpwkuzlti .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#srpwkuzlti .gt_from_md > :first-child {
  margin-top: 0;
}

#srpwkuzlti .gt_from_md > :last-child {
  margin-bottom: 0;
}

#srpwkuzlti .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#srpwkuzlti .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#srpwkuzlti .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#srpwkuzlti .gt_row_group_first td {
  border-top-width: 2px;
}

#srpwkuzlti .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#srpwkuzlti .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#srpwkuzlti .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#srpwkuzlti .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#srpwkuzlti .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#srpwkuzlti .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#srpwkuzlti .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#srpwkuzlti .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#srpwkuzlti .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#srpwkuzlti .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#srpwkuzlti .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#srpwkuzlti .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#srpwkuzlti .gt_left {
  text-align: left;
}

#srpwkuzlti .gt_center {
  text-align: center;
}

#srpwkuzlti .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#srpwkuzlti .gt_font_normal {
  font-weight: normal;
}

#srpwkuzlti .gt_font_bold {
  font-weight: bold;
}

#srpwkuzlti .gt_font_italic {
  font-style: italic;
}

#srpwkuzlti .gt_super {
  font-size: 65%;
}

#srpwkuzlti .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#srpwkuzlti .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#srpwkuzlti .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#srpwkuzlti .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#srpwkuzlti .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>N = 544</strong><sup class="gt_footnote_marks">1</sup></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">height</td>
<td class="gt_row gt_center">138.26 (27.60)</td></tr>
    <tr><td class="gt_row gt_left">weight</td>
<td class="gt_row gt_center">35.61 (14.72)</td></tr>
    <tr><td class="gt_row gt_left">age</td>
<td class="gt_row gt_center">29.34 (20.75)</td></tr>
    <tr><td class="gt_row gt_left">male</td>
<td class="gt_row gt_center">257 / 544 (47%)</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="2"><sup class="gt_footnote_marks">1</sup> Mean (SD); n / N (%)</td>
    </tr>
  </tfoot>
</table>
</div>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="BayesReg1.html#cb87-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb87-2"><a href="BayesReg1.html#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;weight&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;male&quot;</span>))) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb87-3"><a href="BayesReg1.html#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">10</span>,<span class="at">fill=</span><span class="st">&quot;#008BB0&quot;</span>,<span class="at">colour=</span><span class="st">&quot;#002A5C&quot;</span>) <span class="sc">+</span></span>
<span id="cb87-4"><a href="BayesReg1.html#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb87-5"><a href="BayesReg1.html#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<img src="bayes_bookdown_files/figure-html/unnamed-chunk-90-1.png" width="672" style="display: block; margin: auto;" />
<div>

<ul>
<li>We specify our model with the following priors
<span class="math display">\[ heights_i \sim N (\mu, \sigma)\]</span>
<span class="math display">\[\mu \sim N(138, 28)\]</span>
<span class="math display">\[\sigma \sim \text{half-t}(0, 28, df = 3)\]</span></li>
</ul>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-91"></span>
<img src="bayes_bookdown_files/figure-html/unnamed-chunk-91-1.png" alt="Prior distributions" width="480" />
<p class="caption">
Figure 6.1: Prior distributions
</p>
</div>
<ul>
<li>we now fit this model in brms</li>
</ul>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="BayesReg1.html#cb88-1" aria-hidden="true" tabindex="-1"></a>fit0 <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> dat,</span>
<span id="cb88-2"><a href="BayesReg1.html#cb88-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> gaussian,</span>
<span id="cb88-3"><a href="BayesReg1.html#cb88-3" aria-hidden="true" tabindex="-1"></a>             height <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb88-4"><a href="BayesReg1.html#cb88-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">138</span>, <span class="dv">28</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb88-5"><a href="BayesReg1.html#cb88-5" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">28</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb88-6"><a href="BayesReg1.html#cb88-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">iter =</span> <span class="dv">10000</span>, </span>
<span id="cb88-7"><a href="BayesReg1.html#cb88-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">warmup =</span> <span class="dv">5000</span>, </span>
<span id="cb88-8"><a href="BayesReg1.html#cb88-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">chains =</span> <span class="dv">4</span>, </span>
<span id="cb88-9"><a href="BayesReg1.html#cb88-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">cores =</span> <span class="dv">4</span>, <span class="co">#instructions on MCMC</span></span>
<span id="cb88-10"><a href="BayesReg1.html#cb88-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">seed =</span> <span class="dv">123</span>, <span class="co"># random number seed to make results reproducible</span></span>
<span id="cb88-11"><a href="BayesReg1.html#cb88-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">silent =</span> <span class="dv">2</span>,</span>
<span id="cb88-12"><a href="BayesReg1.html#cb88-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb88-13"><a href="BayesReg1.html#cb88-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-14"><a href="BayesReg1.html#cb88-14" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(fit0, &quot;data/chap7_onesample_example&quot;)</span></span></code></pre></div>
<ul>
<li>Summarizing posterior results</li>
</ul>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-93-1.png" width="672" /></p>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ 1 
##    Data: dat (Number of observations: 544) 
##   Draws: 4 chains, each with iter = 10000; warmup = 5000; thin = 1;
##          total post-warmup draws = 20000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept   138.25      1.18   135.94   140.58 1.00    18944    14350
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma    27.64      0.84    26.06    29.35 1.00    18557    13633
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<ul>
<li>Geweke index and R-hat <span class="citation">(<a href="#ref-geweke1991evaluating" role="doc-biblioref">Geweke et al. 1991</a>)</span> to check for MCMC convergence</li>
</ul>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="BayesReg1.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># modelposterior &lt;- as.mcmc(fit0)</span></span>
<span id="cb90-2"><a href="BayesReg1.html#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="co"># geweke.plot(modelposterior)</span></span>
<span id="cb90-3"><a href="BayesReg1.html#cb90-3" aria-hidden="true" tabindex="-1"></a>modelposterior <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(fit0)</span>
<span id="cb90-4"><a href="BayesReg1.html#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="fu">geweke.diag</span>(modelposterior)</span></code></pre></div>
<pre><code>## 
## Fraction in 1st window = 0.1
## Fraction in 2nd window = 0.5 
## 
## b_Intercept       sigma        lp__ 
##      0.4570      0.2874      0.9759</code></pre>
<ul>
<li>Posterior predictive graphic check for model fit
<ul>
<li>we can see here there is some skewness not captured in the model, this model is not a good fit to the data.</li>
<li>we will revisit the height model in the linear regression section where we add covariates to the model to improve the fit.</li>
</ul></li>
</ul>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-95-1.png" width="432" style="display: block; margin: auto;" /></p>
<div class="guidedexercise">
<p><strong>What is the posterior evidence that mean height is greater than 140cm?</strong></p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="BayesReg1.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hypothesis</span>(fit0, <span class="st">&#39;Intercept &gt; 140&#39;</span> , <span class="at">alpha =</span> <span class="fl">0.025</span>)</span>
<span id="cb92-2"><a href="BayesReg1.html#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="BayesReg1.html#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="co"># proportion of posterior samples on the mean (intercept) </span></span>
<span id="cb92-4"><a href="BayesReg1.html#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="co"># with value &gt; 140, combining 4 chains;</span></span>
<span id="cb92-5"><a href="BayesReg1.html#cb92-5" aria-hidden="true" tabindex="-1"></a>modelposterior2<span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(fit0)</span>
<span id="cb92-6"><a href="BayesReg1.html#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(modelposterior2[,<span class="dv">1</span>]<span class="sc">&gt;</span><span class="dv">140</span>)<span class="sc">/</span><span class="fu">length</span>(modelposterior2[,<span class="dv">1</span>])</span></code></pre></div>
</div>
<p><strong>2. Two-sample</strong></p>
<ul>
<li>Simple extension of the one-sample problem</li>
<li>Observations within the each group have the same mean and variance, yielding the following likelihood
<span class="math display">\[ Y_{ji} \mid \mu_j, \sigma^2_j \sim N(\mu_j, \sigma^2_j)\]</span></li>
<li>Similar candidate prior as in one-sample model
<ul>
<li>using normal or student-t dist and observed summary statistics</li>
<li>within-group variance should be smaller than the variance when we ignore groups</li>
</ul></li>
<li>We can assume equal variance <span class="math inline">\(\sigma_1^2 = \sigma_2^2\)</span> or allow them to be estimated seperately</li>
<li>These two approaches are analogous to the equal-variance and unequal-variance t-tests</li>
<li>In brms, this is easy to specify</li>
</ul>
<p><strong>Modelling hours of sleep comparing between two drugs</strong></p>
<ul>
<li><p>Data which show the effect of two medication (within-patient increase in
hours of sleep) on groups consisting of 10 patients each.</p></li>
<li><p>Source: <a href="https://www.jstor.org/stable/2331554?seq=1#metadata_info_tab_contents">Student (1908)</a> The probable error of a mean. <span class="citation">(<a href="#ref-student1908probable" role="doc-biblioref">Student 1908</a>)</span></p></li>
<li><p>First examine the summary statistics by group</p></li>
</ul>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="BayesReg1.html#cb93-1" aria-hidden="true" tabindex="-1"></a>sleep <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">extra =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="sc">-</span><span class="fl">1.6</span>, <span class="sc">-</span><span class="fl">0.2</span>, <span class="sc">-</span><span class="fl">1.2</span>, <span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">3.4</span>, <span class="fl">3.7</span>, <span class="fl">0.8</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="fl">1.9</span>, <span class="fl">0.8</span>, <span class="fl">1.1</span>, <span class="fl">0.1</span>, <span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">4.4</span>, <span class="fl">5.5</span>, <span class="fl">1.6</span>, <span class="fl">4.6</span>, <span class="fl">3.4</span>), </span>
<span id="cb93-2"><a href="BayesReg1.html#cb93-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb93-3"><a href="BayesReg1.html#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="BayesReg1.html#cb93-4" aria-hidden="true" tabindex="-1"></a>sleep <span class="sc">%&gt;%</span> </span>
<span id="cb93-5"><a href="BayesReg1.html#cb93-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">recode_factor</span>(group,  <span class="st">&#39;1&#39;</span><span class="ot">=</span><span class="st">&quot;Drug A&quot;</span>, <span class="st">&#39;2&#39;</span><span class="ot">=</span><span class="st">&quot;Drug B&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb93-6"><a href="BayesReg1.html#cb93-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_summary</span>(</span>
<span id="cb93-7"><a href="BayesReg1.html#cb93-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> group,</span>
<span id="cb93-8"><a href="BayesReg1.html#cb93-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">statistic =</span> <span class="fu">all_continuous</span>() <span class="sc">~</span> <span class="st">&quot;{mean} ({sd})&quot;</span>,</span>
<span id="cb93-9"><a href="BayesReg1.html#cb93-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="fu">all_continuous</span>() <span class="sc">~</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-10"><a href="BayesReg1.html#cb93-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_overall</span>()</span></code></pre></div>
<div id="vlzwkqlpnq" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#vlzwkqlpnq .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vlzwkqlpnq .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vlzwkqlpnq .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#vlzwkqlpnq .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#vlzwkqlpnq .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vlzwkqlpnq .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vlzwkqlpnq .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vlzwkqlpnq .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vlzwkqlpnq .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vlzwkqlpnq .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vlzwkqlpnq .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vlzwkqlpnq .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#vlzwkqlpnq .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vlzwkqlpnq .gt_from_md > :first-child {
  margin-top: 0;
}

#vlzwkqlpnq .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vlzwkqlpnq .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vlzwkqlpnq .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#vlzwkqlpnq .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#vlzwkqlpnq .gt_row_group_first td {
  border-top-width: 2px;
}

#vlzwkqlpnq .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vlzwkqlpnq .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#vlzwkqlpnq .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#vlzwkqlpnq .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vlzwkqlpnq .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vlzwkqlpnq .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vlzwkqlpnq .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vlzwkqlpnq .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vlzwkqlpnq .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vlzwkqlpnq .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vlzwkqlpnq .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vlzwkqlpnq .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vlzwkqlpnq .gt_left {
  text-align: left;
}

#vlzwkqlpnq .gt_center {
  text-align: center;
}

#vlzwkqlpnq .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vlzwkqlpnq .gt_font_normal {
  font-weight: normal;
}

#vlzwkqlpnq .gt_font_bold {
  font-weight: bold;
}

#vlzwkqlpnq .gt_font_italic {
  font-style: italic;
}

#vlzwkqlpnq .gt_super {
  font-size: 65%;
}

#vlzwkqlpnq .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#vlzwkqlpnq .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#vlzwkqlpnq .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#vlzwkqlpnq .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#vlzwkqlpnq .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>Overall</strong>, N = 20<sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>Drug A</strong>, N = 10<sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>Drug B</strong>, N = 10<sup class="gt_footnote_marks">1</sup></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">extra</td>
<td class="gt_row gt_center">1.54 (2.02)</td>
<td class="gt_row gt_center">0.75 (1.79)</td>
<td class="gt_row gt_center">2.33 (2.00)</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><sup class="gt_footnote_marks">1</sup> Mean (SD)</td>
    </tr>
  </tfoot>
</table>
</div>
<ul>
<li>Fitting two-sample model in brms using default brms prior
<ul>
<li>student_t(3, 1, 2.5) for mean (same for each group)</li>
<li>student_t(3, 0, 2.5) for sigma (same for each group for unequal variance model)</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="BayesReg1.html#cb94-1" aria-hidden="true" tabindex="-1"></a>fit_eq <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> sleep,</span>
<span id="cb94-2"><a href="BayesReg1.html#cb94-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> gaussian,</span>
<span id="cb94-3"><a href="BayesReg1.html#cb94-3" aria-hidden="true" tabindex="-1"></a>             extra <span class="sc">~</span> group, <span class="co">#mean depends on group and one sigma</span></span>
<span id="cb94-4"><a href="BayesReg1.html#cb94-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb94-5"><a href="BayesReg1.html#cb94-5" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb94-6"><a href="BayesReg1.html#cb94-6" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">2</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb94-7"><a href="BayesReg1.html#cb94-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">iter =</span> <span class="dv">10000</span>, </span>
<span id="cb94-8"><a href="BayesReg1.html#cb94-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">warmup =</span> <span class="dv">5000</span>, </span>
<span id="cb94-9"><a href="BayesReg1.html#cb94-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">chains =</span> <span class="dv">4</span>, </span>
<span id="cb94-10"><a href="BayesReg1.html#cb94-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">cores =</span> <span class="dv">4</span>, <span class="co">#instructions on MCMC</span></span>
<span id="cb94-11"><a href="BayesReg1.html#cb94-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">seed =</span> <span class="dv">123</span>, <span class="co"># random number seed to make results reproducible</span></span>
<span id="cb94-12"><a href="BayesReg1.html#cb94-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">silent =</span> <span class="dv">2</span>,</span>
<span id="cb94-13"><a href="BayesReg1.html#cb94-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb94-14"><a href="BayesReg1.html#cb94-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-15"><a href="BayesReg1.html#cb94-15" aria-hidden="true" tabindex="-1"></a><span class="fu">prior_summary</span>(fit_eq)</span>
<span id="cb94-16"><a href="BayesReg1.html#cb94-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-17"><a href="BayesReg1.html#cb94-17" aria-hidden="true" tabindex="-1"></a>fit_uneq <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> sleep,</span>
<span id="cb94-18"><a href="BayesReg1.html#cb94-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> gaussian,</span>
<span id="cb94-19"><a href="BayesReg1.html#cb94-19" aria-hidden="true" tabindex="-1"></a>             <span class="fu">bf</span>(extra <span class="sc">~</span> group, <span class="co">#mean depends on group</span></span>
<span id="cb94-20"><a href="BayesReg1.html#cb94-20" aria-hidden="true" tabindex="-1"></a>             sigma <span class="sc">~</span> group), <span class="co">#sigma differ by group</span></span>
<span id="cb94-21"><a href="BayesReg1.html#cb94-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> Intercept), <span class="co">#prior for intercept of the extra ~ group model;</span></span>
<span id="cb94-22"><a href="BayesReg1.html#cb94-22" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b), <span class="co">#prior for coefficients of the extra ~ group model;</span></span>
<span id="cb94-23"><a href="BayesReg1.html#cb94-23" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">2</span>), <span class="at">class =</span> Intercept, <span class="at">dpar =</span> <span class="st">&quot;sigma&quot;</span>), <span class="co">#prior for intercept of the sigma ~ group model;</span></span>
<span id="cb94-24"><a href="BayesReg1.html#cb94-24" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">2</span>), <span class="at">class =</span> b, <span class="at">dpar =</span> <span class="st">&quot;sigma&quot;</span>)), <span class="co">#prior for coefficients of the sigma ~ group model;</span></span>
<span id="cb94-25"><a href="BayesReg1.html#cb94-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">iter =</span> <span class="dv">10000</span>, </span>
<span id="cb94-26"><a href="BayesReg1.html#cb94-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">warmup =</span> <span class="dv">5000</span>, </span>
<span id="cb94-27"><a href="BayesReg1.html#cb94-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">chains =</span> <span class="dv">4</span>, </span>
<span id="cb94-28"><a href="BayesReg1.html#cb94-28" aria-hidden="true" tabindex="-1"></a>             <span class="at">cores =</span> <span class="dv">4</span>, <span class="co">#instructions on MCMC</span></span>
<span id="cb94-29"><a href="BayesReg1.html#cb94-29" aria-hidden="true" tabindex="-1"></a>             <span class="at">seed =</span> <span class="dv">123</span>, <span class="co"># random number seed to make results reproducible</span></span>
<span id="cb94-30"><a href="BayesReg1.html#cb94-30" aria-hidden="true" tabindex="-1"></a>             <span class="at">silent =</span> <span class="dv">2</span>,</span>
<span id="cb94-31"><a href="BayesReg1.html#cb94-31" aria-hidden="true" tabindex="-1"></a>             <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb94-32"><a href="BayesReg1.html#cb94-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-33"><a href="BayesReg1.html#cb94-33" aria-hidden="true" tabindex="-1"></a><span class="fu">prior_summary</span>(fit_uneq)</span>
<span id="cb94-34"><a href="BayesReg1.html#cb94-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-35"><a href="BayesReg1.html#cb94-35" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(fit_eq, &quot;data/chap7_twosample_eq&quot;)</span></span>
<span id="cb94-36"><a href="BayesReg1.html#cb94-36" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(fit_uneq, &quot;data/chap7_twosample_uneq&quot;)</span></span></code></pre></div>
<ul>
<li>Summarizing posterior results from equal variance model</li>
</ul>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: extra ~ group 
##    Data: sleep (Number of observations: 20) 
##   Draws: 4 chains, each with iter = 10000; warmup = 5000; thin = 1;
##          total post-warmup draws = 20000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.73      0.63    -0.55     1.98 1.00    16492    13222
## group2        1.57      0.91    -0.22     3.38 1.00    16232    12475
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     2.00      0.35     1.44     2.79 1.00    13907    12976
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<ul>
<li>Question: What is the probability that there is more increase in sleep with
drug A? (under equal-variance model)</li>
</ul>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="BayesReg1.html#cb96-1" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(fit_eq)</span>
<span id="cb96-2"><a href="BayesReg1.html#cb96-2" aria-hidden="true" tabindex="-1"></a>difference <span class="ot">&lt;-</span> samples[,<span class="st">&quot;b_group2&quot;</span>]</span>
<span id="cb96-3"><a href="BayesReg1.html#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="co">#summarize the difference</span></span>
<span id="cb96-4"><a href="BayesReg1.html#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">Prob =</span> <span class="fu">mean</span>(difference <span class="sc">&gt;</span> <span class="dv">0</span>), <span class="at">Mean =</span> <span class="fu">mean</span>(difference), <span class="at">lowCrI =</span> <span class="fu">quantile</span>(difference, <span class="fl">0.025</span>), <span class="at">highCrI =</span> <span class="fu">quantile</span>(difference, <span class="dv">1</span><span class="fl">-0.025</span>))</span></code></pre></div>
<pre><code>##          Prob          Mean   lowCrI.2.5% highCrI.97.5% 
##     0.9591500     1.5713935    -0.2217899     3.3785453</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="BayesReg1.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co">#we can also use hypothesis function to evaluate this</span></span>
<span id="cb98-2"><a href="BayesReg1.html#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hypothesis</span>(fit_eq, <span class="st">&quot;group2 &gt; 0&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.025</span>)</span></code></pre></div>
<pre><code>## Hypothesis Tests for class b:
##     Hypothesis Estimate Est.Error CI.Lower CI.Upper Evid.Ratio Post.Prob Star
## 1 (group2) &gt; 0     1.57      0.91    -0.22     3.38      23.48      0.96     
## ---
## &#39;CI&#39;: 95%-CI for one-sided and 97.5%-CI for two-sided hypotheses.
## &#39;*&#39;: For one-sided hypotheses, the posterior probability exceeds 97.5%;
## for two-sided hypotheses, the value tested against lies outside the 97.5%-CI.
## Posterior probabilities of point hypotheses assume equal prior probabilities.</code></pre>
<ul>
<li>Summarizing posterior results from unequal variance model and evaluate the same hypothesis</li>
</ul>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="BayesReg1.html#cb100-1" aria-hidden="true" tabindex="-1"></a>fit_uneq <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/chap7_twosample_uneq&quot;</span>)</span>
<span id="cb100-2"><a href="BayesReg1.html#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_uneq)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = log 
## Formula: extra ~ group 
##          sigma ~ group
##    Data: sleep (Number of observations: 20) 
##   Draws: 4 chains, each with iter = 10000; warmup = 5000; thin = 1;
##          total post-warmup draws = 20000
## 
## Population-Level Effects: 
##                 Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept           0.73      0.63    -0.54     1.97 1.00    15554    10549
## sigma_Intercept     0.63      0.25     0.20     1.17 1.00    15707    11003
## group2              1.57      0.94    -0.27     3.47 1.00    15377    12395
## sigma_group2        0.11      0.35    -0.57     0.80 1.00    14749    11864
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="BayesReg1.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hypothesis</span>(fit_uneq, <span class="st">&quot;group2 &gt; 0&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.025</span>)</span></code></pre></div>
<pre><code>## Hypothesis Tests for class b:
##     Hypothesis Estimate Est.Error CI.Lower CI.Upper Evid.Ratio Post.Prob Star
## 1 (group2) &gt; 0     1.57      0.94    -0.27     3.47         21      0.95     
## ---
## &#39;CI&#39;: 95%-CI for one-sided and 97.5%-CI for two-sided hypotheses.
## &#39;*&#39;: For one-sided hypotheses, the posterior probability exceeds 97.5%;
## for two-sided hypotheses, the value tested against lies outside the 97.5%-CI.
## Posterior probabilities of point hypotheses assume equal prior probabilities.</code></pre>
<p><strong>How to determine equal variance or not?</strong></p>
<ul>
<li>Approach 1, visually examine the conditional mean by group.</li>
<li>Approach 2, comparing models using information criteria (WAIC) or leave-one-out cross validation (LOO) <span class="citation">(<a href="#ref-vehtari2017practical" role="doc-biblioref">Vehtari, Gelman, and Gabry 2017</a>)</span></li>
<li><strong>Both approaches confirm the equal variance model is the best model!</strong></li>
</ul>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="BayesReg1.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">conditional_effects</span>(fit_uneq), <span class="at">points =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-102-1.png" width="288" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="BayesReg1.html#cb105-1" aria-hidden="true" tabindex="-1"></a>waic1 <span class="ot">&lt;-</span> <span class="fu">waic</span>(fit_eq)</span>
<span id="cb105-2"><a href="BayesReg1.html#cb105-2" aria-hidden="true" tabindex="-1"></a>waic2 <span class="ot">&lt;-</span> <span class="fu">waic</span>(fit_uneq)</span>
<span id="cb105-3"><a href="BayesReg1.html#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_ic</span>(waic1, waic2) <span class="co">#equal var best model;</span></span></code></pre></div>
<pre><code>##                    WAIC   SE
## fit_eq            85.98 4.25
## fit_uneq          87.57 4.54
## fit_eq - fit_uneq -1.59 0.60</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="BayesReg1.html#cb107-1" aria-hidden="true" tabindex="-1"></a>loo1 <span class="ot">&lt;-</span> <span class="fu">loo</span>(fit_eq)</span>
<span id="cb107-2"><a href="BayesReg1.html#cb107-2" aria-hidden="true" tabindex="-1"></a>loo2 <span class="ot">&lt;-</span> <span class="fu">loo</span>(fit_uneq)</span>
<span id="cb107-3"><a href="BayesReg1.html#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(loo1, loo2) <span class="co">#equal var best model;</span></span></code></pre></div>
<pre><code>##          elpd_diff se_diff
## fit_eq    0.0       0.0   
## fit_uneq -0.9       0.3</code></pre>
</div>
<div id="linear-regression" class="section level3 hasAnchor" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> Linear regression<a href="BayesReg1.html#linear-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>The two-sample model is a special case of regression</li>
</ul>
<p><span class="math display">\[\mu_i = \beta_0 + \beta_1 x_i\]</span></p>
<ul>
<li>Where <span class="math inline">\(x_i = 0\)</span> for group 1 and <span class="math inline">\(x_i = 1\)</span> for group 2
<ul>
<li>For group 1, <span class="math inline">\(\mu_i = \beta_0\)</span>, the intercept</li>
<li>For group 2, <span class="math inline">\(\mu_i = \beta_0 + \beta_1\)</span></li>
</ul></li>
<li>brms takes care of creating dummy variables!</li>
<li>but be aware of what the reference group is and what the coefficients mean</li>
<li>levels will be by default in alphabetical order - use the factor() statement to make a variable with the desired order</li>
</ul>
<div class="guidedexercise">
<p><strong>Try fitting the two-sample sleep data without the intercept</strong></p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="BayesReg1.html#cb109-1" aria-hidden="true" tabindex="-1"></a>fit_eq2 <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> sleep,</span>
<span id="cb109-2"><a href="BayesReg1.html#cb109-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> gaussian,</span>
<span id="cb109-3"><a href="BayesReg1.html#cb109-3" aria-hidden="true" tabindex="-1"></a>             extra <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> group, <span class="co">#mean depends on group and one sigma</span></span>
<span id="cb109-4"><a href="BayesReg1.html#cb109-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">iter =</span> <span class="dv">10000</span>, </span>
<span id="cb109-5"><a href="BayesReg1.html#cb109-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">warmup =</span> <span class="dv">5000</span>, </span>
<span id="cb109-6"><a href="BayesReg1.html#cb109-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">chains =</span> <span class="dv">4</span>, </span>
<span id="cb109-7"><a href="BayesReg1.html#cb109-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">cores =</span> <span class="dv">4</span>, <span class="co">#instructions on MCMC</span></span>
<span id="cb109-8"><a href="BayesReg1.html#cb109-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">seed =</span> <span class="dv">123</span>, <span class="co"># random number seed to make results reproducible</span></span>
<span id="cb109-9"><a href="BayesReg1.html#cb109-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">silent =</span> <span class="dv">2</span>,</span>
<span id="cb109-10"><a href="BayesReg1.html#cb109-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb109-11"><a href="BayesReg1.html#cb109-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_eq2)</span></code></pre></div>
</div>
<ul>
<li>In general, for a regression model</li>
</ul>
<p><span class="math display">\[ y_i \mid \mu_i, \sigma^2_i \sim N(\mu_i, \sigma^2_i)\]</span>
<span class="math display">\[ \mu_i = \beta_0 + \beta_1 x_{i1} + \ldots + \beta_p x_{ip}\]</span>
- where the <span class="math inline">\(x_{ij}\)</span> can be continuous variables or “dummy” variables
- the usual assumption on the variance is <span class="math inline">\(\sigma_i^2 = \sigma^2\)</span> for all subjects (Homoscedasticity - equal variance assumption)
- <strong>We can seen that is technically easier to relax this assumption in a Bayesian model!</strong> (two-sample unequal variance example)</p>
<ul>
<li>Predictions
<ul>
<li>We can get the predictions fro the mean value at a given value of the predictors. For example, in simple linear regression model we have</li>
</ul>
<span class="math display">\[E(Y\mid X=x) = \beta_0 + \beta_1 x\]</span>
<ul>
<li>but recall that both <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> have posterior distributions</li>
<li>For each posterior draws of <span class="math inline">\((\beta_0, \beta_1)^s, s= 1, \ldots, S\)</span>, we have a different predicted mean</li>
</ul>
<span class="math display">\[E(Y\mid X=x, S=s) = \beta_0^s + \beta_1^s x\]</span>
<ul>
<li>The set of values of these predictions across all sampled values give the posterior for the predicted mean</li>
</ul></li>
</ul>
<p><strong>Modelling height - Howell data revisit</strong></p>
<ul>
<li>Let’s descriptively examine the height distribution by weight, age, and sex
<ul>
<li>We can see that the relationship between age and height is not linear</li>
<li>we consider the following model</li>
</ul>
<span class="math display">\[heights_i \sim N(\mu_i, \sigma)\]</span>
<span class="math display">\[\mu_i = \beta_0 + \beta_1 \ weight_i + \beta_2 \ age_i + \beta_3 \ age_i^2 +\beta_4 \ \text{I(sex=male)}\]</span></li>
</ul>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-104-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li>we consider the following prior distributions (diffuse normal on regression parameter and exponential distribution for <span class="math inline">\(\sigma\)</span>)
<span class="math display">\[\beta_0 \sim N(0, 100) \]</span>
<span class="math display">\[\beta_1 \sim N(0, 10) \]</span>
<span class="math display">\[\beta_2 \sim N(0, 10) \]</span>
<span class="math display">\[\beta_3 \sim N(0, 10) \]</span>
<span class="math display">\[\beta_4 \sim N(0, 10) \]</span>
<span class="math display">\[ \sigma \sim Gamma(1, 0.01) \]</span></li>
</ul>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-105"></span>
<img src="bayes_bookdown_files/figure-html/unnamed-chunk-105-1.png" alt="Prior distributions" width="768" />
<p class="caption">
Figure 6.2: Prior distributions
</p>
</div>
<ul>
<li>we now fit this model in brms</li>
</ul>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="BayesReg1.html#cb110-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb110-2"><a href="BayesReg1.html#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">male =</span> <span class="fu">factor</span>(male, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>)))</span>
<span id="cb110-3"><a href="BayesReg1.html#cb110-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-4"><a href="BayesReg1.html#cb110-4" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> dat,</span>
<span id="cb110-5"><a href="BayesReg1.html#cb110-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> gaussian,</span>
<span id="cb110-6"><a href="BayesReg1.html#cb110-6" aria-hidden="true" tabindex="-1"></a>             height <span class="sc">~</span> weight <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> male,</span>
<span id="cb110-7"><a href="BayesReg1.html#cb110-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb110-8"><a href="BayesReg1.html#cb110-8" aria-hidden="true" tabindex="-1"></a>                       <span class="co"># set for all &quot;b&quot; coefficients</span></span>
<span id="cb110-9"><a href="BayesReg1.html#cb110-9" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb110-10"><a href="BayesReg1.html#cb110-10" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">prior</span>(<span class="fu">gamma</span>(<span class="dv">1</span>, <span class="fl">0.01</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb110-11"><a href="BayesReg1.html#cb110-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">iter =</span> <span class="dv">20000</span>,</span>
<span id="cb110-12"><a href="BayesReg1.html#cb110-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">warmup =</span> <span class="dv">18000</span>,</span>
<span id="cb110-13"><a href="BayesReg1.html#cb110-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb110-14"><a href="BayesReg1.html#cb110-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">cores =</span> <span class="dv">4</span>, <span class="co">#instructions on MCMC</span></span>
<span id="cb110-15"><a href="BayesReg1.html#cb110-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">seed =</span> <span class="dv">123</span>, <span class="co"># random number seed to make results reproducible</span></span>
<span id="cb110-16"><a href="BayesReg1.html#cb110-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">silent =</span> <span class="dv">2</span>,</span>
<span id="cb110-17"><a href="BayesReg1.html#cb110-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb110-18"><a href="BayesReg1.html#cb110-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-19"><a href="BayesReg1.html#cb110-19" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(fit1, &quot;data/chap7_reg_example&quot;)</span></span></code></pre></div>
<ul>
<li>Summarizing posterior results</li>
</ul>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ weight + age + I(age^2) + male 
##    Data: dat (Number of observations: 544) 
##   Draws: 4 chains, each with iter = 20000; warmup = 18000; thin = 1;
##          total post-warmup draws = 8000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    75.53      1.01    73.52    77.50 1.00     8716     6882
## weight        1.26      0.06     1.15     1.37 1.00     3406     4486
## age           1.06      0.11     0.84     1.29 1.00     3169     4137
## IageE2       -0.01      0.00    -0.01    -0.01 1.00     3297     4224
## malemale      1.86      0.80     0.33     3.41 1.00     5375     4740
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     8.70      0.27     8.20     9.23 1.00     6501     5373
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<ul>
<li>Using the posterior mean, we have the following regression line</li>
</ul>
<p><span class="math display">\[\hat{height}_i =  75.53 + 1.26 \ weight_i + 1.06 \ age_i -0.01 \ age_i^2 + 1.86 \ \text{I(sex=male)}\]</span></p>
<ul>
<li><p>Comparing between male and female of the same weight and age, the expected difference on height is estimated at 1.86cm with 95% CI[0.33, 3.41].</p></li>
<li><p>What is the posterior evidence that there’s a positive association between height and sex?</p></li>
</ul>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="BayesReg1.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hypothesis</span>(fit1, <span class="st">&#39;malemale &gt; 0&#39;</span> , <span class="at">alpha =</span> <span class="fl">0.025</span>)</span></code></pre></div>
<pre><code>## Hypothesis Tests for class b:
##       Hypothesis Estimate Est.Error CI.Lower CI.Upper Evid.Ratio Post.Prob Star
## 1 (malemale) &gt; 0     1.86       0.8     0.33     3.41         99      0.99    *
## ---
## &#39;CI&#39;: 95%-CI for one-sided and 97.5%-CI for two-sided hypotheses.
## &#39;*&#39;: For one-sided hypotheses, the posterior probability exceeds 97.5%;
## for two-sided hypotheses, the value tested against lies outside the 97.5%-CI.
## Posterior probabilities of point hypotheses assume equal prior probabilities.</code></pre>
<ul>
<li>we can visualize conditional effect of each continuous covariates on the response variable
<ul>
<li>one might consider fitting <span class="math inline">\(weight^2\)</span>!</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="BayesReg1.html#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">conditional_effects</span>(fit1, <span class="st">&quot;weight&quot;</span>),<span class="at">points =</span> <span class="cn">TRUE</span>, <span class="at">point_args =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-109-1.png" width="288" /></p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="BayesReg1.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">conditional_effects</span>(fit1, <span class="st">&quot;age&quot;</span>),<span class="at">points =</span> <span class="cn">TRUE</span>, <span class="at">point_args =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-109-2.png" width="288" /></p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="BayesReg1.html#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">conditional_effects</span>(fit1, <span class="st">&quot;male&quot;</span>))</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-109-3.png" width="288" /></p>
<ul>
<li>Coefficient of determination <span class="math inline">\(R^2\)</span> is the proportion of the variation in the dependent variable that is predictable from the independent variable(s).
<ul>
<li>The estimated <span class="math inline">\(R^2\)</span> is about 0.9. Really good! About 90% of the variance on height is explained by our model.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="BayesReg1.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bayes_R2</span>(fit1)</span></code></pre></div>
<pre><code>##     Estimate   Est.Error      Q2.5     Q97.5
## R2 0.9010756 0.002608764 0.8953755 0.9055377</code></pre>
<ul>
<li>predictive intervals
<ul>
<li>predicting height for a female, 33 years of age and weighting 60kg</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="BayesReg1.html#cb119-1" aria-hidden="true" tabindex="-1"></a>ind_predic <span class="ot">&lt;-</span> <span class="fu">posterior_predict</span>(fit1, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">weight =</span> <span class="dv">60</span>, <span class="at">age =</span> <span class="dv">33</span>, <span class="at">male =</span> <span class="st">&quot;female&quot;</span>))</span>
<span id="cb119-2"><a href="BayesReg1.html#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="co"># mean of the predicted heights</span></span>
<span id="cb119-3"><a href="BayesReg1.html#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(ind_predic)</span></code></pre></div>
<pre><code>## [1] 174.3464</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="BayesReg1.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct a 95% posterior credible interval</span></span>
<span id="cb121-2"><a href="BayesReg1.html#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_interval</span>(ind_predic, <span class="at">prob =</span> <span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>##          2.5%    97.5%
## [1,] 157.0509 191.5679</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="BayesReg1.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Posterior predictive probability of height &gt; 164</span></span>
<span id="cb123-2"><a href="BayesReg1.html#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(ind_predic<span class="sc">&gt;</span><span class="dv">164</span>)<span class="sc">/</span><span class="fu">length</span>(ind_predic)</span></code></pre></div>
<pre><code>## [1] 0.88075</code></pre>
</div>
<div id="model-diagnostics" class="section level3 hasAnchor" number="6.1.3">
<h3><span class="header-section-number">6.1.3</span> Model diagnostics<a href="BayesReg1.html#model-diagnostics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Geweke index and R-hat <span class="citation">(<a href="#ref-geweke1991evaluating" role="doc-biblioref">Geweke et al. 1991</a>)</span> to check for MCMC convergence</li>
</ul>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="BayesReg1.html#cb125-1" aria-hidden="true" tabindex="-1"></a>modelposterior<span class="ot">&lt;-</span> <span class="fu">as_draws_matrix</span>(fit1)</span>
<span id="cb125-2"><a href="BayesReg1.html#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geweke.diag</span>(modelposterior)</span></code></pre></div>
<pre><code>## 
## Fraction in 1st window = 0.1
## Fraction in 2nd window = 0.5 
## 
## b_Intercept    b_weight       b_age    b_IageE2  b_malemale       sigma 
##     1.10099    -0.36665     0.04242    -0.04991    -0.05772    -0.37171 
##        lp__ 
##     1.16552</code></pre>
<ul>
<li>Posterior predictive graphic check for model fit</li>
<li>A “good” Bayesian model produces posterior predicted sets of response values with features similar to the original data.
<ul>
<li>It appears our model can be improved! One suggestion is to fit a non-linear term for weight variable.</li>
<li>sometime, people also consider data transformation, e.g., log(height)</li>
<li>we can also try using student-t distribution not normal distribution to fit the mean!</li>
<li>the observed min and max height is not covered in our posterior predictive samples…</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="BayesReg1.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(fit1, <span class="at">ndraws =</span> <span class="dv">50</span>)</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-113-1.png" width="432" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="BayesReg1.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(fit1, <span class="at">type =</span> <span class="st">&quot;stat_2d&quot;</span>, <span class="at">stat =</span> <span class="fu">c</span>(<span class="st">&quot;max&quot;</span>, <span class="st">&quot;min&quot;</span>))</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-113-2.png" width="432" style="display: block; margin: auto;" /></p>
<ul>
<li>Residual plot by continuous variables - checking for linearity assumption</li>
</ul>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="BayesReg1.html#cb129-1" aria-hidden="true" tabindex="-1"></a>res_df <span class="ot">&lt;-</span> fit1<span class="sc">$</span>data <span class="sc">%&gt;%</span> </span>
<span id="cb129-2"><a href="BayesReg1.html#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predict_y =</span> <span class="fu">predict</span>(fit1)[ , <span class="st">&quot;Estimate&quot;</span>], </span>
<span id="cb129-3"><a href="BayesReg1.html#cb129-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">std_resid =</span> <span class="fu">residuals</span>(fit1, <span class="at">type =</span> <span class="st">&quot;pearson&quot;</span>)[ , <span class="st">&quot;Estimate&quot;</span>])</span>
<span id="cb129-4"><a href="BayesReg1.html#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(res_df, </span>
<span id="cb129-5"><a href="BayesReg1.html#cb129-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(predict_y, std_resid)) <span class="sc">+</span> </span>
<span id="cb129-6"><a href="BayesReg1.html#cb129-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Standardized residuals&quot;</span>) <span class="sc">+</span></span>
<span id="cb129-7"><a href="BayesReg1.html#cb129-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-114-1.png" width="288" style="display: block; margin: auto;" /></p>
<ul>
<li>multicollinearity
<ul>
<li>If some coefficients are particularly strongly correlated, you may need to think about using a stronger prior or combining some predictors.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="BayesReg1.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(fit1, <span class="at">pars =</span> <span class="st">&quot;b&quot;</span>, </span>
<span id="cb130-2"><a href="BayesReg1.html#cb130-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">off_diag_args =</span>  <span class="co"># arguments of the scatterplots</span></span>
<span id="cb130-3"><a href="BayesReg1.html#cb130-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">size =</span> <span class="fl">0.5</span>,  <span class="co"># point size</span></span>
<span id="cb130-4"><a href="BayesReg1.html#cb130-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.25</span>))  <span class="co"># transparency</span></span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-115-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="model-comparision" class="section level3 hasAnchor" number="6.1.4">
<h3><span class="header-section-number">6.1.4</span> Model comparision<a href="BayesReg1.html#model-comparision" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="important">
<p><strong>Watanabe-Akaike Information Criteria (WAIC)</strong></p>
<ul>
<li>WAIC <span class="citation">(<a href="#ref-watanabe2010asymptotic" role="doc-biblioref">Watanabe and Opper 2010</a>)</span> is an alternative approach to DIC in estimating the expected log point-wise predictive density</li>
<li>The smaller the better!</li>
<li>WAIC incorporates prior information, and the use of point-wise likelihood makes it more robust when the posterior distributions deviate from normality.</li>
<li>In general, WAIC is a better estimate of the out-of-sample deviance than AIC and DIC.</li>
<li>In R under brms package we can use <code>waic()</code> function to obtain WAIC.</li>
</ul>
<p><strong>Bayesian Leave-one-out cross-validation</strong></p>
<ul>
<li><p>The idea of cross-validation is to split the sample so that it imitates the scenario of estimating the parameters in part of the data and predicting the remaining part.</p>
<ul>
<li>data that are used for estimation is called the training set, and data that are used for prediction is called the validation set.</li>
</ul></li>
<li><p>Leave-one-out information criteria (LOO-IC) based on posterior predictive distribution</p>
<ul>
<li>means that one uses <span class="math inline">\(n-1\)</span> observations as the training set and 1 observation as the validation sample, repeat the process <span class="math inline">\(n\)</span> times so that each time a different observation is being predicted</li>
</ul></li>
<li><p>LOO-IC requires fitting the model <span class="math inline">\(n\)</span> times, it is generally very computational intensive</p></li>
<li><p>WAIC can be treated as a fast approximation of LOO-IC, although LOO-IC is more robust and will be a better estimate of out-of-sample deviance</p></li>
<li><p>In R under brms package we can use <code>loo()</code> function to obtain LOO-IC.</p></li>
</ul>
</div>
<div class="guidedexercise">
<p><strong>Comparing model with <span class="math inline">\(weight^2\)</span> </strong></p>
<ul>
<li>fitting the new model on height, adjusting for age, sex, weight, <span class="math inline">\(age^2\)</span> and <span class="math inline">\(weight^2\)</span></li>
<li>comparing this model to the regression model adjusted for age, <span class="math inline">\(age^2\)</span>, sex, and weight using WAIC and LOO.</li>
</ul>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="BayesReg1.html#cb131-1" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> dat,</span>
<span id="cb131-2"><a href="BayesReg1.html#cb131-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> gaussian,</span>
<span id="cb131-3"><a href="BayesReg1.html#cb131-3" aria-hidden="true" tabindex="-1"></a>             height <span class="sc">~</span> weight <span class="sc">+</span> <span class="fu">I</span>(weight<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> male, </span>
<span id="cb131-4"><a href="BayesReg1.html#cb131-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb131-5"><a href="BayesReg1.html#cb131-5" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb131-6"><a href="BayesReg1.html#cb131-6" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">prior</span>(<span class="fu">gamma</span>(<span class="dv">1</span>, <span class="fl">0.01</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb131-7"><a href="BayesReg1.html#cb131-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">iter =</span> <span class="dv">20000</span>, </span>
<span id="cb131-8"><a href="BayesReg1.html#cb131-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">warmup =</span> <span class="dv">18000</span>, </span>
<span id="cb131-9"><a href="BayesReg1.html#cb131-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">chains =</span> <span class="dv">4</span>, </span>
<span id="cb131-10"><a href="BayesReg1.html#cb131-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">cores =</span> <span class="dv">4</span>, <span class="co">#instructions on MCMC</span></span>
<span id="cb131-11"><a href="BayesReg1.html#cb131-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">seed =</span> <span class="dv">123</span>, <span class="co"># random number seed to make results reproducible</span></span>
<span id="cb131-12"><a href="BayesReg1.html#cb131-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">silent =</span> <span class="dv">2</span>,</span>
<span id="cb131-13"><a href="BayesReg1.html#cb131-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb131-14"><a href="BayesReg1.html#cb131-14" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(fit2, <span class="st">&quot;data/chp7_height2&quot;</span>)</span>
<span id="cb131-15"><a href="BayesReg1.html#cb131-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-16"><a href="BayesReg1.html#cb131-16" aria-hidden="true" tabindex="-1"></a>waic1 <span class="ot">&lt;-</span> <span class="fu">waic</span>(fit1)</span>
<span id="cb131-17"><a href="BayesReg1.html#cb131-17" aria-hidden="true" tabindex="-1"></a>waic2 <span class="ot">&lt;-</span> <span class="fu">waic</span>(fit2)</span>
<span id="cb131-18"><a href="BayesReg1.html#cb131-18" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_ic</span>(waic1, waic2) </span>
<span id="cb131-19"><a href="BayesReg1.html#cb131-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-20"><a href="BayesReg1.html#cb131-20" aria-hidden="true" tabindex="-1"></a>loo1 <span class="ot">&lt;-</span> <span class="fu">loo</span>(fit1)</span>
<span id="cb131-21"><a href="BayesReg1.html#cb131-21" aria-hidden="true" tabindex="-1"></a>loo2 <span class="ot">&lt;-</span> <span class="fu">loo</span>(fit2)</span>
<span id="cb131-22"><a href="BayesReg1.html#cb131-22" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(loo1, loo2)</span></code></pre></div>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="BayesReg1.html#cb132-1" aria-hidden="true" tabindex="-1"></a>fit2<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">&quot;data/chp7_height2&quot;</span>)</span>
<span id="cb132-2"><a href="BayesReg1.html#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(fit2, <span class="at">ndraws =</span> <span class="dv">50</span>)</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-117-1.png" width="432" /></p>
</div>
</div>
</div>
<div id="hierarchical-models" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Hierarchical models<a href="BayesReg1.html#hierarchical-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>Often models have more complex structures than the ones described by likelihood
and priors and simple relationships between data and parameters</p></li>
<li><p>In these models data and parameters participate in relationships of hierarchical
fashion</p>
<ul>
<li>e.g., Correlated and clustering data structures, such as measures within patients, patients within clinics etc.</li>
</ul></li>
<li><p>Bayesian models deal with hierarchical models in a natural and intuitive way <span class="citation">(<a href="#ref-burkner2017advanced" role="doc-biblioref">Bürkner 2017</a>)</span></p></li>
<li><p>Source of correlation in clustered (or longitudinal) data</p>
<ul>
<li>between-individual heterogeneity on i) mean and ii) velocity (rate of change; slop)</li>
<li>Within-individual/cluster homogeneity</li>
</ul></li>
</ul>
<div class="important">
<p><strong>Bayesian Hierarchical Models</strong></p>
<ul>
<li>Often Bayesian models can we written in the following layers of
the hierarchy
<ol style="list-style-type: decimal">
<li><strong>Data Layer</strong> <span class="math inline">\(Y \mid \theta\)</span>, the likelihood for the observed data <span class="math inline">\(Y\)</span> given model parameters <span class="math inline">\(\theta\)</span>.</li>
<li><strong>Adaptive/Structural Priors</strong> <span class="math inline">\(\theta \mid \alpha, \beta\)</span>, the model for parameter <span class="math inline">\(\theta\)</span> that defined by the latent data generating process governed by the hyperparameters <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span></li>
<li><strong>Hyper Priors</strong> <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> as hyper parameters.</li>
</ol></li>
</ul>
</div>
<p>Let’s look at a hospital mortality study as an example. This data capture hospital mortality for a specific condition at 20 different hospitals. There is also a variable that describes the average severity of patients at each hospital.</p>
<ul>
<li>First let’s examine the data</li>
</ul>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="BayesReg1.html#cb133-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;data/HospitalMortality.csv&quot;</span>,<span class="at">sep=</span><span class="st">&quot;,&quot;</span>, <span class="at">header=</span>T)</span>
<span id="cb133-2"><a href="BayesReg1.html#cb133-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-3"><a href="BayesReg1.html#cb133-3" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb133-4"><a href="BayesReg1.html#cb133-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Hospital =</span> <span class="fu">factor</span>(Hospital),</span>
<span id="cb133-5"><a href="BayesReg1.html#cb133-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">Prop.Dead =</span> <span class="fu">round</span>(Deaths<span class="sc">/</span>N,<span class="dv">3</span>))</span>
<span id="cb133-6"><a href="BayesReg1.html#cb133-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-7"><a href="BayesReg1.html#cb133-7" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">datatable</span>(</span>
<span id="cb133-8"><a href="BayesReg1.html#cb133-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb133-9"><a href="BayesReg1.html#cb133-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb133-10"><a href="BayesReg1.html#cb133-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">className =</span> <span class="st">&#39;dt-center&#39;</span>, </span>
<span id="cb133-11"><a href="BayesReg1.html#cb133-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">targets =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>))))</span></code></pre></div>
<div id="htmlwidget-d4b0a1b4bfe65772b4a3" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-d4b0a1b4bfe65772b4a3">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25"],[4.2,4.3,3.3,2.3,2.7,3.9,4.1,3.3,4,-0.2,4.6,5.8,3.6,4.9,3.9,6.9,7.2,3.6,4.5,4.6,4.9,4.3,3.6,2.9,4.6],[5,2,13,3,1,7,1,3,4,12,10,8,25,22,7,23,62,5,9,15,9,17,7,3,9],[209,24,319,109,60,164,32,57,89,340,196,65,250,290,153,92,267,140,138,192,142,211,196,149,203],[0.024,0.083,0.041,0.028,0.017,0.043,0.031,0.053,0.045,0.035,0.051,0.123,0.1,0.076,0.046,0.25,0.232,0.036,0.065,0.078,0.063,0.081,0.036,0.02,0.044]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Hospital<\/th>\n      <th>Severity<\/th>\n      <th>Deaths<\/th>\n      <th>N<\/th>\n      <th>Prop.Dead<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-center","targets":[0,1,2,3,4]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="BayesReg1.html#cb134-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(Severity, Prop.Dead) <span class="sc">%&gt;%</span> <span class="fu">tbl_summary</span>()</span></code></pre></div>
<div id="uqbugxsudt" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#uqbugxsudt .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#uqbugxsudt .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#uqbugxsudt .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#uqbugxsudt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#uqbugxsudt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uqbugxsudt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#uqbugxsudt .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#uqbugxsudt .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#uqbugxsudt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#uqbugxsudt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#uqbugxsudt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#uqbugxsudt .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#uqbugxsudt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#uqbugxsudt .gt_from_md > :first-child {
  margin-top: 0;
}

#uqbugxsudt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#uqbugxsudt .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#uqbugxsudt .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#uqbugxsudt .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#uqbugxsudt .gt_row_group_first td {
  border-top-width: 2px;
}

#uqbugxsudt .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#uqbugxsudt .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#uqbugxsudt .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#uqbugxsudt .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uqbugxsudt .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#uqbugxsudt .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#uqbugxsudt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#uqbugxsudt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uqbugxsudt .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#uqbugxsudt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#uqbugxsudt .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#uqbugxsudt .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#uqbugxsudt .gt_left {
  text-align: left;
}

#uqbugxsudt .gt_center {
  text-align: center;
}

#uqbugxsudt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#uqbugxsudt .gt_font_normal {
  font-weight: normal;
}

#uqbugxsudt .gt_font_bold {
  font-weight: bold;
}

#uqbugxsudt .gt_font_italic {
  font-style: italic;
}

#uqbugxsudt .gt_super {
  font-size: 65%;
}

#uqbugxsudt .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#uqbugxsudt .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#uqbugxsudt .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#uqbugxsudt .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#uqbugxsudt .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>N = 25</strong><sup class="gt_footnote_marks">1</sup></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">Severity</td>
<td class="gt_row gt_center">4.10 (3.60, 4.60)</td></tr>
    <tr><td class="gt_row gt_left">Prop.Dead</td>
<td class="gt_row gt_center">0.05 (0.04, 0.08)</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="2"><sup class="gt_footnote_marks">1</sup> Median (IQR)</td>
    </tr>
  </tfoot>
</table>
</div>
<p><strong>1. First model - considering independent between hospital mortality</strong></p>
<ul>
<li>We are modelling <span class="math display">\[Deaths_i \sim Bin(p_i, n_i)\]</span>, where <span class="math inline">\(i = 1, \ldots, 25\)</span> and <span class="math inline">\(p_i\)</span> represent the risk of death for the <span class="math inline">\(i\)</span> hospital with a beta(1,1) prior on all <span class="math inline">\(p_i\)</span>s</li>
<li>This model is saying that there is nothing to link mortality in hospital 1 to mortality in any other hospital
<ul>
<li>We are essentially estimating the risk of mortality for each hospital</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="BayesReg1.html#cb135-1" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> dat,</span>
<span id="cb135-2"><a href="BayesReg1.html#cb135-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">family=</span> binomial,</span>
<span id="cb135-3"><a href="BayesReg1.html#cb135-3" aria-hidden="true" tabindex="-1"></a>            Deaths <span class="sc">|</span> <span class="fu">trials</span>(N) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Hospital,  </span>
<span id="cb135-4"><a href="BayesReg1.html#cb135-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">iter =</span> <span class="dv">10000</span>,</span>
<span id="cb135-5"><a href="BayesReg1.html#cb135-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">warmup =</span> <span class="dv">8000</span>,</span>
<span id="cb135-6"><a href="BayesReg1.html#cb135-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb135-7"><a href="BayesReg1.html#cb135-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">cores =</span> <span class="dv">4</span>, </span>
<span id="cb135-8"><a href="BayesReg1.html#cb135-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">seed =</span> <span class="dv">123</span>, </span>
<span id="cb135-9"><a href="BayesReg1.html#cb135-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">silent =</span> <span class="dv">2</span>,</span>
<span id="cb135-10"><a href="BayesReg1.html#cb135-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb135-11"><a href="BayesReg1.html#cb135-11" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(fit1, &quot;data/chap7_h_example1&quot;)</span></span></code></pre></div>
<ul>
<li>Summarizing posterior results</li>
</ul>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="BayesReg1.html#cb136-1" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/chap7_h_example1&quot;</span>)</span>
<span id="cb136-2"><a href="BayesReg1.html#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="co">#posterior summary of risk (table);</span></span>
<span id="cb136-3"><a href="BayesReg1.html#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">exp</span>(<span class="fu">fixef</span>(fit1)),<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##            Estimate Est.Error  Q2.5 Q97.5
## Hospital1     0.022     1.609 0.008 0.051
## Hospital2     0.071     2.257 0.012 0.283
## Hospital3     0.041     1.337 0.022 0.070
## Hospital4     0.024     1.881 0.006 0.066
## Hospital5     0.010     3.566 0.000 0.064
## Hospital6     0.042     1.494 0.018 0.086
## Hospital7     0.018     3.728 0.001 0.124
## Hospital8     0.047     1.913 0.011 0.143
## Hospital9     0.041     1.728 0.012 0.105
## Hospital10    0.035     1.350 0.019 0.061
## Hospital11    0.051     1.389 0.026 0.093
## Hospital12    0.133     1.472 0.058 0.270
## Hospital13    0.109     1.238 0.071 0.164
## Hospital14    0.081     1.249 0.051 0.122
## Hospital15    0.045     1.500 0.019 0.093
## Hospital16    0.329     1.279 0.200 0.527
## Hospital17    0.301     1.159 0.224 0.398
## Hospital18    0.034     1.629 0.012 0.079
## Hospital19    0.066     1.430 0.031 0.125
## Hospital20    0.082     1.317 0.046 0.136
## Hospital21    0.064     1.415 0.031 0.122
## Hospital22    0.085     1.289 0.050 0.137
## Hospital23    0.035     1.493 0.015 0.070
## Hospital24    0.017     1.920 0.004 0.051
## Hospital25    0.044     1.420 0.021 0.083</code></pre>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="BayesReg1.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co">#posterior summary of risk (visual);</span></span>
<span id="cb138-2"><a href="BayesReg1.html#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit1, <span class="at">transformations =</span> <span class="st">&quot;plogis&quot;</span>)</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-120-1.png" width="672" /></p>
<p><strong>2. Second model - shared parameters on hospital mortality (complete pooling)</strong></p>
<ul>
<li><p>Suppose that these were 25 hospitals in the same city</p>
<ul>
<li>Similar practices, populations, shared staff in some cases</li>
</ul></li>
<li><p>How can we treat them as one big hospital with exactly the same mortality?</p>
<ul>
<li>Easy - specify in the model that they share the same probability <span class="math inline">\(p\)</span></li>
</ul></li>
<li><p>Parameterizing using odds</p>
<ul>
<li>Odds are the basis for logistic regression, where we model log(odds)</li>
<li><span class="math inline">\(0 \leq p \leq 1 \Rightarrow - \infty \leq \log(Odds) \leq \infty\)</span></li>
<li>Suggests an normal uninformative prior on log odds with a sufficient variance (ie sd = 10)</li>
</ul>
<p><span class="math display">\[ \log(Odds) \sim N(0,\sigma^2)\]</span></p></li>
<li><p>Assume a common odds between all 25 hospitals, we run a pooled model such that <span class="math display">\[Deaths_i \sim Bin(p, n_i)\]</span>. This is a complete pooling model.</p></li>
<li><p>We are essentially modelling the average population risk of mortality pooling information from all 25 hospitals.</p></li>
</ul>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="BayesReg1.html#cb139-1" aria-hidden="true" tabindex="-1"></a>fit1.p <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> dat,</span>
<span id="cb139-2"><a href="BayesReg1.html#cb139-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">family=</span> binomial,</span>
<span id="cb139-3"><a href="BayesReg1.html#cb139-3" aria-hidden="true" tabindex="-1"></a>            Deaths <span class="sc">|</span> <span class="fu">trials</span>(N) <span class="sc">~</span> <span class="dv">1</span>,  </span>
<span id="cb139-4"><a href="BayesReg1.html#cb139-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">iter =</span> <span class="dv">10000</span>,</span>
<span id="cb139-5"><a href="BayesReg1.html#cb139-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">warmup =</span> <span class="dv">8000</span>,</span>
<span id="cb139-6"><a href="BayesReg1.html#cb139-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb139-7"><a href="BayesReg1.html#cb139-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">cores =</span> <span class="dv">4</span>, </span>
<span id="cb139-8"><a href="BayesReg1.html#cb139-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">seed =</span> <span class="dv">123</span>, </span>
<span id="cb139-9"><a href="BayesReg1.html#cb139-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">silent =</span> <span class="dv">2</span>,</span>
<span id="cb139-10"><a href="BayesReg1.html#cb139-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb139-11"><a href="BayesReg1.html#cb139-11" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(fit1.p, &quot;data/chap7_h_example1p&quot;)</span></span></code></pre></div>
<ul>
<li>Summarizing posterior results</li>
</ul>
<pre><code>##           Estimate Est.Error  Q2.5 Q97.5
## Intercept    0.074     1.063 0.066 0.083</code></pre>
<ul>
<li>Drawbacks of a complete pooling approach</li>
</ul>
<p>There are two main drawbacks to taking a complete pooling approach to analyze group structured data:</p>
<ul>
<li>in case of clustered and correlated data, we violate the assumption of independence</li>
<li>misleading conclusions about the relationship between and across subjects</li>
</ul>
<p><strong>3. third model - shared parameters on hospital mortality (partial pooling)</strong></p>
<ul>
<li><p>Suppose that these were 25 hospitals in the same city</p>
<ul>
<li>Similar (but <strong>not same</strong>) practices and patient populations; partly shared staff</li>
</ul></li>
<li><p>How can we treat them as similar</p>
<ul>
<li>with a common underlying true mortality</li>
<li>with <strong>random variation</strong> from hospital to hospital in the true mortality!</li>
</ul></li>
<li><p>Need to introduce two parameters representing</p>
<ul>
<li>Common mortality (mean log odds)</li>
<li>Hospital-to-hospital variation (sd of log odds)</li>
</ul></li>
<li><p>This introduces an <strong>hierarchical structure</strong> in the model!</p></li>
<li><p>Specifically, we have</p>
<ol style="list-style-type: decimal">
<li><strong>Data Layer</strong> <span class="math inline">\(y_i \mid p_i \sim P(y_i \mid p_i)\)</span></li>
<li><strong>Adaptive/Structural Priors</strong> <span class="math inline">\(logit(p_i) \mid \theta, \sigma^2 \sim P(logit(p_i) \mid \theta, \sigma^2)\)</span></li>
<li><strong>Hyper Priors</strong> <span class="math inline">\(\theta \sim P(\theta)\)</span> and <span class="math inline">\(\sigma^2 ~ P(\sigma^2)\)</span> as hyper parameters.</li>
</ol></li>
<li><p>A Bayesian random intercept model!</p></li>
</ul>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="BayesReg1.html#cb141-1" aria-hidden="true" tabindex="-1"></a>fit1.ri <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> dat,</span>
<span id="cb141-2"><a href="BayesReg1.html#cb141-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">family=</span> binomial,</span>
<span id="cb141-3"><a href="BayesReg1.html#cb141-3" aria-hidden="true" tabindex="-1"></a>            Deaths <span class="sc">|</span> <span class="fu">trials</span>(N) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Hospital),  </span>
<span id="cb141-4"><a href="BayesReg1.html#cb141-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">iter =</span> <span class="dv">10000</span>,</span>
<span id="cb141-5"><a href="BayesReg1.html#cb141-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">warmup =</span> <span class="dv">8000</span>,</span>
<span id="cb141-6"><a href="BayesReg1.html#cb141-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb141-7"><a href="BayesReg1.html#cb141-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">cores =</span> <span class="dv">4</span>, </span>
<span id="cb141-8"><a href="BayesReg1.html#cb141-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">seed =</span> <span class="dv">123</span>, </span>
<span id="cb141-9"><a href="BayesReg1.html#cb141-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">silent =</span> <span class="dv">2</span>,</span>
<span id="cb141-10"><a href="BayesReg1.html#cb141-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb141-11"><a href="BayesReg1.html#cb141-11" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(fit1.ri, &quot;data/chap7_h_example1ri&quot;)</span></span></code></pre></div>
<ul>
<li>Summarizing posterior results on risk and between-hospital standard deviation of the intercept</li>
</ul>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="BayesReg1.html#cb142-1" aria-hidden="true" tabindex="-1"></a>fit1.ri <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/chap7_h_example1ri&quot;</span>)</span>
<span id="cb142-2"><a href="BayesReg1.html#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit1.ri)</span></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: Deaths | trials(N) ~ 1 + (1 | Hospital) 
##    Data: dat (Number of observations: 25) 
##   Draws: 4 chains, each with iter = 10000; warmup = 8000; thin = 1;
##          total post-warmup draws = 8000
## 
## Group-Level Effects: 
## ~Hospital (Number of levels: 25) 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)     0.71      0.13     0.49     1.01 1.00     3005     4847
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -2.82      0.17    -3.15    -2.50 1.00     2301     3937
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="BayesReg1.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co">#posterior summary of risk overall (table);</span></span>
<span id="cb144-2"><a href="BayesReg1.html#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">exp</span>(<span class="fu">fixef</span>(fit1.ri)),<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##           Estimate Est.Error  Q2.5 Q97.5
## Intercept     0.06      1.18 0.043 0.082</code></pre>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="BayesReg1.html#cb146-1" aria-hidden="true" tabindex="-1"></a>s1 <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(fit1.ri)</span>
<span id="cb146-2"><a href="BayesReg1.html#cb146-2" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> s1[,<span class="st">&quot;sd_Hospital__Intercept&quot;</span>]</span>
<span id="cb146-3"><a href="BayesReg1.html#cb146-3" aria-hidden="true" tabindex="-1"></a>qs <span class="ot">&lt;-</span> <span class="fu">quantile</span>(sigma,<span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="cb146-4"><a href="BayesReg1.html#cb146-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-5"><a href="BayesReg1.html#cb146-5" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">density</span>(sigma,<span class="at">n =</span> <span class="dv">1024</span>)</span>
<span id="cb146-6"><a href="BayesReg1.html#cb146-6" aria-hidden="true" tabindex="-1"></a>dp1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">sigma=</span>temp<span class="sc">$</span>x, <span class="at">density=</span>temp<span class="sc">$</span>y, <span class="at">area=</span><span class="fu">cut</span>(temp<span class="sc">$</span>x, <span class="fu">c</span>(<span class="dv">0</span>,qs,<span class="dv">10</span>), <span class="at">include.lowest =</span> T))</span>
<span id="cb146-7"><a href="BayesReg1.html#cb146-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-8"><a href="BayesReg1.html#cb146-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dp1, <span class="fu">aes</span>(<span class="at">x=</span>sigma, <span class="at">y=</span>density))<span class="sc">+</span><span class="fu">geom_area</span>(<span class="fu">aes</span>(<span class="at">fill=</span>area), <span class="at">show.legend=</span><span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb146-9"><a href="BayesReg1.html#cb146-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb146-10"><a href="BayesReg1.html#cb146-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">color=</span><span class="st">&quot;orange&quot;</span>)<span class="sc">+</span></span>
<span id="cb146-11"><a href="BayesReg1.html#cb146-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(<span class="st">&quot;Mean sigma= &quot;</span>, <span class="fu">round</span>(<span class="fu">mean</span>(sigma),<span class="dv">2</span>),<span class="st">&quot;; 95% CrI: &quot;</span>, <span class="fu">round</span>(qs[<span class="dv">1</span>],<span class="dv">1</span>),</span>
<span id="cb146-12"><a href="BayesReg1.html#cb146-12" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot; to &quot;</span>,<span class="fu">round</span>(qs[<span class="dv">2</span>],<span class="dv">2</span>)))<span class="sc">+</span></span>
<span id="cb146-13"><a href="BayesReg1.html#cb146-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;orange&quot;</span>,<span class="st">&quot;white&quot;</span>,<span class="st">&quot;orange&quot;</span>))</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-124-1.png" width="672" /></p>
<ul>
<li>Hospitals, ranked best to worst by posterior odds of mortality (median ranking on mortality, along with a 95% CrI)</li>
</ul>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="BayesReg1.html#cb147-1" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> s1[,<span class="fu">grep</span>(<span class="st">&quot;,Intercept&quot;</span>,<span class="fu">names</span>(s1))]</span>
<span id="cb147-2"><a href="BayesReg1.html#cb147-2" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">apply</span>(h,<span class="dv">1</span>,rank)</span>
<span id="cb147-3"><a href="BayesReg1.html#cb147-3" aria-hidden="true" tabindex="-1"></a>rankings <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">apply</span>(r,<span class="dv">1</span>,quantile, <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))))</span>
<span id="cb147-4"><a href="BayesReg1.html#cb147-4" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(rankings) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Hospital&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>)</span>
<span id="cb147-5"><a href="BayesReg1.html#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(rankings)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Median&quot;</span></span>
<span id="cb147-6"><a href="BayesReg1.html#cb147-6" aria-hidden="true" tabindex="-1"></a>rankings <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(rankings, <span class="at">ObservedProportion=</span><span class="fu">round</span>(dat<span class="sc">$</span>Deaths<span class="sc">/</span>dat<span class="sc">$</span>N,<span class="dv">3</span>), <span class="at">n=</span>dat<span class="sc">$</span>N)</span>
<span id="cb147-7"><a href="BayesReg1.html#cb147-7" aria-hidden="true" tabindex="-1"></a>rankings <span class="ot">&lt;-</span> rankings[<span class="fu">order</span>(rankings[,<span class="dv">1</span>]),]</span>
<span id="cb147-8"><a href="BayesReg1.html#cb147-8" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(rankings, <span class="at">caption=</span><span class="st">&quot;Hospitals, ranked best to worst by posterior odds of mortality&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-125">Table 6.1: </span>Hospitals, ranked best to worst by posterior odds of mortality</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Median</th>
<th align="right">X2.5.</th>
<th align="right">X97.5.</th>
<th align="right">ObservedProportion</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Hospital 1</td>
<td align="right">4</td>
<td align="right">1</td>
<td align="right">14</td>
<td align="right">0.024</td>
<td align="right">209</td>
</tr>
<tr class="even">
<td align="left">Hospital 24</td>
<td align="right">4</td>
<td align="right">1</td>
<td align="right">15</td>
<td align="right">0.020</td>
<td align="right">149</td>
</tr>
<tr class="odd">
<td align="left">Hospital 5</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">20</td>
<td align="right">0.017</td>
<td align="right">60</td>
</tr>
<tr class="even">
<td align="left">Hospital 4</td>
<td align="right">6</td>
<td align="right">1</td>
<td align="right">18</td>
<td align="right">0.028</td>
<td align="right">109</td>
</tr>
<tr class="odd">
<td align="left">Hospital 10</td>
<td align="right">7</td>
<td align="right">1</td>
<td align="right">15</td>
<td align="right">0.035</td>
<td align="right">340</td>
</tr>
<tr class="even">
<td align="left">Hospital 23</td>
<td align="right">7</td>
<td align="right">1</td>
<td align="right">18</td>
<td align="right">0.036</td>
<td align="right">196</td>
</tr>
<tr class="odd">
<td align="left">Hospital 18</td>
<td align="right">8</td>
<td align="right">1</td>
<td align="right">19</td>
<td align="right">0.036</td>
<td align="right">140</td>
</tr>
<tr class="even">
<td align="left">Hospital 3</td>
<td align="right">9</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">0.041</td>
<td align="right">319</td>
</tr>
<tr class="odd">
<td align="left">Hospital 6</td>
<td align="right">10</td>
<td align="right">2</td>
<td align="right">20</td>
<td align="right">0.043</td>
<td align="right">164</td>
</tr>
<tr class="even">
<td align="left">Hospital 7</td>
<td align="right">10</td>
<td align="right">1</td>
<td align="right">22</td>
<td align="right">0.031</td>
<td align="right">32</td>
</tr>
<tr class="odd">
<td align="left">Hospital 9</td>
<td align="right">11</td>
<td align="right">1</td>
<td align="right">21</td>
<td align="right">0.045</td>
<td align="right">89</td>
</tr>
<tr class="even">
<td align="left">Hospital 15</td>
<td align="right">11</td>
<td align="right">2</td>
<td align="right">20</td>
<td align="right">0.046</td>
<td align="right">153</td>
</tr>
<tr class="odd">
<td align="left">Hospital 25</td>
<td align="right">11</td>
<td align="right">2</td>
<td align="right">19</td>
<td align="right">0.044</td>
<td align="right">203</td>
</tr>
<tr class="even">
<td align="left">Hospital 8</td>
<td align="right">13</td>
<td align="right">2</td>
<td align="right">23</td>
<td align="right">0.053</td>
<td align="right">57</td>
</tr>
<tr class="odd">
<td align="left">Hospital 11</td>
<td align="right">13</td>
<td align="right">3</td>
<td align="right">21</td>
<td align="right">0.051</td>
<td align="right">196</td>
</tr>
<tr class="even">
<td align="left">Hospital 19</td>
<td align="right">16</td>
<td align="right">5</td>
<td align="right">22</td>
<td align="right">0.065</td>
<td align="right">138</td>
</tr>
<tr class="odd">
<td align="left">Hospital 21</td>
<td align="right">16</td>
<td align="right">5</td>
<td align="right">22</td>
<td align="right">0.063</td>
<td align="right">142</td>
</tr>
<tr class="even">
<td align="left">Hospital 2</td>
<td align="right">17</td>
<td align="right">2</td>
<td align="right">23</td>
<td align="right">0.083</td>
<td align="right">24</td>
</tr>
<tr class="odd">
<td align="left">Hospital 14</td>
<td align="right">18</td>
<td align="right">11</td>
<td align="right">23</td>
<td align="right">0.076</td>
<td align="right">290</td>
</tr>
<tr class="even">
<td align="left">Hospital 20</td>
<td align="right">19</td>
<td align="right">10</td>
<td align="right">23</td>
<td align="right">0.078</td>
<td align="right">192</td>
</tr>
<tr class="odd">
<td align="left">Hospital 22</td>
<td align="right">19</td>
<td align="right">11</td>
<td align="right">23</td>
<td align="right">0.081</td>
<td align="right">211</td>
</tr>
<tr class="even">
<td align="left">Hospital 12</td>
<td align="right">22</td>
<td align="right">12</td>
<td align="right">23</td>
<td align="right">0.123</td>
<td align="right">65</td>
</tr>
<tr class="odd">
<td align="left">Hospital 13</td>
<td align="right">22</td>
<td align="right">16</td>
<td align="right">23</td>
<td align="right">0.100</td>
<td align="right">250</td>
</tr>
<tr class="even">
<td align="left">Hospital 16</td>
<td align="right">24</td>
<td align="right">24</td>
<td align="right">25</td>
<td align="right">0.250</td>
<td align="right">92</td>
</tr>
<tr class="odd">
<td align="left">Hospital 17</td>
<td align="right">25</td>
<td align="right">24</td>
<td align="right">25</td>
<td align="right">0.232</td>
<td align="right">267</td>
</tr>
</tbody>
</table>
<div id="clustered-data-multi-level" class="section level3 hasAnchor" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Clustered data (Multi-level)<a href="BayesReg1.html#clustered-data-multi-level" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>Example: Developmental toxicity study of ethylene glycol (EG) <span class="citation">(<a href="#ref-price1985developmental" role="doc-biblioref">Price et al. 1985</a>)</span></p></li>
<li><p>The data are from a development toxicity study of ethylene glycol (EG).</p></li>
<li><p>Ethylene glycol is a high-volume industrial chemical used in many applications.</p></li>
<li><p>In a study of laboratory mice conducted through the National Toxicology Program (NTP), EG was administered at doses of 0, 750, 1500, or 3000 mg/kg/day to 94 pregnant mice (dams) over the period of major organogenesis, beginning just after implantation.</p></li>
<li><p>Following sacrifice, fetal weight and evidence of malformations were recorded</p></li>
<li><p>Let’s first read in the data</p>
<ul>
<li>This data set is in a long format</li>
<li>we can see each row represents a mouse.</li>
<li>Mice are nested within the litter. <strong>We have a two-level data!</strong></li>
</ul></li>
</ul>
<div class="fold s">

<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="BayesReg1.html#cb148-1" aria-hidden="true" tabindex="-1"></a>ntp <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;data/ntp-data.txt&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-2"><a href="BayesReg1.html#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ntp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Litter&quot;</span>, <span class="st">&quot;Dose&quot;</span>, <span class="st">&quot;Weight&quot;</span>, <span class="st">&quot;Malformation&quot;</span>)</span>
<span id="cb148-3"><a href="BayesReg1.html#cb148-3" aria-hidden="true" tabindex="-1"></a>ntp <span class="ot">&lt;-</span> ntp <span class="sc">%&gt;%</span></span>
<span id="cb148-4"><a href="BayesReg1.html#cb148-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Litter) <span class="sc">%&gt;%</span></span>
<span id="cb148-5"><a href="BayesReg1.html#cb148-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Litid =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> <span class="co"># seq id for each litter</span></span>
<span id="cb148-6"><a href="BayesReg1.html#cb148-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FetalID =</span> <span class="fu">paste0</span>(Litter, <span class="st">&quot;.&quot;</span>, Litid)) <span class="sc">%&gt;%</span> <span class="co"># FetalID = LitID.tempid</span></span>
<span id="cb148-7"><a href="BayesReg1.html#cb148-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Litid) <span class="co"># remove tempid from toxic2</span></span>
<span id="cb148-8"><a href="BayesReg1.html#cb148-8" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(ntp), <span class="at">row.names =</span> F)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">Litter</th>
<th align="right">Dose</th>
<th align="right">Weight</th>
<th align="right">Malformation</th>
<th align="left">FetalID</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">60</td>
<td align="right">0</td>
<td align="right">0.828</td>
<td align="right">0</td>
<td align="left">60.1</td>
</tr>
<tr class="even">
<td align="right">60</td>
<td align="right">0</td>
<td align="right">0.953</td>
<td align="right">0</td>
<td align="left">60.2</td>
</tr>
<tr class="odd">
<td align="right">60</td>
<td align="right">0</td>
<td align="right">0.954</td>
<td align="right">0</td>
<td align="left">60.3</td>
</tr>
<tr class="even">
<td align="right">60</td>
<td align="right">0</td>
<td align="right">1.070</td>
<td align="right">0</td>
<td align="left">60.4</td>
</tr>
<tr class="odd">
<td align="right">60</td>
<td align="right">0</td>
<td align="right">1.065</td>
<td align="right">0</td>
<td align="left">60.5</td>
</tr>
<tr class="even">
<td align="right">60</td>
<td align="right">0</td>
<td align="right">0.959</td>
<td align="right">0</td>
<td align="left">60.6</td>
</tr>
</tbody>
</table>
<div>

<ul>
<li>Number of doses in each group and number of fetuses in each litter</li>
</ul>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="BayesReg1.html#cb149-1" aria-hidden="true" tabindex="-1"></a>cluster <span class="ot">&lt;-</span> ntp <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Dose) <span class="sc">%&gt;%</span></span>
<span id="cb149-2"><a href="BayesReg1.html#cb149-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">nlitter =</span> <span class="fu">n_distinct</span>(Litter), <span class="at">nfetal =</span> <span class="fu">n_distinct</span>(FetalID))</span>
<span id="cb149-3"><a href="BayesReg1.html#cb149-3" aria-hidden="true" tabindex="-1"></a>cluster <span class="sc">%&gt;%</span> <span class="fu">datatable</span>(</span>
<span id="cb149-4"><a href="BayesReg1.html#cb149-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb149-5"><a href="BayesReg1.html#cb149-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb149-6"><a href="BayesReg1.html#cb149-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">className =</span> <span class="st">&#39;dt-center&#39;</span>, </span>
<span id="cb149-7"><a href="BayesReg1.html#cb149-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">targets =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>))))</span></code></pre></div>
<div id="htmlwidget-7355ae11ae4a3af417f6" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-7355ae11ae4a3af417f6">{"x":{"filter":"none","vertical":false,"data":[[0,750,1500,3000],[25,24,22,23],[296,276,229,226]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Dose<\/th>\n      <th>nlitter<\/th>\n      <th>nfetal<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-center","targets":[0,1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="BayesReg1.html#cb150-1" aria-hidden="true" tabindex="-1"></a>clustersize <span class="ot">&lt;-</span> ntp <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Litter) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">csize =</span> <span class="fu">n_distinct</span>(FetalID))</span>
<span id="cb150-2"><a href="BayesReg1.html#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="co"># clustersize %&gt;% datatable(</span></span>
<span id="cb150-3"><a href="BayesReg1.html#cb150-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   rownames = FALSE,</span></span>
<span id="cb150-4"><a href="BayesReg1.html#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   options = list(</span></span>
<span id="cb150-5"><a href="BayesReg1.html#cb150-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     columnDefs = list(list(className = &#39;dt-center&#39;, </span></span>
<span id="cb150-6"><a href="BayesReg1.html#cb150-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                       targets = 0:1))))</span></span>
<span id="cb150-7"><a href="BayesReg1.html#cb150-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-8"><a href="BayesReg1.html#cb150-8" aria-hidden="true" tabindex="-1"></a>clustersize <span class="sc">%&gt;%</span></span>
<span id="cb150-9"><a href="BayesReg1.html#cb150-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Litter, <span class="at">y =</span> csize)) <span class="sc">+</span></span>
<span id="cb150-10"><a href="BayesReg1.html#cb150-10" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="at">color =</span> <span class="st">&quot;snow1&quot;</span>)<span class="sc">+</span></span>
<span id="cb150-11"><a href="BayesReg1.html#cb150-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-127-2.png" width="672" /></p>
<ul>
<li>Visualize relationship between fetal malformation and dose</li>
</ul>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="BayesReg1.html#cb151-1" aria-hidden="true" tabindex="-1"></a>ntp <span class="sc">%&gt;%</span></span>
<span id="cb151-2"><a href="BayesReg1.html#cb151-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Dose, Litter) <span class="sc">%&gt;%</span></span>
<span id="cb151-3"><a href="BayesReg1.html#cb151-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">fmalprop =</span> <span class="fu">mean</span>(Malformation)) <span class="sc">%&gt;%</span></span>
<span id="cb151-4"><a href="BayesReg1.html#cb151-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Litter, <span class="at">y =</span> fmalprop)) <span class="sc">+</span></span>
<span id="cb151-5"><a href="BayesReg1.html#cb151-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb151-6"><a href="BayesReg1.html#cb151-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Proportion of Malformation&quot;</span>)<span class="sc">+</span></span>
<span id="cb151-7"><a href="BayesReg1.html#cb151-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Dose)<span class="sc">+</span></span>
<span id="cb151-8"><a href="BayesReg1.html#cb151-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-128-1.png" width="672" /></p>
<ul>
<li>Visualize relationship between fetal weight and dose</li>
</ul>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="BayesReg1.html#cb152-1" aria-hidden="true" tabindex="-1"></a>ntp <span class="sc">%&gt;%</span></span>
<span id="cb152-2"><a href="BayesReg1.html#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Litter, <span class="at">y =</span> Weight)) <span class="sc">+</span></span>
<span id="cb152-3"><a href="BayesReg1.html#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">group =</span> Litter), <span class="at">color =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb152-4"><a href="BayesReg1.html#cb152-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Dose)<span class="sc">+</span></span>
<span id="cb152-5"><a href="BayesReg1.html#cb152-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-129-1.png" width="672" /></p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="BayesReg1.html#cb153-1" aria-hidden="true" tabindex="-1"></a>ntp <span class="ot">&lt;-</span> ntp <span class="sc">%&gt;%</span> </span>
<span id="cb153-2"><a href="BayesReg1.html#cb153-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Dose =</span> <span class="fu">factor</span>(Dose, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>,<span class="st">&quot;750&quot;</span>,<span class="st">&quot;1500&quot;</span>,<span class="st">&quot;3000&quot;</span>)))</span></code></pre></div>
<ul>
<li><p>Suppose we are interested to assess the effect of dose on fetal weight.</p></li>
<li><p>The data on fetal weight from this experiment are clustered, with observations on the fetuses nested within litters.</p></li>
<li><p><strong>First model - Normal hierarchical model with random intercept</strong></p></li>
<li><p>data structure: model of fetal weight within each litter (index by j)
<span class="math display">\[ Y_{ij} \mid \mu_j, \sigma_y \sim N(\mu_j, \sigma_y^2)\]</span></p></li>
<li><p>adaptive priors on litter-level mean</p></li>
</ul>
<p><span class="math display">\[\mu_j \mid \mu, \sigma_\mu \sim N(\mu, \sigma_u^2)\]</span></p>
<ul>
<li><p>hyperparameter priors on <span class="math inline">\(\mu\)</span>, <span class="math inline">\(\sigma_u\)</span> as well as global prior for <span class="math inline">\(\sigma_y\)</span></p></li>
<li><p>Variability within litter by dose</p>
<ul>
<li>in this model, only <span class="math inline">\(\beta_{0j}\)</span> depends on litter</li>
<li><span class="math inline">\(\beta_{1}\)</span> is shared across all litter <span class="math inline">\(j\)</span>, the expected change in fetal weight comparing between various dosage to reference level (dose = 0)</li>
<li><span class="math inline">\(\sigma_y\)</span> measures <strong>Within-group variability</strong> around the mean regression model <span class="math inline">\(\beta_{0j} + \beta_{1} \ dose_{ij}\)</span></li>
</ul></li>
</ul>
<p><span class="math display">\[\mu_{ij} = \beta_{0j} + \beta_{1} \ dose_{ij}\]</span></p>
<ul>
<li>specifying our hierarchical random intercepts model (update with <span class="math inline">\(\beta\)</span>):</li>
</ul>
<p><span class="math display">\[ Y_{ij} \mid \beta_{0j}, \beta_{1}, \sigma_y \sim N(\beta_{0j} + \beta_{1} \ dose_{ij}, \sigma_y^2) \]</span></p>
<p><span class="math display">\[\beta_{0j} \mid \beta_{0}, \sigma_0^2\]</span></p>
<p><span class="math display">\[\beta_{0} \sim N(0,10)\]</span>
<span class="math display">\[\beta_{1} \sim N(0,10)\]</span>
<span class="math display">\[\sigma_y \sim HalfCauchy(10)\]</span>
<span class="math display">\[\sigma_0 \sim HalfCauchy(10)\]</span></p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="BayesReg1.html#cb154-1" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> ntp,</span>
<span id="cb154-2"><a href="BayesReg1.html#cb154-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">family=</span> <span class="fu">gaussian</span>(),</span>
<span id="cb154-3"><a href="BayesReg1.html#cb154-3" aria-hidden="true" tabindex="-1"></a>            Weight <span class="sc">~</span> Dose <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Litter),  </span>
<span id="cb154-4"><a href="BayesReg1.html#cb154-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb154-5"><a href="BayesReg1.html#cb154-5" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb154-6"><a href="BayesReg1.html#cb154-6" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> sd),</span>
<span id="cb154-7"><a href="BayesReg1.html#cb154-7" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb154-8"><a href="BayesReg1.html#cb154-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">iter =</span> <span class="dv">10000</span>,</span>
<span id="cb154-9"><a href="BayesReg1.html#cb154-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">warmup =</span> <span class="dv">8000</span>,</span>
<span id="cb154-10"><a href="BayesReg1.html#cb154-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb154-11"><a href="BayesReg1.html#cb154-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">cores =</span> <span class="dv">4</span>, </span>
<span id="cb154-12"><a href="BayesReg1.html#cb154-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">seed =</span> <span class="dv">123</span>, </span>
<span id="cb154-13"><a href="BayesReg1.html#cb154-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">silent =</span> <span class="dv">2</span>,</span>
<span id="cb154-14"><a href="BayesReg1.html#cb154-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb154-15"><a href="BayesReg1.html#cb154-15" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(fit2, &quot;data/chap7_h_example2&quot;)</span></span></code></pre></div>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="BayesReg1.html#cb155-1" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/chap7_h_example2&quot;</span>)</span>
<span id="cb155-2"><a href="BayesReg1.html#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit2)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: Weight ~ Dose + (1 | Litter) 
##    Data: ntp (Number of observations: 1027) 
##   Draws: 4 chains, each with iter = 10000; warmup = 8000; thin = 1;
##          total post-warmup draws = 8000
## 
## Group-Level Effects: 
## ~Litter (Number of levels: 94) 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)     0.09      0.01     0.07     0.10 1.00      991     1619
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.97      0.02     0.94     1.01 1.01      692     1418
## Dose750      -0.09      0.03    -0.14    -0.04 1.00      808     1647
## Dose1500     -0.19      0.03    -0.24    -0.14 1.00      974     2217
## Dose3000     -0.26      0.03    -0.31    -0.21 1.00      794     1737
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.07      0.00     0.07     0.08 1.00     6968     5538
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="BayesReg1.html#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># checking traceplot</span></span>
<span id="cb157-2"><a href="BayesReg1.html#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="co"># fit2 %&gt;% plot( combo = c(&quot;hist&quot;, &quot;trace&quot;), widths = c(1, 1.5),</span></span>
<span id="cb157-3"><a href="BayesReg1.html#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="co">#       theme = theme_bw(base_size = 10))</span></span>
<span id="cb157-4"><a href="BayesReg1.html#cb157-4" aria-hidden="true" tabindex="-1"></a><span class="fu">conditional_effects</span>(fit2)</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-131-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li>The adjusted ICC represents the proportion of variance of the outcome that are due to between-level (e.g., between-group, between-person) differences
<ul>
<li><strong>Does not consider fixed effect!</strong> In this case, adjusted ICC does not feature variation caused by dose.</li>
</ul></li>
</ul>
<p><span class="math display">\[\rho_{adj} = \frac{\sigma_0^2}{\sigma_0^2 + \sigma^2}\]</span></p>
<ul>
<li><p>where <span class="math inline">\(\sigma_0^2\)</span> is the between-level SD, which is the SD of cluster means (i.e., variability between litters) and <span class="math inline">\(\sigma\)</span> is the observation-specific SD (i.e., variability within a litter)</p></li>
<li><p>The conditional ICC considers variation with fixed effect, in this case dose.</p></li>
</ul>
<p><span class="math display">\[\rho_{c} = \frac{\sigma_0^2}{\sigma_0^2 + \sigma^2 + \sigma_f^2}\]</span></p>
<p><span class="math display">\[\sigma_f^2 = var(\sum_{m=1}^p \beta_m x_{mij}), p \text{ # of coefficients exclude } \beta_0\]</span></p>
<ul>
<li><p>reference: <span class="citation">(<a href="#ref-nakagawa2017coefficient" role="doc-biblioref">Nakagawa, Johnson, and Schielzeth 2017</a>)</span> <a href="https://royalsocietypublishing.org/doi/10.1098/rsif.2017.0213">doi: 10.1098/rsif.2017.0213</a></p></li>
<li><p>We can use the posterior draws of the two SD to compute the posterior for the adjusted ICC:</p></li>
</ul>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="BayesReg1.html#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing ICC</span></span>
<span id="cb158-2"><a href="BayesReg1.html#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Obtain posterior draws of tau and sigma</span></span>
<span id="cb158-3"><a href="BayesReg1.html#cb158-3" aria-hidden="true" tabindex="-1"></a>sd_m2 <span class="ot">&lt;-</span> <span class="fu">VarCorr</span>(fit2, <span class="at">summary =</span> <span class="cn">FALSE</span>)</span>
<span id="cb158-4"><a href="BayesReg1.html#cb158-4" aria-hidden="true" tabindex="-1"></a>draws_tau <span class="ot">&lt;-</span> sd_m2<span class="sc">$</span>Litter<span class="sc">$</span>sd[ , <span class="st">&quot;Intercept&quot;</span>]  <span class="co"># tau</span></span>
<span id="cb158-5"><a href="BayesReg1.html#cb158-5" aria-hidden="true" tabindex="-1"></a>draws_sigma <span class="ot">&lt;-</span> sd_m2<span class="sc">$</span>residual__<span class="sc">$</span>sd[ , <span class="dv">1</span>]  <span class="co">#sigma</span></span>
<span id="cb158-6"><a href="BayesReg1.html#cb158-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Compute draws for adjusted ICC</span></span>
<span id="cb158-7"><a href="BayesReg1.html#cb158-7" aria-hidden="true" tabindex="-1"></a>draws_icc <span class="ot">&lt;-</span> draws_tau<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> (draws_tau<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> draws_sigma<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb158-8"><a href="BayesReg1.html#cb158-8" aria-hidden="true" tabindex="-1"></a><span class="co"># quantile of posterior adjusted ICC</span></span>
<span id="cb158-9"><a href="BayesReg1.html#cb158-9" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(draws_icc, <span class="at">p=</span><span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.025</span>,<span class="fl">0.975</span>))   </span></code></pre></div>
<pre><code>##       50%      2.5%     97.5% 
## 0.5623851 0.4789231 0.6524716</code></pre>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="BayesReg1.html#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the adjusted ICC</span></span>
<span id="cb160-2"><a href="BayesReg1.html#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(draws_icc, <span class="at">geom =</span> <span class="st">&quot;density&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;ICC adjust&quot;</span>, <span class="at">bw =</span> <span class="st">&quot;SJ&quot;</span>)</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-132-1.png" width="672" /></p>
<ul>
<li><p>It was estimated that 56%, 95% CI [48%, 65%] of the variations in fetal weight was attributed to between-litter differences.</p></li>
<li><p>We can use the posterior draws of b_Dose750, b_Dose1500, and b_Dose3000 (fix effects) to compute the posterior for the conditional ICC:</p></li>
</ul>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="BayesReg1.html#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sjstats::icc(fit2) point estimate of adjusted and conditional ICC;</span></span>
<span id="cb161-2"><a href="BayesReg1.html#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Intraclass Correlation Coefficient</span></span>
<span id="cb161-3"><a href="BayesReg1.html#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb161-4"><a href="BayesReg1.html#cb161-4" aria-hidden="true" tabindex="-1"></a><span class="co">#      Adjusted ICC: 0.565</span></span>
<span id="cb161-5"><a href="BayesReg1.html#cb161-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   Conditional ICC: 0.317</span></span>
<span id="cb161-6"><a href="BayesReg1.html#cb161-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-7"><a href="BayesReg1.html#cb161-7" aria-hidden="true" tabindex="-1"></a><span class="co"># calculating conditional ICC</span></span>
<span id="cb161-8"><a href="BayesReg1.html#cb161-8" aria-hidden="true" tabindex="-1"></a>post_par <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(<span class="fu">posterior_samples</span>(fit2, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;b_Dose750&quot;</span>,<span class="st">&quot;b_Dose1500&quot;</span>,<span class="st">&quot;b_Dose3000&quot;</span>)))</span>
<span id="cb161-9"><a href="BayesReg1.html#cb161-9" aria-hidden="true" tabindex="-1"></a>dummy <span class="ot">&lt;-</span> <span class="fu">with</span>(ntp, <span class="fu">outer</span>(Dose, <span class="fu">levels</span>(Dose), <span class="st">`</span><span class="at">==</span><span class="st">`</span>)<span class="sc">*</span><span class="dv">1</span>)[,<span class="sc">-</span><span class="dv">1</span>] <span class="co">#dummy matrix removing dose0 level;</span></span>
<span id="cb161-10"><a href="BayesReg1.html#cb161-10" aria-hidden="true" tabindex="-1"></a>sigma_f2 <span class="ot">&lt;-</span> <span class="fu">var</span>(dummy<span class="sc">%*%</span>post_par)</span>
<span id="cb161-11"><a href="BayesReg1.html#cb161-11" aria-hidden="true" tabindex="-1"></a>draws_icc_conditional <span class="ot">&lt;-</span> (draws_tau<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (draws_tau<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sigma_f2<span class="sc">+</span> draws_sigma<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb161-12"><a href="BayesReg1.html#cb161-12" aria-hidden="true" tabindex="-1"></a><span class="co"># quantile of posterior conditional ICC</span></span>
<span id="cb161-13"><a href="BayesReg1.html#cb161-13" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(draws_icc_conditional, <span class="at">p=</span><span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.025</span>,<span class="fl">0.975</span>)) </span></code></pre></div>
<pre><code>##       50%      2.5%     97.5% 
## 0.3142783 0.2486054 0.3974582</code></pre>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="BayesReg1.html#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the adjusted ICC</span></span>
<span id="cb163-2"><a href="BayesReg1.html#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(draws_icc_conditional, <span class="at">geom =</span> <span class="st">&quot;density&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;ICC conditional&quot;</span>, <span class="at">bw =</span> <span class="st">&quot;SJ&quot;</span>)</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-133-1.png" width="672" /></p>
<ul>
<li><p>It was estimated that 31%, 95% CI [25%, 40%] of the variations in fetal weight was attributed to between-litter differences given fix effects.</p></li>
<li><p><strong>Second model - Normal hierarchical model with varying intercept and slope</strong></p></li>
<li><p>Variability in “velocity” between individual, dose the effect of dose on weight also vary by litter?</p></li>
<li><p>We want to build a model which recognizes that in the relationship between feta weight and dose,</p>
<ul>
<li>where the intercept (i.e., baseline weight)</li>
<li>and slope (i.e., rate at which weight changes with dose) might vary from mouse to mouse.</li>
</ul></li>
<li><p>A random intercept and slope model!</p></li>
<li><p>Variability within litter by dose</p>
<ul>
<li>in this model, <span class="math inline">\(\beta_{0j}\)</span> and <span class="math inline">\(\beta_{1j}\)</span> depend on litter</li>
</ul></li>
<li><p>specifying our hierarchical random intercept and slope model :</p></li>
</ul>
<p><span class="math display">\[ Y_{ij} \mid \beta_{0j}, \beta_{1j}, \sigma_y \sim N(\beta_{0j} + \beta_{1j} \ dose_{ij}, \sigma_y^2) \]</span></p>
<p><span class="math display">\[\beta_{0j} \mid \beta_{0}, \sigma_0^2\]</span>
<span class="math display">\[\beta_{1j} \mid \beta_{1}, \sigma_1^2\]</span></p>
<ul>
<li><p>In this model <span class="math inline">\(\beta_{0j}\)</span> and <span class="math inline">\(\beta_{1j}\)</span> working together to describe the model for litter <span class="math inline">\(j\)</span>, and thus are <strong>correlated</strong>!</p></li>
<li><p>Let <span class="math inline">\(\rho \in [-1,1]\)</span> represents the correlation between <span class="math inline">\(\beta_{0j}\)</span> and <span class="math inline">\(\beta_{1j}\)</span>. We can assign a <strong>joint Normal model</strong> of <span class="math inline">\(\beta_{0j}\)</span> and <span class="math inline">\(\beta_{1j}\)</span> where</p></li>
</ul>
<p><span class="math display">\[
\begin{pmatrix}
\beta_{0j}\\
\beta_{1j}
\end{pmatrix} \mid \beta_{0}, \beta_{1}, \sigma_0, \sigma_1 \sim N(\begin{pmatrix}
\beta_{0}\\
\beta_{1}
\end{pmatrix}, \begin{pmatrix}
\sigma_0^2 &amp; \rho \sigma_0\sigma_1 \\
\rho \sigma_0\sigma_1 &amp; \sigma_1^2 
\end{pmatrix}).
\]</span></p>
<p><span class="math display">\[\beta_{0} \sim N(0,10)\]</span>
<span class="math display">\[\beta_{1} \sim N(0,10)\]</span>
<span class="math display">\[\sigma_y \sim HalfCauchy(10)\]</span>
<span class="math display">\[\sigma_0 \sim HalfCauchy(10)\]</span>
<span class="math display">\[\sigma_1 \sim HalfCauchy(10)\]</span>
<span class="math display">\[\mathbf{R} \sim LKJcorr(2)\]</span></p>
<ul>
<li><p>where <span class="math inline">\(\mathbf{R}\)</span> is the correlation matrix <span class="math display">\[\begin{pmatrix}
1 &amp; \rho  \\
\rho  &amp; 1 
\end{pmatrix}\]</span></p></li>
<li><p>LKJ-correlation prior <span class="citation">(<a href="#ref-lewandowski2009generating" role="doc-biblioref">Lewandowski, Kurowicka, and Joe 2009</a>)</span> with one parameter (<span class="math inline">\(\zeta\)</span>) that controls the strength of the correlation.</p></li>
</ul>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="BayesReg1.html#cb164-1" aria-hidden="true" tabindex="-1"></a>dlkjcorr2 <span class="ot">&lt;-</span> <span class="cf">function</span>(rho, <span class="at">eta =</span> <span class="dv">1</span>, <span class="at">log =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb164-2"><a href="BayesReg1.html#cb164-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Function to compute the LKJ density given a correlation</span></span>
<span id="cb164-3"><a href="BayesReg1.html#cb164-3" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> (eta <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> rho<span class="sc">^</span><span class="dv">2</span>) <span class="sc">-</span> </span>
<span id="cb164-4"><a href="BayesReg1.html#cb164-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(pi) <span class="sc">-</span> <span class="fu">lgamma</span>(eta) <span class="sc">+</span> <span class="fu">lgamma</span>(eta <span class="sc">+</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb164-5"><a href="BayesReg1.html#cb164-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>log) out <span class="ot">&lt;-</span> <span class="fu">exp</span>(out)</span>
<span id="cb164-6"><a href="BayesReg1.html#cb164-6" aria-hidden="true" tabindex="-1"></a>  out</span>
<span id="cb164-7"><a href="BayesReg1.html#cb164-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb164-8"><a href="BayesReg1.html#cb164-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">tibble</span>(<span class="at">rho =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)), <span class="fu">aes</span>(<span class="at">x =</span> rho)) <span class="sc">+</span> </span>
<span id="cb164-9"><a href="BayesReg1.html#cb164-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dlkjcorr2, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">eta =</span> <span class="fl">0.1</span>), </span>
<span id="cb164-10"><a href="BayesReg1.html#cb164-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">&quot;0.1&quot;</span>), <span class="at">n =</span> <span class="dv">501</span>) <span class="sc">+</span> </span>
<span id="cb164-11"><a href="BayesReg1.html#cb164-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dlkjcorr2, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">eta =</span> <span class="fl">0.5</span>), </span>
<span id="cb164-12"><a href="BayesReg1.html#cb164-12" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">&quot;0.5&quot;</span>), <span class="at">n =</span> <span class="dv">501</span>) <span class="sc">+</span> </span>
<span id="cb164-13"><a href="BayesReg1.html#cb164-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dlkjcorr2, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">eta =</span> <span class="dv">1</span>), </span>
<span id="cb164-14"><a href="BayesReg1.html#cb164-14" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">&quot;1&quot;</span>), <span class="at">n =</span> <span class="dv">501</span>) <span class="sc">+</span> </span>
<span id="cb164-15"><a href="BayesReg1.html#cb164-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dlkjcorr2, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">eta =</span> <span class="dv">2</span>), </span>
<span id="cb164-16"><a href="BayesReg1.html#cb164-16" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">&quot;2&quot;</span>), <span class="at">n =</span> <span class="dv">501</span>) <span class="sc">+</span> </span>
<span id="cb164-17"><a href="BayesReg1.html#cb164-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dlkjcorr2, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">eta =</span> <span class="dv">10</span>), </span>
<span id="cb164-18"><a href="BayesReg1.html#cb164-18" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">&quot;10&quot;</span>), <span class="at">n =</span> <span class="dv">501</span>) <span class="sc">+</span> </span>
<span id="cb164-19"><a href="BayesReg1.html#cb164-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dlkjcorr2, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">eta =</span> <span class="dv">100</span>), </span>
<span id="cb164-20"><a href="BayesReg1.html#cb164-20" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">&quot;100&quot;</span>), <span class="at">n =</span> <span class="dv">501</span>) <span class="sc">+</span> </span>
<span id="cb164-21"><a href="BayesReg1.html#cb164-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">col =</span> <span class="fu">expression</span>(eta), <span class="at">x =</span> <span class="fu">expression</span>(rho), <span class="at">y =</span> <span class="st">&quot;Density&quot;</span>)<span class="sc">+</span></span>
<span id="cb164-22"><a href="BayesReg1.html#cb164-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-134"></span>
<img src="bayes_bookdown_files/figure-html/unnamed-chunk-134-1.png" alt="LKJ prior for different values of the shape paramete" width="864" />
<p class="caption">
Figure 6.3: LKJ prior for different values of the shape paramete
</p>
</div>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="BayesReg1.html#cb165-1" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> ntp,</span>
<span id="cb165-2"><a href="BayesReg1.html#cb165-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">family=</span> <span class="fu">gaussian</span>(),</span>
<span id="cb165-3"><a href="BayesReg1.html#cb165-3" aria-hidden="true" tabindex="-1"></a>            Weight <span class="sc">~</span> Dose <span class="sc">+</span> (Dose<span class="sc">|</span>Litter),  </span>
<span id="cb165-4"><a href="BayesReg1.html#cb165-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb165-5"><a href="BayesReg1.html#cb165-5" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb165-6"><a href="BayesReg1.html#cb165-6" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> sd),</span>
<span id="cb165-7"><a href="BayesReg1.html#cb165-7" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> sigma),</span>
<span id="cb165-8"><a href="BayesReg1.html#cb165-8" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">2</span>), <span class="at">class =</span> cor)),</span>
<span id="cb165-9"><a href="BayesReg1.html#cb165-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">iter =</span> <span class="dv">11000</span>,</span>
<span id="cb165-10"><a href="BayesReg1.html#cb165-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">warmup =</span> <span class="dv">10000</span>,</span>
<span id="cb165-11"><a href="BayesReg1.html#cb165-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">chains =</span> <span class="dv">3</span>,</span>
<span id="cb165-12"><a href="BayesReg1.html#cb165-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">cores =</span> <span class="dv">4</span>, </span>
<span id="cb165-13"><a href="BayesReg1.html#cb165-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">9</span>), </span>
<span id="cb165-14"><a href="BayesReg1.html#cb165-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">seed =</span> <span class="dv">123</span>, </span>
<span id="cb165-15"><a href="BayesReg1.html#cb165-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">silent =</span> <span class="dv">2</span>,</span>
<span id="cb165-16"><a href="BayesReg1.html#cb165-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb165-17"><a href="BayesReg1.html#cb165-17" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(fit3, &quot;data/chap7_h_example3&quot;)</span></span></code></pre></div>
<ul>
<li>Posterior summary</li>
</ul>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="BayesReg1.html#cb166-1" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/chap7_h_example3&quot;</span>)</span>
<span id="cb166-2"><a href="BayesReg1.html#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit3)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: Weight ~ Dose + (Dose | Litter) 
##    Data: ntp (Number of observations: 1027) 
##   Draws: 3 chains, each with iter = 11000; warmup = 10000; thin = 1;
##          total post-warmup draws = 3000
## 
## Group-Level Effects: 
## ~Litter (Number of levels: 94) 
##                         Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
## sd(Intercept)               0.07      0.01     0.05     0.09 1.01      636
## sd(Dose750)                 0.05      0.03     0.00     0.12 1.00      231
## sd(Dose1500)                0.07      0.04     0.01     0.15 1.00      404
## sd(Dose3000)                0.08      0.04     0.01     0.15 1.01      412
## cor(Intercept,Dose750)     -0.07      0.35    -0.69     0.64 1.00      564
## cor(Intercept,Dose1500)    -0.03      0.36    -0.71     0.66 1.00      647
## cor(Dose750,Dose1500)      -0.01      0.37    -0.69     0.68 1.01     1110
## cor(Intercept,Dose3000)     0.01      0.36    -0.66     0.68 1.01      560
## cor(Dose750,Dose3000)      -0.00      0.37    -0.68     0.70 1.00     1224
## cor(Dose1500,Dose3000)      0.00      0.38    -0.70     0.70 1.00      831
##                         Tail_ESS
## sd(Intercept)               1333
## sd(Dose750)                  708
## sd(Dose1500)                 830
## sd(Dose3000)                 759
## cor(Intercept,Dose750)       790
## cor(Intercept,Dose1500)      653
## cor(Dose750,Dose1500)       1778
## cor(Intercept,Dose3000)      749
## cor(Dose750,Dose3000)       1876
## cor(Dose1500,Dose3000)      1553
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.98      0.01     0.95     1.00 1.00      855     1252
## Dose750      -0.09      0.02    -0.14    -0.05 1.00     1280     1737
## Dose1500     -0.20      0.03    -0.25    -0.14 1.00     1536     1698
## Dose3000     -0.26      0.03    -0.32    -0.21 1.00     1581     1979
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.07      0.00     0.07     0.08 1.00     4723     2301
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="BayesReg1.html#cb168-1" aria-hidden="true" tabindex="-1"></a>fit3 <span class="sc">%&gt;%</span> <span class="fu">plot</span>( <span class="at">combo =</span> <span class="fu">c</span>(<span class="st">&quot;hist&quot;</span>, <span class="st">&quot;trace&quot;</span>), <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">1.5</span>),</span>
<span id="cb168-2"><a href="BayesReg1.html#cb168-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">theme =</span> <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">10</span>))</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-136-1.png" width="672" style="display: block; margin: auto;" /><img src="bayes_bookdown_files/figure-html/unnamed-chunk-136-2.png" width="672" style="display: block; margin: auto;" /><img src="bayes_bookdown_files/figure-html/unnamed-chunk-136-3.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="BayesReg1.html#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">conditional_effects</span>(fit3)</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-136-4.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li>Interpretations</li>
</ul>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="BayesReg1.html#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">VarCorr</span>(fit3)<span class="sc">$</span>Litter<span class="sc">$</span>sd, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##           Estimate Est.Error  Q2.5 Q97.5
## Intercept    0.068     0.011 0.050 0.091
## Dose750      0.051     0.032 0.002 0.120
## Dose1500     0.071     0.038 0.006 0.150
## Dose3000     0.080     0.036 0.013 0.155</code></pre>
<ul>
<li>Comparing between the two models (both models are really similar)</li>
</ul>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="BayesReg1.html#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(fit2, fit3)</span></code></pre></div>
<pre><code>## Output of model &#39;fit2&#39;:
## 
## Computed from 8000 by 1027 log-likelihood matrix
## 
##          Estimate   SE
## elpd_loo   1153.9 33.6
## p_loo        95.8  8.5
## looic     -2307.9 67.2
## ------
## Monte Carlo SE of elpd_loo is NA.
## 
## Pareto k diagnostic values:
##                          Count Pct.    Min. n_eff
## (-Inf, 0.5]   (good)     1021  99.4%   908       
##  (0.5, 0.7]   (ok)          4   0.4%   183       
##    (0.7, 1]   (bad)         2   0.2%   16        
##    (1, Inf)   (very bad)    0   0.0%   &lt;NA&gt;      
## See help(&#39;pareto-k-diagnostic&#39;) for details.
## 
## Output of model &#39;fit3&#39;:
## 
## Computed from 3000 by 1027 log-likelihood matrix
## 
##          Estimate   SE
## elpd_loo   1154.2 33.7
## p_loo        96.5  9.0
## looic     -2308.5 67.5
## ------
## Monte Carlo SE of elpd_loo is NA.
## 
## Pareto k diagnostic values:
##                          Count Pct.    Min. n_eff
## (-Inf, 0.5]   (good)     1023  99.6%   388       
##  (0.5, 0.7]   (ok)          2   0.2%   69        
##    (0.7, 1]   (bad)         1   0.1%   56        
##    (1, Inf)   (very bad)    1   0.1%   3         
## See help(&#39;pareto-k-diagnostic&#39;) for details.
## 
## Model comparisons:
##      elpd_diff se_diff
## fit3  0.0       0.0   
## fit2 -0.3       1.2</code></pre>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="BayesReg1.html#cb174-1" aria-hidden="true" tabindex="-1"></a>waic1 <span class="ot">&lt;-</span> <span class="fu">waic</span>(fit2)</span>
<span id="cb174-2"><a href="BayesReg1.html#cb174-2" aria-hidden="true" tabindex="-1"></a>waic2 <span class="ot">&lt;-</span> <span class="fu">waic</span>(fit3)</span>
<span id="cb174-3"><a href="BayesReg1.html#cb174-3" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_ic</span>(waic1, waic2) </span></code></pre></div>
<pre><code>##                 WAIC    SE
## fit2        -2311.00 66.82
## fit3        -2311.51 67.46
## fit2 - fit3     0.52  3.09</code></pre>
</div>
</div>
<div id="regression-regularization" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Regression regularization<a href="BayesReg1.html#regression-regularization" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="shrinkage-priors-in-action" class="section level3 hasAnchor" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> Shrinkage Priors in action<a href="BayesReg1.html#shrinkage-priors-in-action" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>When the number of parameters to be estimated is large relative to sample size, estimation using non-informative or weakly informative priors tend to overfit.</p></li>
<li><p>One way to avoid overfitting is to perform regularization, that is, to shrink some of the parameters to closer to zero. This makes the model fit less well to the existing data, but will be much more generalizable to an independent data set.</p></li>
<li><p>Sparsity-Inducing Priors</p></li>
<li><p>The horseshoe prior is a type of hierarchical prior for regression models by introducing a global scale and local scale parameters on the priors for the regression coefficients.</p></li>
<li><p>Specifically, with <span class="math inline">\(p\)</span> predictors</p></li>
</ul>
<p><span class="math display">\[Y_i \sim N(\mu_i, \sigma^2)\]</span>
<span class="math display">\[\mu_i = \beta_0 + \sum_{m=1}^p\beta_m X_m\]</span>
<span class="math display">\[\beta_0 \sim N(0,10)\]</span>
<span class="math display">\[\beta_m \sim N(0,\tau\lambda_m)\]</span>
<span class="math display">\[\lambda_m \sim Cauchy(10)\]</span>
<span class="math display">\[\tau \sim Cauchy(\tau_0)\]</span></p>
<ul>
<li>local scale <span class="math inline">\(\lambda_m\)</span> can flexibly shrink the coefficient to close to zero.</li>
</ul>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="BayesReg1.html#cb176-1" aria-hidden="true" tabindex="-1"></a>dhs <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(</span>
<span id="cb176-2"><a href="BayesReg1.html#cb176-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(y, <span class="at">df =</span> <span class="dv">1</span>) {</span>
<span id="cb176-3"><a href="BayesReg1.html#cb176-3" aria-hidden="true" tabindex="-1"></a>  ff <span class="ot">&lt;-</span> <span class="cf">function</span>(lam) <span class="fu">dnorm</span>(y, <span class="dv">0</span>, <span class="at">sd =</span> lam) <span class="sc">*</span> <span class="fu">dt</span>(lam, df) <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb176-4"><a href="BayesReg1.html#cb176-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (y <span class="sc">!=</span> <span class="dv">0</span>) <span class="fu">integrate</span>(ff, <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> <span class="cn">Inf</span>)<span class="sc">$</span>value</span>
<span id="cb176-5"><a href="BayesReg1.html#cb176-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cn">Inf</span></span>
<span id="cb176-6"><a href="BayesReg1.html#cb176-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb176-7"><a href="BayesReg1.html#cb176-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb176-8"><a href="BayesReg1.html#cb176-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>)), <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb176-9"><a href="BayesReg1.html#cb176-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dhs, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">df =</span> <span class="dv">1</span>), <span class="at">n =</span> <span class="dv">501</span>,</span>
<span id="cb176-10"><a href="BayesReg1.html#cb176-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">&quot;HS&quot;</span>), <span class="at">linetype =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb176-11"><a href="BayesReg1.html#cb176-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, <span class="at">n =</span> <span class="dv">501</span>, </span>
<span id="cb176-12"><a href="BayesReg1.html#cb176-12" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">&quot;norm&quot;</span>), <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb176-13"><a href="BayesReg1.html#cb176-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;steelblue&quot;</span>, <span class="st">&quot;black&quot;</span>),</span>
<span id="cb176-14"><a href="BayesReg1.html#cb176-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;horseshoe(1)&quot;</span>, <span class="st">&quot;N(0, 1)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb176-15"><a href="BayesReg1.html#cb176-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;y&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;density&quot;</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="fl">0.75</span>)<span class="sc">+</span></span>
<span id="cb176-16"><a href="BayesReg1.html#cb176-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bayes_bookdown_files/figure-html/unnamed-chunk-139-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="bayesian-logistic-regression-model-cope-example-revisit" class="section level3 hasAnchor" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> Bayesian logistic regression model (COPE example revisit)<a href="BayesReg1.html#bayesian-logistic-regression-model-cope-example-revisit" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>Data come from a cross-sectional study of 1,225 smokers over the age of 40.</p></li>
<li><p>Each participant was assessed for chronic obstructive pulmonary disease (COPD), and characteristics of the type of cigarette they most frequently smoke were recorded.</p></li>
<li><p>The objective of the study was to identify associations between COPD diagnosis and cigarette characteristics</p></li>
</ul>
<p>We will use the following variables from this data set:</p>
<ul>
<li><p>NIC: Nicotine content, in mg</p></li>
<li><p>TAR: Tar content, in mg</p></li>
<li><p>LEN: Length of cigarette, in mm</p></li>
<li><p>copd: 1 = COPD diagnosis, 0 = no COPD diagnosis</p></li>
</ul>
<table>
<thead>
<tr class="header">
<th align="right">NIC</th>
<th align="right">TAR</th>
<th align="right">LEN</th>
<th align="right">copd</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.2</td>
<td align="right">3</td>
<td align="right">68</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.3</td>
<td align="right">5</td>
<td align="right">68</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">0.8</td>
<td align="right">14</td>
<td align="right">83</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.9</td>
<td align="right">15</td>
<td align="right">83</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">0.8</td>
<td align="right">11</td>
<td align="right">83</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.9</td>
<td align="right">15</td>
<td align="right">84</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<ul>
<li>We fit a simple logistic regression, predicting the risk of copd by all covariates as well as all interaction effects</li>
</ul>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="BayesReg1.html#cb177-1" aria-hidden="true" tabindex="-1"></a>fit4<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(copd <span class="sc">~</span> (.)<span class="sc">^</span><span class="dv">2</span>, </span>
<span id="cb177-2"><a href="BayesReg1.html#cb177-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> copd, </span>
<span id="cb177-3"><a href="BayesReg1.html#cb177-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> <span class="fu">bernoulli</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), </span>
<span id="cb177-4"><a href="BayesReg1.html#cb177-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">prior =</span> <span class="fu">c</span>(</span>
<span id="cb177-5"><a href="BayesReg1.html#cb177-5" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="at">class =</span> <span class="st">&quot;Intercept&quot;</span>),</span>
<span id="cb177-6"><a href="BayesReg1.html#cb177-6" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># Prior guess of 25% of the terms are non-zero</span></span>
<span id="cb177-7"><a href="BayesReg1.html#cb177-7" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">prior</span>(<span class="fu">horseshoe</span>(<span class="at">par_ratio =</span> <span class="dv">2</span> <span class="sc">/</span> <span class="dv">8</span>), <span class="at">class =</span> <span class="st">&quot;b&quot;</span>)),</span>
<span id="cb177-8"><a href="BayesReg1.html#cb177-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">iter =</span> <span class="dv">7500</span>,</span>
<span id="cb177-9"><a href="BayesReg1.html#cb177-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">warmup =</span> <span class="dv">5000</span>,</span>
<span id="cb177-10"><a href="BayesReg1.html#cb177-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb177-11"><a href="BayesReg1.html#cb177-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">cores =</span> <span class="dv">5</span>, </span>
<span id="cb177-12"><a href="BayesReg1.html#cb177-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">seed =</span> <span class="dv">123</span>, </span>
<span id="cb177-13"><a href="BayesReg1.html#cb177-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">silent =</span> <span class="dv">2</span>, </span>
<span id="cb177-14"><a href="BayesReg1.html#cb177-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb177-15"><a href="BayesReg1.html#cb177-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-16"><a href="BayesReg1.html#cb177-16" aria-hidden="true" tabindex="-1"></a>fit4<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(copd <span class="sc">~</span> (.)<span class="sc">^</span><span class="dv">2</span>, </span>
<span id="cb177-17"><a href="BayesReg1.html#cb177-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> copd, </span>
<span id="cb177-18"><a href="BayesReg1.html#cb177-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> <span class="fu">bernoulli</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), </span>
<span id="cb177-19"><a href="BayesReg1.html#cb177-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">prior =</span> <span class="fu">c</span>(</span>
<span id="cb177-20"><a href="BayesReg1.html#cb177-20" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="at">class =</span> <span class="st">&quot;Intercept&quot;</span>),</span>
<span id="cb177-21"><a href="BayesReg1.html#cb177-21" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="at">class =</span> <span class="st">&quot;b&quot;</span>)),</span>
<span id="cb177-22"><a href="BayesReg1.html#cb177-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">iter =</span> <span class="dv">7500</span>,</span>
<span id="cb177-23"><a href="BayesReg1.html#cb177-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">warmup =</span> <span class="dv">5000</span>,</span>
<span id="cb177-24"><a href="BayesReg1.html#cb177-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb177-25"><a href="BayesReg1.html#cb177-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">cores =</span> <span class="dv">5</span>, </span>
<span id="cb177-26"><a href="BayesReg1.html#cb177-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">seed =</span> <span class="dv">123</span>, </span>
<span id="cb177-27"><a href="BayesReg1.html#cb177-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">silent =</span> <span class="dv">2</span>, </span>
<span id="cb177-28"><a href="BayesReg1.html#cb177-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb177-29"><a href="BayesReg1.html#cb177-29" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(fit4.1, file=&quot;data/chap7_h_example4.1&quot;)</span></span>
<span id="cb177-30"><a href="BayesReg1.html#cb177-30" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(fit4.2, file=&quot;data/chap7_h_example4.2&quot;)</span></span></code></pre></div>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="BayesReg1.html#cb178-1" aria-hidden="true" tabindex="-1"></a>fit4<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/chap7_h_example4.1&quot;</span>)</span>
<span id="cb178-2"><a href="BayesReg1.html#cb178-2" aria-hidden="true" tabindex="-1"></a>fit4<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/chap7_h_example4.2&quot;</span>)</span>
<span id="cb178-3"><a href="BayesReg1.html#cb178-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-4"><a href="BayesReg1.html#cb178-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit4<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>##  Family: bernoulli 
##   Links: mu = logit 
## Formula: copd ~ (NIC + TAR + LEN)^2 
##    Data: copd (Number of observations: 1225) 
##   Draws: 4 chains, each with iter = 7500; warmup = 5000; thin = 1;
##          total post-warmup draws = 10000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -5.16      3.30   -11.73     1.20 1.00     4766     4352
## NIC           5.63      6.27    -6.59    18.02 1.00     2652     3835
## TAR          -0.31      0.46    -1.20     0.58 1.00     2669     4452
## LEN           0.02      0.03    -0.04     0.09 1.00     5107     4676
## NIC:TAR       0.06      0.04    -0.02     0.15 1.00     6022     6298
## NIC:LEN      -0.06      0.07    -0.21     0.08 1.00     2631     4007
## TAR:LEN       0.00      0.01    -0.01     0.01 1.00     2644     4475
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="BayesReg1.html#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit4<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>##  Family: bernoulli 
##   Links: mu = logit 
## Formula: copd ~ (NIC + TAR + LEN)^2 
##    Data: copd (Number of observations: 1225) 
##   Draws: 4 chains, each with iter = 7500; warmup = 5000; thin = 1;
##          total post-warmup draws = 10000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -3.25      0.57    -4.36    -2.07 1.00     6318     5700
## NIC           0.01      0.12    -0.04     0.10 1.00     4425     3544
## TAR           0.00      0.02    -0.03     0.05 1.00     4743     4868
## LEN          -0.00      0.01    -0.01     0.01 1.00     4978     5215
## NIC:TAR       0.02      0.02    -0.00     0.08 1.00     3152     4269
## NIC:LEN       0.00      0.01    -0.00     0.02 1.00     4716     5852
## TAR:LEN       0.00      0.00    -0.00     0.00 1.00     5359     7601
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<ul>
<li>An arbitrary cutoff is to select only coefficients with posterior means larger than .02, in which case only NIC and TAR and their interaction were supported by the data.</li>
</ul>
</div>
<div id="r-session-information-5" class="section level3 unnumbered hasAnchor">
<h3>R Session information<a href="BayesReg1.html#r-session-information-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<pre><code>## R version 4.0.5 (2021-03-31)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 19044)
## 
## Matrix products: 
## 
## locale:
## [1] LC_COLLATE=English_Canada.1252  LC_CTYPE=English_Canada.1252   
## [3] LC_MONETARY=English_Canada.1252 LC_NUMERIC=C                   
## [5] LC_TIME=English_Canada.1252    
## 
## attached base packages:
## [1] grid      stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
##  [1] DT_0.22             gtsummary_1.5.2     invgamma_1.1       
##  [4] extraDistr_1.9.1    MCMCpack_1.6-1      MASS_7.3-53.1      
##  [7] coda_0.19-4         SHELF_1.8.0         bayesplot_1.9.0    
## [10] ggmcmc_1.5.1.1      tidyr_1.2.0         ggpubr_0.4.0       
## [13] tweenr_1.0.2        gganimate_1.0.7     VennDiagram_1.7.1  
## [16] futile.logger_1.4.3 truncnorm_1.0-8     brms_2.16.3        
## [19] Rcpp_1.0.8.3        dplyr_1.0.8         ggplot2_3.3.5</code></pre>

</div>
</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-burkner2017advanced" class="csl-entry">
Bürkner, Paul-Christian. 2017. <span>“Advanced Bayesian Multilevel Modeling with the r Package Brms.”</span> <em>arXiv Preprint arXiv:1705.11123</em>.
</div>
<div id="ref-geweke1991evaluating" class="csl-entry">
Geweke, John F et al. 1991. <span>“Evaluating the Accuracy of Sampling-Based Approaches to the Calculation of Posterior Moments.”</span> Federal Reserve Bank of Minneapolis.
</div>
<div id="ref-lewandowski2009generating" class="csl-entry">
Lewandowski, Daniel, Dorota Kurowicka, and Harry Joe. 2009. <span>“Generating Random Correlation Matrices Based on Vines and Extended Onion Method.”</span> <em>Journal of Multivariate Analysis</em> 100 (9): 1989–2001.
</div>
<div id="ref-mcelreath2018statistical" class="csl-entry">
McElreath, Richard. 2018. <em>Statistical Rethinking: A Bayesian Course with Examples in r and Stan</em>. Chapman; Hall/CRC.
</div>
<div id="ref-nakagawa2017coefficient" class="csl-entry">
Nakagawa, Shinichi, Paul CD Johnson, and Holger Schielzeth. 2017. <span>“The Coefficient of Determination r 2 and Intra-Class Correlation Coefficient from Generalized Linear Mixed-Effects Models Revisited and Expanded.”</span> <em>Journal of the Royal Society Interface</em> 14 (134): 20170213.
</div>
<div id="ref-price1985developmental" class="csl-entry">
Price, Catherine J, Carole A Kimmel, Rochelle W Tyl, and Melissa C Marr. 1985. <span>“The Developmental Toxicity of Ethylene Glycol in Rats and Mice.”</span> <em>Toxicology and Applied Pharmacology</em> 81 (1): 113–27.
</div>
<div id="ref-student1908probable" class="csl-entry">
Student. 1908. <span>“The Probable Error of a Mean.”</span> <em>Biometrika</em>, 1–25.
</div>
<div id="ref-vehtari2017practical" class="csl-entry">
Vehtari, Aki, Andrew Gelman, and Jonah Gabry. 2017. <span>“Practical Bayesian Model Evaluation Using Leave-One-Out Cross-Validation and WAIC.”</span> <em>Statistics and Computing</em> 27 (5): 1413–32.
</div>
<div id="ref-watanabe2010asymptotic" class="csl-entry">
Watanabe, Sumio, and Manfred Opper. 2010. <span>“Asymptotic Equivalence of Bayes Cross Validation and Widely Applicable Information Criterion in Singular Learning Theory.”</span> <em>Journal of Machine Learning Research</em> 11 (12).
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="BayesMCMC.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="BayesReg2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": "twitter"
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
